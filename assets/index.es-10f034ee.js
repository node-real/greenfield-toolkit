import{e as Ul,r as ws,f as ie,h as Cr,i as fm,w as Hl,j as kl,k as Ec,t as _o,m as pm,o as Br,p as Kl,q as Ii,V as dm,M as gm,N as Y,s as vm,u as pc,v as ym,K as mm,A as wm,x as Nh,y as _m,H as bm,F as Em,z as $h,$ as Im,B as xm,J as Pm,C as Ys,D as Dh,X as Sm,E as Cm,G as Ic,_ as Bl,I as Fr,L as Rm,O as Fh,P as ps,Q as $t,U as Gt,R as Ei,S as hr,T as Om,W as ds,Y as Vl,Z as Am,a0 as Tm,a1 as Nm,a2 as Gl,a3 as $m,a4 as Wl,a5 as Jl,a6 as vs,a7 as dc,a8 as fo,a9 as ms,aa as Dm,ab as po,ac as Fm,ad as Lm,ae as qm,af as Mm,ag as oo,ah as jm,ai as zm,aj as Qa,ak as Lh,al as Um,am as Hm,an as km,ao as qh,ap as Km,aq as Bm,ar as Vm,as as Gm,at as Wm,au as Jm,av as Qm,aw as Mh,ax as Gs,ay as Ql,az as Ya,aA as Ym,aB as Xm,aC as Zm}from"./index-69ed1660.js";const e1=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,t1=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,r1=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function i1(c,r){if(c==="__proto__"||c==="constructor"&&r&&typeof r=="object"&&"prototype"in r){s1(c);return}return r}function s1(c){console.warn(`[destr] Dropping "${c}" key to prevent prototype pollution.`)}function ao(c,r={}){if(typeof c!="string")return c;const i=c.trim();if(c[0]==='"'&&c.at(-1)==='"'&&!c.includes("\\"))return i.slice(1,-1);if(i.length<=9){const n=i.toLowerCase();if(n==="true")return!0;if(n==="false")return!1;if(n==="undefined")return;if(n==="null")return null;if(n==="nan")return Number.NaN;if(n==="infinity")return Number.POSITIVE_INFINITY;if(n==="-infinity")return Number.NEGATIVE_INFINITY}if(!r1.test(c)){if(r.strict)throw new SyntaxError("[destr] Invalid JSON");return c}try{if(e1.test(c)||t1.test(c)){if(r.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(c,i1)}return JSON.parse(c)}catch(n){if(r.strict)throw n;return c}}function n1(c){return!c||typeof c.then!="function"?Promise.resolve(c):c}function zt(c,...r){try{return n1(c(...r))}catch(i){return Promise.reject(i)}}function o1(c){const r=typeof c;return c===null||r!=="object"&&r!=="function"}function a1(c){const r=Object.getPrototypeOf(c);return!r||r.isPrototypeOf(Object)}function go(c){if(o1(c))return String(c);if(a1(c)||Array.isArray(c))return JSON.stringify(c);if(typeof c.toJSON=="function")return go(c.toJSON());throw new Error("[unstorage] Cannot stringify value!")}function Yl(){if(typeof Buffer===void 0)throw new TypeError("[unstorage] Buffer is not supported!")}const gc="base64:";function c1(c){if(typeof c=="string")return c;Yl();const r=Buffer.from(c).toString("base64");return gc+r}function u1(c){return typeof c!="string"||!c.startsWith(gc)?c:(Yl(),Buffer.from(c.slice(gc.length),"base64"))}function ur(c){return c?c.split("?")[0].replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""):""}function h1(...c){return ur(c.join(":"))}function co(c){return c=ur(c),c?c+":":""}const l1="memory",f1=()=>{const c=new Map;return{name:l1,options:{},hasItem(r){return c.has(r)},getItem(r){return c.get(r)??null},getItemRaw(r){return c.get(r)??null},setItem(r,i){c.set(r,i)},setItemRaw(r,i){c.set(r,i)},removeItem(r){c.delete(r)},getKeys(){return Array.from(c.keys())},clear(){c.clear()},dispose(){c.clear()}}};function p1(c={}){const r={mounts:{"":c.driver||f1()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},i=y=>{for(const E of r.mountpoints)if(y.startsWith(E))return{base:E,relativeKey:y.slice(E.length),driver:r.mounts[E]};return{base:"",relativeKey:y,driver:r.mounts[""]}},n=(y,E)=>r.mountpoints.filter(C=>C.startsWith(y)||E&&y.startsWith(C)).map(C=>({relativeBase:y.length>C.length?y.slice(C.length):void 0,mountpoint:C,driver:r.mounts[C]})),o=(y,E)=>{if(r.watching){E=ur(E);for(const C of r.watchListeners)C(y,E)}},h=async()=>{if(!r.watching){r.watching=!0;for(const y in r.mounts)r.unwatch[y]=await jh(r.mounts[y],o,y)}},d=async()=>{if(r.watching){for(const y in r.unwatch)await r.unwatch[y]();r.unwatch={},r.watching=!1}},v=(y,E,C)=>{const O=new Map,j=D=>{let K=O.get(D.base);return K||(K={driver:D.driver,base:D.base,items:[]},O.set(D.base,K)),K};for(const D of y){const K=typeof D=="string",re=ur(K?D:D.key),ce=K?void 0:D.value,ue=K||!D.options?E:{...E,...D.options},he=i(re);j(he).items.push({key:re,value:ce,relativeKey:he.relativeKey,options:ue})}return Promise.all([...O.values()].map(D=>C(D))).then(D=>D.flat())},w={hasItem(y,E={}){y=ur(y);const{relativeKey:C,driver:O}=i(y);return zt(O.hasItem,C,E)},getItem(y,E={}){y=ur(y);const{relativeKey:C,driver:O}=i(y);return zt(O.getItem,C,E).then(j=>ao(j))},getItems(y,E){return v(y,E,C=>C.driver.getItems?zt(C.driver.getItems,C.items.map(O=>({key:O.relativeKey,options:O.options})),E).then(O=>O.map(j=>({key:h1(C.base,j.key),value:ao(j.value)}))):Promise.all(C.items.map(O=>zt(C.driver.getItem,O.relativeKey,O.options).then(j=>({key:O.key,value:ao(j)})))))},getItemRaw(y,E={}){y=ur(y);const{relativeKey:C,driver:O}=i(y);return O.getItemRaw?zt(O.getItemRaw,C,E):zt(O.getItem,C,E).then(j=>u1(j))},async setItem(y,E,C={}){if(E===void 0)return w.removeItem(y);y=ur(y);const{relativeKey:O,driver:j}=i(y);j.setItem&&(await zt(j.setItem,O,go(E),C),j.watch||o("update",y))},async setItems(y,E){await v(y,E,async C=>{C.driver.setItems&&await zt(C.driver.setItems,C.items.map(O=>({key:O.relativeKey,value:go(O.value),options:O.options})),E),C.driver.setItem&&await Promise.all(C.items.map(O=>zt(C.driver.setItem,O.relativeKey,go(O.value),O.options)))})},async setItemRaw(y,E,C={}){if(E===void 0)return w.removeItem(y,C);y=ur(y);const{relativeKey:O,driver:j}=i(y);if(j.setItemRaw)await zt(j.setItemRaw,O,E,C);else if(j.setItem)await zt(j.setItem,O,c1(E),C);else return;j.watch||o("update",y)},async removeItem(y,E={}){typeof E=="boolean"&&(E={removeMeta:E}),y=ur(y);const{relativeKey:C,driver:O}=i(y);O.removeItem&&(await zt(O.removeItem,C,E),(E.removeMeta||E.removeMata)&&await zt(O.removeItem,C+"$",E),O.watch||o("remove",y))},async getMeta(y,E={}){typeof E=="boolean"&&(E={nativeOnly:E}),y=ur(y);const{relativeKey:C,driver:O}=i(y),j=Object.create(null);if(O.getMeta&&Object.assign(j,await zt(O.getMeta,C,E)),!E.nativeOnly){const D=await zt(O.getItem,C+"$",E).then(K=>ao(K));D&&typeof D=="object"&&(typeof D.atime=="string"&&(D.atime=new Date(D.atime)),typeof D.mtime=="string"&&(D.mtime=new Date(D.mtime)),Object.assign(j,D))}return j},setMeta(y,E,C={}){return this.setItem(y+"$",E,C)},removeMeta(y,E={}){return this.removeItem(y+"$",E)},async getKeys(y,E={}){y=co(y);const C=n(y,!0);let O=[];const j=[];for(const D of C){const re=(await zt(D.driver.getKeys,D.relativeBase,E)).map(ce=>D.mountpoint+ur(ce)).filter(ce=>!O.some(ue=>ce.startsWith(ue)));j.push(...re),O=[D.mountpoint,...O.filter(ce=>!ce.startsWith(D.mountpoint))]}return y?j.filter(D=>D.startsWith(y)&&!D.endsWith("$")):j.filter(D=>!D.endsWith("$"))},async clear(y,E={}){y=co(y),await Promise.all(n(y,!1).map(async C=>{if(C.driver.clear)return zt(C.driver.clear,C.relativeBase,E);if(C.driver.removeItem){const O=await C.driver.getKeys(C.relativeBase||"",E);return Promise.all(O.map(j=>C.driver.removeItem(j,E)))}}))},async dispose(){await Promise.all(Object.values(r.mounts).map(y=>zh(y)))},async watch(y){return await h(),r.watchListeners.push(y),async()=>{r.watchListeners=r.watchListeners.filter(E=>E!==y),r.watchListeners.length===0&&await d()}},async unwatch(){r.watchListeners=[],await d()},mount(y,E){if(y=co(y),y&&r.mounts[y])throw new Error(`already mounted at ${y}`);return y&&(r.mountpoints.push(y),r.mountpoints.sort((C,O)=>O.length-C.length)),r.mounts[y]=E,r.watching&&Promise.resolve(jh(E,o,y)).then(C=>{r.unwatch[y]=C}).catch(console.error),w},async unmount(y,E=!0){y=co(y),!(!y||!r.mounts[y])&&(r.watching&&y in r.unwatch&&(r.unwatch[y](),delete r.unwatch[y]),E&&await zh(r.mounts[y]),r.mountpoints=r.mountpoints.filter(C=>C!==y),delete r.mounts[y])},getMount(y=""){y=ur(y)+":";const E=i(y);return{driver:E.driver,base:E.base}},getMounts(y="",E={}){return y=ur(y),n(y,E.parents).map(O=>({driver:O.driver,base:O.mountpoint}))}};return w}function jh(c,r,i){return c.watch?c.watch((n,o)=>r(n,i+o)):()=>{}}async function zh(c){typeof c.dispose=="function"&&await zt(c.dispose)}function Ki(c){return new Promise((r,i)=>{c.oncomplete=c.onsuccess=()=>r(c.result),c.onabort=c.onerror=()=>i(c.error)})}function Xl(c,r){const i=indexedDB.open(c);i.onupgradeneeded=()=>i.result.createObjectStore(r);const n=Ki(i);return(o,h)=>n.then(d=>h(d.transaction(r,o).objectStore(r)))}let Xa;function Xs(){return Xa||(Xa=Xl("keyval-store","keyval")),Xa}function Uh(c,r=Xs()){return r("readonly",i=>Ki(i.get(c)))}function d1(c,r,i=Xs()){return i("readwrite",n=>(n.put(r,c),Ki(n.transaction)))}function g1(c,r=Xs()){return r("readwrite",i=>(i.delete(c),Ki(i.transaction)))}function v1(c=Xs()){return c("readwrite",r=>(r.clear(),Ki(r.transaction)))}function y1(c,r){return c.openCursor().onsuccess=function(){this.result&&(r(this.result),this.result.continue())},Ki(c.transaction)}function m1(c=Xs()){return c("readonly",r=>{if(r.getAllKeys)return Ki(r.getAllKeys());const i=[];return y1(r,n=>i.push(n.key)).then(()=>i)})}const w1=c=>JSON.stringify(c,(r,i)=>typeof i=="bigint"?i.toString()+"n":i),_1=c=>{const r=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,i=c.replace(r,'$1"$2n"$3');return JSON.parse(i,(n,o)=>typeof o=="string"&&o.match(/^\d+n$/)?BigInt(o.substring(0,o.length-1)):o)};function Zs(c){if(typeof c!="string")throw new Error(`Cannot safe json parse value of type ${typeof c}`);try{return _1(c)}catch{return c}}function ki(c){return typeof c=="string"?c:w1(c)||""}const b1="idb-keyval";var E1=(c={})=>{const r=c.base&&c.base.length>0?`${c.base}:`:"",i=o=>r+o;let n;return c.dbName&&c.storeName&&(n=Xl(c.dbName,c.storeName)),{name:b1,options:c,async hasItem(o){return!(typeof await Uh(i(o),n)>"u")},async getItem(o){return await Uh(i(o),n)??null},setItem(o,h){return d1(i(o),h,n)},removeItem(o){return g1(i(o),n)},getKeys(){return m1(n)},clear(){return v1(n)}}};const I1="WALLET_CONNECT_V2_INDEXED_DB",x1="keyvaluestorage";let P1=class{constructor(){this.indexedDb=p1({driver:E1({dbName:I1,storeName:x1})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(r=>[r.key,r.value])}async getItem(r){const i=await this.indexedDb.getItem(r);if(i!==null)return i}async setItem(r,i){await this.indexedDb.setItem(r,ki(i))}async removeItem(r){await this.indexedDb.removeItem(r)}};var Za=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},vo={exports:{}};(function(){let c;function r(){}c=r,c.prototype.getItem=function(i){return this.hasOwnProperty(i)?String(this[i]):null},c.prototype.setItem=function(i,n){this[i]=String(n)},c.prototype.removeItem=function(i){delete this[i]},c.prototype.clear=function(){const i=this;Object.keys(i).forEach(function(n){i[n]=void 0,delete i[n]})},c.prototype.key=function(i){return i=i||0,Object.keys(this)[i]},c.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Za<"u"&&Za.localStorage?vo.exports=Za.localStorage:typeof window<"u"&&window.localStorage?vo.exports=window.localStorage:vo.exports=new r})();function S1(c){var r;return[c[0],Zs((r=c[1])!=null?r:"")]}class C1{constructor(){this.localStorage=vo.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(S1)}async getItem(r){const i=this.localStorage.getItem(r);if(i!==null)return Zs(i)}async setItem(r,i){this.localStorage.setItem(r,ki(i))}async removeItem(r){this.localStorage.removeItem(r)}}const R1="wc_storage_version",Hh=1,O1=async(c,r,i)=>{const n=R1,o=await r.getItem(n);if(o&&o>=Hh){i(r);return}const h=await c.getKeys();if(!h.length){i(r);return}const d=[];for(;h.length;){const v=h.shift();if(!v)continue;const w=v.toLowerCase();if(w.includes("wc@")||w.includes("walletconnect")||w.includes("wc_")||w.includes("wallet_connect")){const y=await c.getItem(v);await r.setItem(v,y),d.push(v)}}await r.setItem(n,Hh),i(r),A1(c,d)},A1=async(c,r)=>{r.length&&r.forEach(async i=>{await c.removeItem(i)})};let T1=class{constructor(){this.initialized=!1,this.setInitialized=i=>{this.storage=i,this.initialized=!0};const r=new C1;this.storage=r;try{const i=new P1;O1(r,i,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(r){return await this.initialize(),this.storage.getItem(r)}async setItem(r,i){return await this.initialize(),this.storage.setItem(r,i)}async removeItem(r){return await this.initialize(),this.storage.removeItem(r)}async initialize(){this.initialized||await new Promise(r=>{const i=setInterval(()=>{this.initialized&&(clearInterval(i),r())},20)})}};var _s={},zs={},ec={},Us={};let Bi=class{};const N1=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Bi},Symbol.toStringTag,{value:"Module"})),$1=Ul(N1);var kh;function D1(){if(kh)return Us;kh=1,Object.defineProperty(Us,"__esModule",{value:!0}),Us.IHeartBeat=void 0;const c=$1;class r extends c.IEvents{constructor(n){super()}}return Us.IHeartBeat=r,Us}var Kh;function Zl(){return Kh||(Kh=1,function(c){Object.defineProperty(c,"__esModule",{value:!0}),ws.__exportStar(D1(),c)}(ec)),ec}var tc={},Ui={},Bh;function F1(){if(Bh)return Ui;Bh=1,Object.defineProperty(Ui,"__esModule",{value:!0}),Ui.HEARTBEAT_EVENTS=Ui.HEARTBEAT_INTERVAL=void 0;const c=ie;return Ui.HEARTBEAT_INTERVAL=c.FIVE_SECONDS,Ui.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Ui}var Vh;function ef(){return Vh||(Vh=1,function(c){Object.defineProperty(c,"__esModule",{value:!0}),ws.__exportStar(F1(),c)}(tc)),tc}var Gh;function L1(){if(Gh)return zs;Gh=1,Object.defineProperty(zs,"__esModule",{value:!0}),zs.HeartBeat=void 0;const c=ws,r=Cr,i=ie,n=Zl(),o=ef();class h extends n.IHeartBeat{constructor(v){super(v),this.events=new r.EventEmitter,this.interval=o.HEARTBEAT_INTERVAL,this.interval=(v==null?void 0:v.interval)||o.HEARTBEAT_INTERVAL}static init(v){return c.__awaiter(this,void 0,void 0,function*(){const w=new h(v);return yield w.init(),w})}init(){return c.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(v,w){this.events.on(v,w)}once(v,w){this.events.once(v,w)}off(v,w){this.events.off(v,w)}removeListener(v,w){this.events.removeListener(v,w)}initialize(){return c.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),i.toMiliseconds(this.interval))})}pulse(){this.events.emit(o.HEARTBEAT_EVENTS.pulse)}}return zs.HeartBeat=h,zs}(function(c){Object.defineProperty(c,"__esModule",{value:!0});const r=ws;r.__exportStar(L1(),c),r.__exportStar(Zl(),c),r.__exportStar(ef(),c)})(_s);var Se={},rc,Wh;function q1(){if(Wh)return rc;Wh=1;function c(i){try{return JSON.stringify(i)}catch{return'"[Circular]"'}}rc=r;function r(i,n,o){var h=o&&o.stringify||c,d=1;if(typeof i=="object"&&i!==null){var v=n.length+d;if(v===1)return i;var w=new Array(v);w[0]=h(i);for(var y=1;y<v;y++)w[y]=h(n[y]);return w.join(" ")}if(typeof i!="string")return i;var E=n.length;if(E===0)return i;for(var C="",O=1-d,j=-1,D=i&&i.length||0,K=0;K<D;){if(i.charCodeAt(K)===37&&K+1<D){switch(j=j>-1?j:0,i.charCodeAt(K+1)){case 100:case 102:if(O>=E||n[O]==null)break;j<K&&(C+=i.slice(j,K)),C+=Number(n[O]),j=K+2,K++;break;case 105:if(O>=E||n[O]==null)break;j<K&&(C+=i.slice(j,K)),C+=Math.floor(Number(n[O])),j=K+2,K++;break;case 79:case 111:case 106:if(O>=E||n[O]===void 0)break;j<K&&(C+=i.slice(j,K));var re=typeof n[O];if(re==="string"){C+="'"+n[O]+"'",j=K+2,K++;break}if(re==="function"){C+=n[O].name||"<anonymous>",j=K+2,K++;break}C+=h(n[O]),j=K+2,K++;break;case 115:if(O>=E)break;j<K&&(C+=i.slice(j,K)),C+=String(n[O]),j=K+2,K++;break;case 37:j<K&&(C+=i.slice(j,K)),C+="%",j=K+2,K++,O--;break}++O}++K}return j===-1?i:(j<D&&(C+=i.slice(j)),C)}return rc}var ic,Jh;function M1(){if(Jh)return ic;Jh=1;const c=q1();ic=o;const r=pe().console||{},i={mapHttpRequest:D,mapHttpResponse:D,wrapRequestSerializer:K,wrapResponseSerializer:K,wrapErrorSerializer:K,req:D,res:D,err:O};function n($,H){return Array.isArray($)?$.filter(function(ve){return ve!=="!stdSerializers.err"}):$===!0?Object.keys(H):!1}function o($){$=$||{},$.browser=$.browser||{};const H=$.browser.transmit;if(H&&typeof H.send!="function")throw Error("pino: transmit option must have a send function");const W=$.browser.write||r;$.browser.write&&($.browser.asObject=!0);const ve=$.serializers||{},te=n($.browser.serialize,ve);let Ee=$.browser.serialize;Array.isArray($.browser.serialize)&&$.browser.serialize.indexOf("!stdSerializers.err")>-1&&(Ee=!1);const Oe=["error","fatal","warn","info","debug","trace"];typeof W=="function"&&(W.error=W.fatal=W.warn=W.info=W.debug=W.trace=W),$.enabled===!1&&($.level="silent");const et=$.level||"info",A=Object.create(W);A.log||(A.log=re),Object.defineProperty(A,"levelVal",{get:je}),Object.defineProperty(A,"level",{get:Ae,set:J});const M={transmit:H,serialize:te,asObject:$.browser.asObject,levels:Oe,timestamp:j($)};A.levels=o.levels,A.level=et,A.setMaxListeners=A.getMaxListeners=A.emit=A.addListener=A.on=A.prependListener=A.once=A.prependOnceListener=A.removeListener=A.removeAllListeners=A.listeners=A.listenerCount=A.eventNames=A.write=A.flush=re,A.serializers=ve,A._serialize=te,A._stdErrSerialize=Ee,A.child=B,H&&(A._logEvent=C());function je(){return this.level==="silent"?1/0:this.levels.values[this.level]}function Ae(){return this._level}function J(k){if(k!=="silent"&&!this.levels.values[k])throw Error("unknown level "+k);this._level=k,h(M,A,"error","log"),h(M,A,"fatal","error"),h(M,A,"warn","error"),h(M,A,"info","log"),h(M,A,"debug","log"),h(M,A,"trace","log")}function B(k,V){if(!k)throw new Error("missing bindings for child Pino");V=V||{},te&&k.serializers&&(V.serializers=k.serializers);const ut=V.serializers;if(te&&ut){var He=Object.assign({},ve,ut),qr=$.browser.serialize===!0?Object.keys(He):te;delete k.serializers,w([k],qr,He,this._stdErrSerialize)}function _e(It){this._childLevel=(It._childLevel|0)+1,this.error=y(It,k,"error"),this.fatal=y(It,k,"fatal"),this.warn=y(It,k,"warn"),this.info=y(It,k,"info"),this.debug=y(It,k,"debug"),this.trace=y(It,k,"trace"),He&&(this.serializers=He,this._serialize=qr),H&&(this._logEvent=C([].concat(It._logEvent.bindings,k)))}return _e.prototype=this,new _e(this)}return A}o.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},o.stdSerializers=i,o.stdTimeFunctions=Object.assign({},{nullTime:ce,epochTime:ue,unixTime:he,isoTime:fe});function h($,H,W,ve){const te=Object.getPrototypeOf(H);H[W]=H.levelVal>H.levels.values[W]?re:te[W]?te[W]:r[W]||r[ve]||re,d($,H,W)}function d($,H,W){!$.transmit&&H[W]===re||(H[W]=function(ve){return function(){const Ee=$.timestamp(),Oe=new Array(arguments.length),et=Object.getPrototypeOf&&Object.getPrototypeOf(this)===r?r:this;for(var A=0;A<Oe.length;A++)Oe[A]=arguments[A];if($.serialize&&!$.asObject&&w(Oe,this._serialize,this.serializers,this._stdErrSerialize),$.asObject?ve.call(et,v(this,W,Oe,Ee)):ve.apply(et,Oe),$.transmit){const M=$.transmit.level||H.level,je=o.levels.values[M],Ae=o.levels.values[W];if(Ae<je)return;E(this,{ts:Ee,methodLevel:W,methodValue:Ae,transmitLevel:M,transmitValue:o.levels.values[$.transmit.level||H.level],send:$.transmit.send,val:H.levelVal},Oe)}}}(H[W]))}function v($,H,W,ve){$._serialize&&w(W,$._serialize,$.serializers,$._stdErrSerialize);const te=W.slice();let Ee=te[0];const Oe={};ve&&(Oe.time=ve),Oe.level=o.levels.values[H];let et=($._childLevel|0)+1;if(et<1&&(et=1),Ee!==null&&typeof Ee=="object"){for(;et--&&typeof te[0]=="object";)Object.assign(Oe,te.shift());Ee=te.length?c(te.shift(),te):void 0}else typeof Ee=="string"&&(Ee=c(te.shift(),te));return Ee!==void 0&&(Oe.msg=Ee),Oe}function w($,H,W,ve){for(const te in $)if(ve&&$[te]instanceof Error)$[te]=o.stdSerializers.err($[te]);else if(typeof $[te]=="object"&&!Array.isArray($[te]))for(const Ee in $[te])H&&H.indexOf(Ee)>-1&&Ee in W&&($[te][Ee]=W[Ee]($[te][Ee]))}function y($,H,W){return function(){const ve=new Array(1+arguments.length);ve[0]=H;for(var te=1;te<ve.length;te++)ve[te]=arguments[te-1];return $[W].apply(this,ve)}}function E($,H,W){const ve=H.send,te=H.ts,Ee=H.methodLevel,Oe=H.methodValue,et=H.val,A=$._logEvent.bindings;w(W,$._serialize||Object.keys($.serializers),$.serializers,$._stdErrSerialize===void 0?!0:$._stdErrSerialize),$._logEvent.ts=te,$._logEvent.messages=W.filter(function(M){return A.indexOf(M)===-1}),$._logEvent.level.label=Ee,$._logEvent.level.value=Oe,ve(Ee,$._logEvent,et),$._logEvent=C(A)}function C($){return{ts:0,messages:[],bindings:$||[],level:{label:"",value:0}}}function O($){const H={type:$.constructor.name,msg:$.message,stack:$.stack};for(const W in $)H[W]===void 0&&(H[W]=$[W]);return H}function j($){return typeof $.timestamp=="function"?$.timestamp:$.timestamp===!1?ce:ue}function D(){return{}}function K($){return $}function re(){}function ce(){return!1}function ue(){return Date.now()}function he(){return Math.round(Date.now()/1e3)}function fe(){return new Date(Date.now()).toISOString()}function pe(){function $(H){return typeof H<"u"&&H}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return $(self)||$(window)||$(this)||{}}}return ic}var Hi={},Qh;function tf(){return Qh||(Qh=1,Object.defineProperty(Hi,"__esModule",{value:!0}),Hi.PINO_CUSTOM_CONTEXT_KEY=Hi.PINO_LOGGER_DEFAULTS=void 0,Hi.PINO_LOGGER_DEFAULTS={level:"info"},Hi.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Hi}var tr={},Yh;function j1(){if(Yh)return tr;Yh=1,Object.defineProperty(tr,"__esModule",{value:!0}),tr.generateChildLogger=tr.formatChildLoggerContext=tr.getLoggerContext=tr.setBrowserLoggerContext=tr.getBrowserLoggerContext=tr.getDefaultLoggerOptions=void 0;const c=tf();function r(v){return Object.assign(Object.assign({},v),{level:(v==null?void 0:v.level)||c.PINO_LOGGER_DEFAULTS.level})}tr.getDefaultLoggerOptions=r;function i(v,w=c.PINO_CUSTOM_CONTEXT_KEY){return v[w]||""}tr.getBrowserLoggerContext=i;function n(v,w,y=c.PINO_CUSTOM_CONTEXT_KEY){return v[y]=w,v}tr.setBrowserLoggerContext=n;function o(v,w=c.PINO_CUSTOM_CONTEXT_KEY){let y="";return typeof v.bindings>"u"?y=i(v,w):y=v.bindings().context||"",y}tr.getLoggerContext=o;function h(v,w,y=c.PINO_CUSTOM_CONTEXT_KEY){const E=o(v,y);return E.trim()?`${E}/${w}`:w}tr.formatChildLoggerContext=h;function d(v,w,y=c.PINO_CUSTOM_CONTEXT_KEY){const E=h(v,w,y),C=v.child({context:E});return n(C,E,y)}return tr.generateChildLogger=d,tr}(function(c){Object.defineProperty(c,"__esModule",{value:!0}),c.pino=void 0;const r=ws,i=r.__importDefault(M1());Object.defineProperty(c,"pino",{enumerable:!0,get:function(){return i.default}}),r.__exportStar(tf(),c),r.__exportStar(j1(),c)})(Se);class z1 extends Bi{constructor(r){super(),this.opts=r,this.protocol="wc",this.version=2}}let U1=class extends Bi{constructor(r,i){super(),this.core=r,this.logger=i,this.records=new Map}},H1=class{constructor(r,i){this.logger=r,this.core=i}},k1=class extends Bi{constructor(r,i){super(),this.relayer=r,this.logger=i}},K1=class extends Bi{constructor(r){super()}},B1=class{constructor(r,i,n,o){this.core=r,this.logger=i,this.name=n}};class V1 extends Bi{constructor(r,i){super(),this.relayer=r,this.logger=i}}let G1=class extends Bi{constructor(r,i){super(),this.core=r,this.logger=i}},W1=class{constructor(r,i){this.projectId=r,this.logger=i}},J1=class{constructor(r,i){this.projectId=r,this.logger=i}},Q1=class{constructor(r){this.opts=r,this.protocol="wc",this.version=2}},Y1=class{constructor(r){this.client=r}};var xc={},rf={};(function(c){Object.defineProperty(c,"__esModule",{value:!0});var r=fm,i=Hl;c.DIGEST_LENGTH=64,c.BLOCK_SIZE=128;var n=function(){function v(){this.digestLength=c.DIGEST_LENGTH,this.blockSize=c.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return v.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},v.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},v.prototype.clean=function(){i.wipe(this._buffer),i.wipe(this._tempHi),i.wipe(this._tempLo),this.reset()},v.prototype.update=function(w,y){if(y===void 0&&(y=w.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var E=0;if(this._bytesHashed+=y,this._bufferLength>0){for(;this._bufferLength<c.BLOCK_SIZE&&y>0;)this._buffer[this._bufferLength++]=w[E++],y--;this._bufferLength===this.blockSize&&(h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(y>=this.blockSize&&(E=h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,w,E,y),y%=this.blockSize);y>0;)this._buffer[this._bufferLength++]=w[E++],y--;return this},v.prototype.finish=function(w){if(!this._finished){var y=this._bytesHashed,E=this._bufferLength,C=y/536870912|0,O=y<<3,j=y%128<112?128:256;this._buffer[E]=128;for(var D=E+1;D<j-8;D++)this._buffer[D]=0;r.writeUint32BE(C,this._buffer,j-8),r.writeUint32BE(O,this._buffer,j-4),h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,j),this._finished=!0}for(var D=0;D<this.digestLength/8;D++)r.writeUint32BE(this._stateHi[D],w,D*8),r.writeUint32BE(this._stateLo[D],w,D*8+4);return this},v.prototype.digest=function(){var w=new Uint8Array(this.digestLength);return this.finish(w),w},v.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},v.prototype.restoreState=function(w){return this._stateHi.set(w.stateHi),this._stateLo.set(w.stateLo),this._bufferLength=w.bufferLength,w.buffer&&this._buffer.set(w.buffer),this._bytesHashed=w.bytesHashed,this._finished=!1,this},v.prototype.cleanSavedState=function(w){i.wipe(w.stateHi),i.wipe(w.stateLo),w.buffer&&i.wipe(w.buffer),w.bufferLength=0,w.bytesHashed=0},v}();c.SHA512=n;var o=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function h(v,w,y,E,C,O,j){for(var D=y[0],K=y[1],re=y[2],ce=y[3],ue=y[4],he=y[5],fe=y[6],pe=y[7],$=E[0],H=E[1],W=E[2],ve=E[3],te=E[4],Ee=E[5],Oe=E[6],et=E[7],A,M,je,Ae,J,B,k,V;j>=128;){for(var ut=0;ut<16;ut++){var He=8*ut+O;v[ut]=r.readUint32BE(C,He),w[ut]=r.readUint32BE(C,He+4)}for(var ut=0;ut<80;ut++){var qr=D,_e=K,It=re,N=ce,T=ue,S=he,u=fe,b=pe,Z=$,ae=H,me=W,Te=ve,$e=te,xe=Ee,xt=Oe,mt=et;if(A=pe,M=et,J=M&65535,B=M>>>16,k=A&65535,V=A>>>16,A=(ue>>>14|te<<32-14)^(ue>>>18|te<<32-18)^(te>>>41-32|ue<<32-(41-32)),M=(te>>>14|ue<<32-14)^(te>>>18|ue<<32-18)^(ue>>>41-32|te<<32-(41-32)),J+=M&65535,B+=M>>>16,k+=A&65535,V+=A>>>16,A=ue&he^~ue&fe,M=te&Ee^~te&Oe,J+=M&65535,B+=M>>>16,k+=A&65535,V+=A>>>16,A=o[ut*2],M=o[ut*2+1],J+=M&65535,B+=M>>>16,k+=A&65535,V+=A>>>16,A=v[ut%16],M=w[ut%16],J+=M&65535,B+=M>>>16,k+=A&65535,V+=A>>>16,B+=J>>>16,k+=B>>>16,V+=k>>>16,je=k&65535|V<<16,Ae=J&65535|B<<16,A=je,M=Ae,J=M&65535,B=M>>>16,k=A&65535,V=A>>>16,A=(D>>>28|$<<32-28)^($>>>34-32|D<<32-(34-32))^($>>>39-32|D<<32-(39-32)),M=($>>>28|D<<32-28)^(D>>>34-32|$<<32-(34-32))^(D>>>39-32|$<<32-(39-32)),J+=M&65535,B+=M>>>16,k+=A&65535,V+=A>>>16,A=D&K^D&re^K&re,M=$&H^$&W^H&W,J+=M&65535,B+=M>>>16,k+=A&65535,V+=A>>>16,B+=J>>>16,k+=B>>>16,V+=k>>>16,b=k&65535|V<<16,mt=J&65535|B<<16,A=N,M=Te,J=M&65535,B=M>>>16,k=A&65535,V=A>>>16,A=je,M=Ae,J+=M&65535,B+=M>>>16,k+=A&65535,V+=A>>>16,B+=J>>>16,k+=B>>>16,V+=k>>>16,N=k&65535|V<<16,Te=J&65535|B<<16,K=qr,re=_e,ce=It,ue=N,he=T,fe=S,pe=u,D=b,H=Z,W=ae,ve=me,te=Te,Ee=$e,Oe=xe,et=xt,$=mt,ut%16===15)for(var He=0;He<16;He++)A=v[He],M=w[He],J=M&65535,B=M>>>16,k=A&65535,V=A>>>16,A=v[(He+9)%16],M=w[(He+9)%16],J+=M&65535,B+=M>>>16,k+=A&65535,V+=A>>>16,je=v[(He+1)%16],Ae=w[(He+1)%16],A=(je>>>1|Ae<<32-1)^(je>>>8|Ae<<32-8)^je>>>7,M=(Ae>>>1|je<<32-1)^(Ae>>>8|je<<32-8)^(Ae>>>7|je<<32-7),J+=M&65535,B+=M>>>16,k+=A&65535,V+=A>>>16,je=v[(He+14)%16],Ae=w[(He+14)%16],A=(je>>>19|Ae<<32-19)^(Ae>>>61-32|je<<32-(61-32))^je>>>6,M=(Ae>>>19|je<<32-19)^(je>>>61-32|Ae<<32-(61-32))^(Ae>>>6|je<<32-6),J+=M&65535,B+=M>>>16,k+=A&65535,V+=A>>>16,B+=J>>>16,k+=B>>>16,V+=k>>>16,v[He]=k&65535|V<<16,w[He]=J&65535|B<<16}A=D,M=$,J=M&65535,B=M>>>16,k=A&65535,V=A>>>16,A=y[0],M=E[0],J+=M&65535,B+=M>>>16,k+=A&65535,V+=A>>>16,B+=J>>>16,k+=B>>>16,V+=k>>>16,y[0]=D=k&65535|V<<16,E[0]=$=J&65535|B<<16,A=K,M=H,J=M&65535,B=M>>>16,k=A&65535,V=A>>>16,A=y[1],M=E[1],J+=M&65535,B+=M>>>16,k+=A&65535,V+=A>>>16,B+=J>>>16,k+=B>>>16,V+=k>>>16,y[1]=K=k&65535|V<<16,E[1]=H=J&65535|B<<16,A=re,M=W,J=M&65535,B=M>>>16,k=A&65535,V=A>>>16,A=y[2],M=E[2],J+=M&65535,B+=M>>>16,k+=A&65535,V+=A>>>16,B+=J>>>16,k+=B>>>16,V+=k>>>16,y[2]=re=k&65535|V<<16,E[2]=W=J&65535|B<<16,A=ce,M=ve,J=M&65535,B=M>>>16,k=A&65535,V=A>>>16,A=y[3],M=E[3],J+=M&65535,B+=M>>>16,k+=A&65535,V+=A>>>16,B+=J>>>16,k+=B>>>16,V+=k>>>16,y[3]=ce=k&65535|V<<16,E[3]=ve=J&65535|B<<16,A=ue,M=te,J=M&65535,B=M>>>16,k=A&65535,V=A>>>16,A=y[4],M=E[4],J+=M&65535,B+=M>>>16,k+=A&65535,V+=A>>>16,B+=J>>>16,k+=B>>>16,V+=k>>>16,y[4]=ue=k&65535|V<<16,E[4]=te=J&65535|B<<16,A=he,M=Ee,J=M&65535,B=M>>>16,k=A&65535,V=A>>>16,A=y[5],M=E[5],J+=M&65535,B+=M>>>16,k+=A&65535,V+=A>>>16,B+=J>>>16,k+=B>>>16,V+=k>>>16,y[5]=he=k&65535|V<<16,E[5]=Ee=J&65535|B<<16,A=fe,M=Oe,J=M&65535,B=M>>>16,k=A&65535,V=A>>>16,A=y[6],M=E[6],J+=M&65535,B+=M>>>16,k+=A&65535,V+=A>>>16,B+=J>>>16,k+=B>>>16,V+=k>>>16,y[6]=fe=k&65535|V<<16,E[6]=Oe=J&65535|B<<16,A=pe,M=et,J=M&65535,B=M>>>16,k=A&65535,V=A>>>16,A=y[7],M=E[7],J+=M&65535,B+=M>>>16,k+=A&65535,V+=A>>>16,B+=J>>>16,k+=B>>>16,V+=k>>>16,y[7]=pe=k&65535|V<<16,E[7]=et=J&65535|B<<16,O+=128,j-=128}return O}function d(v){var w=new n;w.update(v);var y=w.digest();return w.clean(),y}c.hash=d})(rf);(function(c){Object.defineProperty(c,"__esModule",{value:!0}),c.convertSecretKeyToX25519=c.convertPublicKeyToX25519=c.verify=c.sign=c.extractPublicKeyFromSecretKey=c.generateKeyPair=c.generateKeyPairFromSeed=c.SEED_LENGTH=c.SECRET_KEY_LENGTH=c.PUBLIC_KEY_LENGTH=c.SIGNATURE_LENGTH=void 0;const r=kl,i=rf,n=Hl;c.SIGNATURE_LENGTH=64,c.PUBLIC_KEY_LENGTH=32,c.SECRET_KEY_LENGTH=64,c.SEED_LENGTH=32;function o(N){const T=new Float64Array(16);if(N)for(let S=0;S<N.length;S++)T[S]=N[S];return T}const h=new Uint8Array(32);h[0]=9;const d=o(),v=o([1]),w=o([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),y=o([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),E=o([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),C=o([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),O=o([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function j(N,T){for(let S=0;S<16;S++)N[S]=T[S]|0}function D(N){let T=1;for(let S=0;S<16;S++){let u=N[S]+T+65535;T=Math.floor(u/65536),N[S]=u-T*65536}N[0]+=T-1+37*(T-1)}function K(N,T,S){const u=~(S-1);for(let b=0;b<16;b++){const Z=u&(N[b]^T[b]);N[b]^=Z,T[b]^=Z}}function re(N,T){const S=o(),u=o();for(let b=0;b<16;b++)u[b]=T[b];D(u),D(u),D(u);for(let b=0;b<2;b++){S[0]=u[0]-65517;for(let ae=1;ae<15;ae++)S[ae]=u[ae]-65535-(S[ae-1]>>16&1),S[ae-1]&=65535;S[15]=u[15]-32767-(S[14]>>16&1);const Z=S[15]>>16&1;S[14]&=65535,K(u,S,1-Z)}for(let b=0;b<16;b++)N[2*b]=u[b]&255,N[2*b+1]=u[b]>>8}function ce(N,T){let S=0;for(let u=0;u<32;u++)S|=N[u]^T[u];return(1&S-1>>>8)-1}function ue(N,T){const S=new Uint8Array(32),u=new Uint8Array(32);return re(S,N),re(u,T),ce(S,u)}function he(N){const T=new Uint8Array(32);return re(T,N),T[0]&1}function fe(N,T){for(let S=0;S<16;S++)N[S]=T[2*S]+(T[2*S+1]<<8);N[15]&=32767}function pe(N,T,S){for(let u=0;u<16;u++)N[u]=T[u]+S[u]}function $(N,T,S){for(let u=0;u<16;u++)N[u]=T[u]-S[u]}function H(N,T,S){let u,b,Z=0,ae=0,me=0,Te=0,$e=0,xe=0,xt=0,mt=0,nt=0,Fe=0,Je=0,Qe=0,ot=0,ze=0,Ye=0,Ne=0,ke=0,ht=0,qe=0,Pt=0,Dt=0,Ut=0,Ht=0,qt=0,Jt=0,rr=0,Mr=0,Qt=0,Vr=0,li=0,Ci=0,lt=S[0],tt=S[1],ft=S[2],pt=S[3],at=S[4],rt=S[5],St=S[6],Ct=S[7],dt=S[8],Rt=S[9],gt=S[10],wt=S[11],vt=S[12],We=S[13],Ot=S[14],At=S[15];u=T[0],Z+=u*lt,ae+=u*tt,me+=u*ft,Te+=u*pt,$e+=u*at,xe+=u*rt,xt+=u*St,mt+=u*Ct,nt+=u*dt,Fe+=u*Rt,Je+=u*gt,Qe+=u*wt,ot+=u*vt,ze+=u*We,Ye+=u*Ot,Ne+=u*At,u=T[1],ae+=u*lt,me+=u*tt,Te+=u*ft,$e+=u*pt,xe+=u*at,xt+=u*rt,mt+=u*St,nt+=u*Ct,Fe+=u*dt,Je+=u*Rt,Qe+=u*gt,ot+=u*wt,ze+=u*vt,Ye+=u*We,Ne+=u*Ot,ke+=u*At,u=T[2],me+=u*lt,Te+=u*tt,$e+=u*ft,xe+=u*pt,xt+=u*at,mt+=u*rt,nt+=u*St,Fe+=u*Ct,Je+=u*dt,Qe+=u*Rt,ot+=u*gt,ze+=u*wt,Ye+=u*vt,Ne+=u*We,ke+=u*Ot,ht+=u*At,u=T[3],Te+=u*lt,$e+=u*tt,xe+=u*ft,xt+=u*pt,mt+=u*at,nt+=u*rt,Fe+=u*St,Je+=u*Ct,Qe+=u*dt,ot+=u*Rt,ze+=u*gt,Ye+=u*wt,Ne+=u*vt,ke+=u*We,ht+=u*Ot,qe+=u*At,u=T[4],$e+=u*lt,xe+=u*tt,xt+=u*ft,mt+=u*pt,nt+=u*at,Fe+=u*rt,Je+=u*St,Qe+=u*Ct,ot+=u*dt,ze+=u*Rt,Ye+=u*gt,Ne+=u*wt,ke+=u*vt,ht+=u*We,qe+=u*Ot,Pt+=u*At,u=T[5],xe+=u*lt,xt+=u*tt,mt+=u*ft,nt+=u*pt,Fe+=u*at,Je+=u*rt,Qe+=u*St,ot+=u*Ct,ze+=u*dt,Ye+=u*Rt,Ne+=u*gt,ke+=u*wt,ht+=u*vt,qe+=u*We,Pt+=u*Ot,Dt+=u*At,u=T[6],xt+=u*lt,mt+=u*tt,nt+=u*ft,Fe+=u*pt,Je+=u*at,Qe+=u*rt,ot+=u*St,ze+=u*Ct,Ye+=u*dt,Ne+=u*Rt,ke+=u*gt,ht+=u*wt,qe+=u*vt,Pt+=u*We,Dt+=u*Ot,Ut+=u*At,u=T[7],mt+=u*lt,nt+=u*tt,Fe+=u*ft,Je+=u*pt,Qe+=u*at,ot+=u*rt,ze+=u*St,Ye+=u*Ct,Ne+=u*dt,ke+=u*Rt,ht+=u*gt,qe+=u*wt,Pt+=u*vt,Dt+=u*We,Ut+=u*Ot,Ht+=u*At,u=T[8],nt+=u*lt,Fe+=u*tt,Je+=u*ft,Qe+=u*pt,ot+=u*at,ze+=u*rt,Ye+=u*St,Ne+=u*Ct,ke+=u*dt,ht+=u*Rt,qe+=u*gt,Pt+=u*wt,Dt+=u*vt,Ut+=u*We,Ht+=u*Ot,qt+=u*At,u=T[9],Fe+=u*lt,Je+=u*tt,Qe+=u*ft,ot+=u*pt,ze+=u*at,Ye+=u*rt,Ne+=u*St,ke+=u*Ct,ht+=u*dt,qe+=u*Rt,Pt+=u*gt,Dt+=u*wt,Ut+=u*vt,Ht+=u*We,qt+=u*Ot,Jt+=u*At,u=T[10],Je+=u*lt,Qe+=u*tt,ot+=u*ft,ze+=u*pt,Ye+=u*at,Ne+=u*rt,ke+=u*St,ht+=u*Ct,qe+=u*dt,Pt+=u*Rt,Dt+=u*gt,Ut+=u*wt,Ht+=u*vt,qt+=u*We,Jt+=u*Ot,rr+=u*At,u=T[11],Qe+=u*lt,ot+=u*tt,ze+=u*ft,Ye+=u*pt,Ne+=u*at,ke+=u*rt,ht+=u*St,qe+=u*Ct,Pt+=u*dt,Dt+=u*Rt,Ut+=u*gt,Ht+=u*wt,qt+=u*vt,Jt+=u*We,rr+=u*Ot,Mr+=u*At,u=T[12],ot+=u*lt,ze+=u*tt,Ye+=u*ft,Ne+=u*pt,ke+=u*at,ht+=u*rt,qe+=u*St,Pt+=u*Ct,Dt+=u*dt,Ut+=u*Rt,Ht+=u*gt,qt+=u*wt,Jt+=u*vt,rr+=u*We,Mr+=u*Ot,Qt+=u*At,u=T[13],ze+=u*lt,Ye+=u*tt,Ne+=u*ft,ke+=u*pt,ht+=u*at,qe+=u*rt,Pt+=u*St,Dt+=u*Ct,Ut+=u*dt,Ht+=u*Rt,qt+=u*gt,Jt+=u*wt,rr+=u*vt,Mr+=u*We,Qt+=u*Ot,Vr+=u*At,u=T[14],Ye+=u*lt,Ne+=u*tt,ke+=u*ft,ht+=u*pt,qe+=u*at,Pt+=u*rt,Dt+=u*St,Ut+=u*Ct,Ht+=u*dt,qt+=u*Rt,Jt+=u*gt,rr+=u*wt,Mr+=u*vt,Qt+=u*We,Vr+=u*Ot,li+=u*At,u=T[15],Ne+=u*lt,ke+=u*tt,ht+=u*ft,qe+=u*pt,Pt+=u*at,Dt+=u*rt,Ut+=u*St,Ht+=u*Ct,qt+=u*dt,Jt+=u*Rt,rr+=u*gt,Mr+=u*wt,Qt+=u*vt,Vr+=u*We,li+=u*Ot,Ci+=u*At,Z+=38*ke,ae+=38*ht,me+=38*qe,Te+=38*Pt,$e+=38*Dt,xe+=38*Ut,xt+=38*Ht,mt+=38*qt,nt+=38*Jt,Fe+=38*rr,Je+=38*Mr,Qe+=38*Qt,ot+=38*Vr,ze+=38*li,Ye+=38*Ci,b=1,u=Z+b+65535,b=Math.floor(u/65536),Z=u-b*65536,u=ae+b+65535,b=Math.floor(u/65536),ae=u-b*65536,u=me+b+65535,b=Math.floor(u/65536),me=u-b*65536,u=Te+b+65535,b=Math.floor(u/65536),Te=u-b*65536,u=$e+b+65535,b=Math.floor(u/65536),$e=u-b*65536,u=xe+b+65535,b=Math.floor(u/65536),xe=u-b*65536,u=xt+b+65535,b=Math.floor(u/65536),xt=u-b*65536,u=mt+b+65535,b=Math.floor(u/65536),mt=u-b*65536,u=nt+b+65535,b=Math.floor(u/65536),nt=u-b*65536,u=Fe+b+65535,b=Math.floor(u/65536),Fe=u-b*65536,u=Je+b+65535,b=Math.floor(u/65536),Je=u-b*65536,u=Qe+b+65535,b=Math.floor(u/65536),Qe=u-b*65536,u=ot+b+65535,b=Math.floor(u/65536),ot=u-b*65536,u=ze+b+65535,b=Math.floor(u/65536),ze=u-b*65536,u=Ye+b+65535,b=Math.floor(u/65536),Ye=u-b*65536,u=Ne+b+65535,b=Math.floor(u/65536),Ne=u-b*65536,Z+=b-1+37*(b-1),b=1,u=Z+b+65535,b=Math.floor(u/65536),Z=u-b*65536,u=ae+b+65535,b=Math.floor(u/65536),ae=u-b*65536,u=me+b+65535,b=Math.floor(u/65536),me=u-b*65536,u=Te+b+65535,b=Math.floor(u/65536),Te=u-b*65536,u=$e+b+65535,b=Math.floor(u/65536),$e=u-b*65536,u=xe+b+65535,b=Math.floor(u/65536),xe=u-b*65536,u=xt+b+65535,b=Math.floor(u/65536),xt=u-b*65536,u=mt+b+65535,b=Math.floor(u/65536),mt=u-b*65536,u=nt+b+65535,b=Math.floor(u/65536),nt=u-b*65536,u=Fe+b+65535,b=Math.floor(u/65536),Fe=u-b*65536,u=Je+b+65535,b=Math.floor(u/65536),Je=u-b*65536,u=Qe+b+65535,b=Math.floor(u/65536),Qe=u-b*65536,u=ot+b+65535,b=Math.floor(u/65536),ot=u-b*65536,u=ze+b+65535,b=Math.floor(u/65536),ze=u-b*65536,u=Ye+b+65535,b=Math.floor(u/65536),Ye=u-b*65536,u=Ne+b+65535,b=Math.floor(u/65536),Ne=u-b*65536,Z+=b-1+37*(b-1),N[0]=Z,N[1]=ae,N[2]=me,N[3]=Te,N[4]=$e,N[5]=xe,N[6]=xt,N[7]=mt,N[8]=nt,N[9]=Fe,N[10]=Je,N[11]=Qe,N[12]=ot,N[13]=ze,N[14]=Ye,N[15]=Ne}function W(N,T){H(N,T,T)}function ve(N,T){const S=o();let u;for(u=0;u<16;u++)S[u]=T[u];for(u=253;u>=0;u--)W(S,S),u!==2&&u!==4&&H(S,S,T);for(u=0;u<16;u++)N[u]=S[u]}function te(N,T){const S=o();let u;for(u=0;u<16;u++)S[u]=T[u];for(u=250;u>=0;u--)W(S,S),u!==1&&H(S,S,T);for(u=0;u<16;u++)N[u]=S[u]}function Ee(N,T){const S=o(),u=o(),b=o(),Z=o(),ae=o(),me=o(),Te=o(),$e=o(),xe=o();$(S,N[1],N[0]),$(xe,T[1],T[0]),H(S,S,xe),pe(u,N[0],N[1]),pe(xe,T[0],T[1]),H(u,u,xe),H(b,N[3],T[3]),H(b,b,y),H(Z,N[2],T[2]),pe(Z,Z,Z),$(ae,u,S),$(me,Z,b),pe(Te,Z,b),pe($e,u,S),H(N[0],ae,me),H(N[1],$e,Te),H(N[2],Te,me),H(N[3],ae,$e)}function Oe(N,T,S){for(let u=0;u<4;u++)K(N[u],T[u],S)}function et(N,T){const S=o(),u=o(),b=o();ve(b,T[2]),H(S,T[0],b),H(u,T[1],b),re(N,u),N[31]^=he(S)<<7}function A(N,T,S){j(N[0],d),j(N[1],v),j(N[2],v),j(N[3],d);for(let u=255;u>=0;--u){const b=S[u/8|0]>>(u&7)&1;Oe(N,T,b),Ee(T,N),Ee(N,N),Oe(N,T,b)}}function M(N,T){const S=[o(),o(),o(),o()];j(S[0],E),j(S[1],C),j(S[2],v),H(S[3],E,C),A(N,S,T)}function je(N){if(N.length!==c.SEED_LENGTH)throw new Error(`ed25519: seed must be ${c.SEED_LENGTH} bytes`);const T=(0,i.hash)(N);T[0]&=248,T[31]&=127,T[31]|=64;const S=new Uint8Array(32),u=[o(),o(),o(),o()];M(u,T),et(S,u);const b=new Uint8Array(64);return b.set(N),b.set(S,32),{publicKey:S,secretKey:b}}c.generateKeyPairFromSeed=je;function Ae(N){const T=(0,r.randomBytes)(32,N),S=je(T);return(0,n.wipe)(T),S}c.generateKeyPair=Ae;function J(N){if(N.length!==c.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${c.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(N.subarray(32))}c.extractPublicKeyFromSecretKey=J;const B=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function k(N,T){let S,u,b,Z;for(u=63;u>=32;--u){for(S=0,b=u-32,Z=u-12;b<Z;++b)T[b]+=S-16*T[u]*B[b-(u-32)],S=Math.floor((T[b]+128)/256),T[b]-=S*256;T[b]+=S,T[u]=0}for(S=0,b=0;b<32;b++)T[b]+=S-(T[31]>>4)*B[b],S=T[b]>>8,T[b]&=255;for(b=0;b<32;b++)T[b]-=S*B[b];for(u=0;u<32;u++)T[u+1]+=T[u]>>8,N[u]=T[u]&255}function V(N){const T=new Float64Array(64);for(let S=0;S<64;S++)T[S]=N[S];for(let S=0;S<64;S++)N[S]=0;k(N,T)}function ut(N,T){const S=new Float64Array(64),u=[o(),o(),o(),o()],b=(0,i.hash)(N.subarray(0,32));b[0]&=248,b[31]&=127,b[31]|=64;const Z=new Uint8Array(64);Z.set(b.subarray(32),32);const ae=new i.SHA512;ae.update(Z.subarray(32)),ae.update(T);const me=ae.digest();ae.clean(),V(me),M(u,me),et(Z,u),ae.reset(),ae.update(Z.subarray(0,32)),ae.update(N.subarray(32)),ae.update(T);const Te=ae.digest();V(Te);for(let $e=0;$e<32;$e++)S[$e]=me[$e];for(let $e=0;$e<32;$e++)for(let xe=0;xe<32;xe++)S[$e+xe]+=Te[$e]*b[xe];return k(Z.subarray(32),S),Z}c.sign=ut;function He(N,T){const S=o(),u=o(),b=o(),Z=o(),ae=o(),me=o(),Te=o();return j(N[2],v),fe(N[1],T),W(b,N[1]),H(Z,b,w),$(b,b,N[2]),pe(Z,N[2],Z),W(ae,Z),W(me,ae),H(Te,me,ae),H(S,Te,b),H(S,S,Z),te(S,S),H(S,S,b),H(S,S,Z),H(S,S,Z),H(N[0],S,Z),W(u,N[0]),H(u,u,Z),ue(u,b)&&H(N[0],N[0],O),W(u,N[0]),H(u,u,Z),ue(u,b)?-1:(he(N[0])===T[31]>>7&&$(N[0],d,N[0]),H(N[3],N[0],N[1]),0)}function qr(N,T,S){const u=new Uint8Array(32),b=[o(),o(),o(),o()],Z=[o(),o(),o(),o()];if(S.length!==c.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${c.SIGNATURE_LENGTH} bytes`);if(He(Z,N))return!1;const ae=new i.SHA512;ae.update(S.subarray(0,32)),ae.update(N),ae.update(T);const me=ae.digest();return V(me),A(b,Z,me),M(Z,S.subarray(32)),Ee(b,Z),et(u,b),!ce(S,u)}c.verify=qr;function _e(N){let T=[o(),o(),o(),o()];if(He(T,N))throw new Error("Ed25519: invalid public key");let S=o(),u=o(),b=T[1];pe(S,v,b),$(u,v,b),ve(u,u),H(S,S,u);let Z=new Uint8Array(32);return re(Z,S),Z}c.convertPublicKeyToX25519=_e;function It(N){const T=(0,i.hash)(N.subarray(0,32));T[0]&=248,T[31]&=127,T[31]|=64;const S=new Uint8Array(T.subarray(0,32));return(0,n.wipe)(T),S}c.convertSecretKeyToX25519=It})(xc);const X1="EdDSA",Z1="JWT",sf=".",nf="base64url",ew="utf8",tw="utf8",rw=":",iw="did",sw="key",Xh="base58btc",nw="z",ow="K36",aw=32;function yo(c){return _o(Ec(ki(c),ew),nf)}function of(c){const r=Ec(ow,Xh),i=nw+_o(pm([r,c]),Xh);return[iw,sw,i].join(rw)}function cw(c){return _o(c,nf)}function uw(c){return Ec([yo(c.header),yo(c.payload)].join(sf),tw)}function hw(c){return[yo(c.header),yo(c.payload),cw(c.signature)].join(sf)}function Zh(c=kl.randomBytes(aw)){return xc.generateKeyPairFromSeed(c)}async function lw(c,r,i,n,o=ie.fromMiliseconds(Date.now())){const h={alg:X1,typ:Z1},d=of(n.publicKey),v=o+i,w={iss:d,sub:c,aud:r,iat:o,exp:v},y=uw({header:h,payload:w}),E=xc.sign(n.secretKey,y);return hw({header:h,payload:w,signature:E})}const fw="PARSE_ERROR",pw="INVALID_REQUEST",dw="METHOD_NOT_FOUND",gw="INVALID_PARAMS",af="INTERNAL_ERROR",Pc="SERVER_ERROR",vw=[-32700,-32600,-32601,-32602,-32603],Qs={[fw]:{code:-32700,message:"Parse error"},[pw]:{code:-32600,message:"Invalid Request"},[dw]:{code:-32601,message:"Method not found"},[gw]:{code:-32602,message:"Invalid params"},[af]:{code:-32603,message:"Internal error"},[Pc]:{code:-32e3,message:"Server error"}},cf=Pc;function yw(c){return vw.includes(c)}function el(c){return Object.keys(Qs).includes(c)?Qs[c]:Qs[cf]}function mw(c){const r=Object.values(Qs).find(i=>i.code===c);return r||Qs[cf]}function uf(c,r,i){return c.message.includes("getaddrinfo ENOTFOUND")||c.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${i} RPC url at ${r}`):c}var hf={},si={},tl;function ww(){if(tl)return si;tl=1,Object.defineProperty(si,"__esModule",{value:!0}),si.isBrowserCryptoAvailable=si.getSubtleCrypto=si.getBrowerCrypto=void 0;function c(){return(Br===null||Br===void 0?void 0:Br.crypto)||(Br===null||Br===void 0?void 0:Br.msCrypto)||{}}si.getBrowerCrypto=c;function r(){const n=c();return n.subtle||n.webkitSubtle}si.getSubtleCrypto=r;function i(){return!!c()&&!!r()}return si.isBrowserCryptoAvailable=i,si}var ni={},rl;function _w(){if(rl)return ni;rl=1,Object.defineProperty(ni,"__esModule",{value:!0}),ni.isBrowser=ni.isNode=ni.isReactNative=void 0;function c(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}ni.isReactNative=c;function r(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}ni.isNode=r;function i(){return!c()&&!r()}return ni.isBrowser=i,ni}(function(c){Object.defineProperty(c,"__esModule",{value:!0});const r=ws;r.__exportStar(ww(),c),r.__exportStar(_w(),c)})(hf);function Sc(c=3){const r=Date.now()*Math.pow(10,c),i=Math.floor(Math.random()*Math.pow(10,c));return r+i}function lf(c=6){return BigInt(Sc(c))}function ys(c,r,i){return{id:i||Sc(),jsonrpc:"2.0",method:c,params:r}}function bo(c,r){return{id:c,jsonrpc:"2.0",result:r}}function Eo(c,r,i){return{id:c,jsonrpc:"2.0",error:bw(r,i)}}function bw(c,r){return typeof c>"u"?el(af):(typeof c=="string"&&(c=Object.assign(Object.assign({},el(Pc)),{message:c})),typeof r<"u"&&(c.data=r),yw(c.code)&&(c=mw(c.code)),c)}class Ew{}class Iw extends Ew{constructor(){super()}}class xw extends Iw{constructor(r){super()}}const Pw="^https?:",Sw="^wss?:";function Cw(c){const r=c.match(new RegExp(/^\w+:/,"gi"));if(!(!r||!r.length))return r[0]}function ff(c,r){const i=Cw(c);return typeof i>"u"?!1:new RegExp(r).test(i)}function il(c){return ff(c,Pw)}function sl(c){return ff(c,Sw)}function Rw(c){return new RegExp("wss?://localhost(:d{2,5})?").test(c)}function pf(c){return typeof c=="object"&&"id"in c&&"jsonrpc"in c&&c.jsonrpc==="2.0"}function Cc(c){return pf(c)&&"method"in c}function Io(c){return pf(c)&&(ci(c)||Lr(c))}function ci(c){return"result"in c}function Lr(c){return"error"in c}class ui extends xw{constructor(r){super(r),this.events=new Cr.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(r),this.connection.connected&&this.registerEventListeners()}async connect(r=this.connection){await this.open(r)}async disconnect(){await this.close()}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}off(r,i){this.events.off(r,i)}removeListener(r,i){this.events.removeListener(r,i)}async request(r,i){return this.requestStrict(ys(r.method,r.params||[],r.id||lf().toString()),i)}async requestStrict(r,i){return new Promise(async(n,o)=>{if(!this.connection.connected)try{await this.open()}catch(h){o(h)}this.events.on(`${r.id}`,h=>{Lr(h)?o(h.error):n(h.result)});try{await this.connection.send(r,i)}catch(h){o(h)}})}setConnection(r=this.connection){return r}onPayload(r){this.events.emit("payload",r),Io(r)?this.events.emit(`${r.id}`,r):this.events.emit("message",{type:r.method,data:r.params})}onClose(r){r&&r.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${r.code} ${r.reason?`(${r.reason})`:""}`)),this.events.emit("disconnect")}async open(r=this.connection){this.connection===r&&this.connection.connected||(this.connection.connected&&this.close(),typeof r=="string"&&(await this.connection.open(r),r=this.connection),this.connection=this.setConnection(r),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",r=>this.onPayload(r)),this.connection.on("close",r=>this.onClose(r)),this.connection.on("error",r=>this.events.emit("error",r)),this.connection.on("register_error",r=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const Ow=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),Aw=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",nl=c=>c.split("?")[0],ol=10,Tw=Ow();let Nw=class{constructor(r){if(this.url=r,this.events=new Cr.EventEmitter,this.registering=!1,!sl(r))throw new Error(`Provided URL is not compatible with WebSocket connection: ${r}`);this.url=r}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}off(r,i){this.events.off(r,i)}removeListener(r,i){this.events.removeListener(r,i)}async open(r=this.url){await this.register(r)}async close(){return new Promise((r,i)=>{if(typeof this.socket>"u"){i(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),r()},this.socket.close()})}async send(r){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(ki(r))}catch(i){this.onError(r.id,i)}}register(r=this.url){if(!sl(r))throw new Error(`Provided URL is not compatible with WebSocket connection: ${r}`);if(this.registering){const i=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=i||this.events.listenerCount("open")>=i)&&this.events.setMaxListeners(i+1),new Promise((n,o)=>{this.events.once("register_error",h=>{this.resetMaxListeners(),o(h)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return o(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=r,this.registering=!0,new Promise((i,n)=>{const o=new URLSearchParams(r).get("origin"),h=hf.isReactNative()?{headers:{origin:o}}:{rejectUnauthorized:!Rw(r)},d=new Tw(r,[],h);Aw()?d.onerror=v=>{const w=v;n(this.emitError(w.error))}:d.on("error",v=>{n(this.emitError(v))}),d.onopen=()=>{this.onOpen(d),i(d)}})}onOpen(r){r.onmessage=i=>this.onPayload(i),r.onclose=i=>this.onClose(i),this.socket=r,this.registering=!1,this.events.emit("open")}onClose(r){this.socket=void 0,this.registering=!1,this.events.emit("close",r)}onPayload(r){if(typeof r.data>"u")return;const i=typeof r.data=="string"?Zs(r.data):r.data;this.events.emit("payload",i)}onError(r,i){const n=this.parseError(i),o=n.message||n.toString(),h=Eo(r,o);this.events.emit("payload",h)}parseError(r,i=this.url){return uf(r,nl(i),"WS")}resetMaxListeners(){this.events.getMaxListeners()>ol&&this.events.setMaxListeners(ol)}emitError(r){const i=this.parseError(new Error((r==null?void 0:r.message)||`WebSocket connection failed for host: ${nl(this.url)}`));return this.events.emit("register_error",i),i}};var mo={exports:{}};mo.exports;(function(c,r){var i=200,n="__lodash_hash_undefined__",o=1,h=2,d=9007199254740991,v="[object Arguments]",w="[object Array]",y="[object AsyncFunction]",E="[object Boolean]",C="[object Date]",O="[object Error]",j="[object Function]",D="[object GeneratorFunction]",K="[object Map]",re="[object Number]",ce="[object Null]",ue="[object Object]",he="[object Promise]",fe="[object Proxy]",pe="[object RegExp]",$="[object Set]",H="[object String]",W="[object Symbol]",ve="[object Undefined]",te="[object WeakMap]",Ee="[object ArrayBuffer]",Oe="[object DataView]",et="[object Float32Array]",A="[object Float64Array]",M="[object Int8Array]",je="[object Int16Array]",Ae="[object Int32Array]",J="[object Uint8Array]",B="[object Uint8ClampedArray]",k="[object Uint16Array]",V="[object Uint32Array]",ut=/[\\^$.*+?()[\]{}|]/g,He=/^\[object .+?Constructor\]$/,qr=/^(?:0|[1-9]\d*)$/,_e={};_e[et]=_e[A]=_e[M]=_e[je]=_e[Ae]=_e[J]=_e[B]=_e[k]=_e[V]=!0,_e[v]=_e[w]=_e[Ee]=_e[E]=_e[Oe]=_e[C]=_e[O]=_e[j]=_e[K]=_e[re]=_e[ue]=_e[pe]=_e[$]=_e[H]=_e[te]=!1;var It=typeof Br=="object"&&Br&&Br.Object===Object&&Br,N=typeof self=="object"&&self&&self.Object===Object&&self,T=It||N||Function("return this")(),S=r&&!r.nodeType&&r,u=S&&!0&&c&&!c.nodeType&&c,b=u&&u.exports===S,Z=b&&It.process,ae=function(){try{return Z&&Z.binding&&Z.binding("util")}catch{}}(),me=ae&&ae.isTypedArray;function Te(g,I){for(var z=-1,Q=g==null?0:g.length,Be=0,de=[];++z<Q;){var Xe=g[z];I(Xe,z,g)&&(de[Be++]=Xe)}return de}function $e(g,I){for(var z=-1,Q=I.length,Be=g.length;++z<Q;)g[Be+z]=I[z];return g}function xe(g,I){for(var z=-1,Q=g==null?0:g.length;++z<Q;)if(I(g[z],z,g))return!0;return!1}function xt(g,I){for(var z=-1,Q=Array(g);++z<g;)Q[z]=I(z);return Q}function mt(g){return function(I){return g(I)}}function nt(g,I){return g.has(I)}function Fe(g,I){return g==null?void 0:g[I]}function Je(g){var I=-1,z=Array(g.size);return g.forEach(function(Q,Be){z[++I]=[Be,Q]}),z}function Qe(g,I){return function(z){return g(I(z))}}function ot(g){var I=-1,z=Array(g.size);return g.forEach(function(Q){z[++I]=Q}),z}var ze=Array.prototype,Ye=Function.prototype,Ne=Object.prototype,ke=T["__core-js_shared__"],ht=Ye.toString,qe=Ne.hasOwnProperty,Pt=function(){var g=/[^.]+$/.exec(ke&&ke.keys&&ke.keys.IE_PROTO||"");return g?"Symbol(src)_1."+g:""}(),Dt=Ne.toString,Ut=RegExp("^"+ht.call(qe).replace(ut,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ht=b?T.Buffer:void 0,qt=T.Symbol,Jt=T.Uint8Array,rr=Ne.propertyIsEnumerable,Mr=ze.splice,Qt=qt?qt.toStringTag:void 0,Vr=Object.getOwnPropertySymbols,li=Ht?Ht.isBuffer:void 0,Ci=Qe(Object.keys,Object),lt=lr(T,"DataView"),tt=lr(T,"Map"),ft=lr(T,"Promise"),pt=lr(T,"Set"),at=lr(T,"WeakMap"),rt=lr(Object,"create"),St=Wr(lt),Ct=Wr(tt),dt=Wr(ft),Rt=Wr(pt),gt=Wr(at),wt=qt?qt.prototype:void 0,vt=wt?wt.valueOf:void 0;function We(g){var I=-1,z=g==null?0:g.length;for(this.clear();++I<z;){var Q=g[I];this.set(Q[0],Q[1])}}function Ot(){this.__data__=rt?rt(null):{},this.size=0}function At(g){var I=this.has(g)&&delete this.__data__[g];return this.size-=I?1:0,I}function So(g){var I=this.__data__;if(rt){var z=I[g];return z===n?void 0:z}return qe.call(I,g)?I[g]:void 0}function Co(g){var I=this.__data__;return rt?I[g]!==void 0:qe.call(I,g)}function Ro(g,I){var z=this.__data__;return this.size+=this.has(g)?0:1,z[g]=rt&&I===void 0?n:I,this}We.prototype.clear=Ot,We.prototype.delete=At,We.prototype.get=So,We.prototype.has=Co,We.prototype.set=Ro;function yr(g){var I=-1,z=g==null?0:g.length;for(this.clear();++I<z;){var Q=g[I];this.set(Q[0],Q[1])}}function Oo(){this.__data__=[],this.size=0}function Ao(g){var I=this.__data__,z=Ri(I,g);if(z<0)return!1;var Q=I.length-1;return z==Q?I.pop():Mr.call(I,z,1),--this.size,!0}function To(g){var I=this.__data__,z=Ri(I,g);return z<0?void 0:I[z][1]}function No(g){return Ri(this.__data__,g)>-1}function $o(g,I){var z=this.__data__,Q=Ri(z,g);return Q<0?(++this.size,z.push([g,I])):z[Q][1]=I,this}yr.prototype.clear=Oo,yr.prototype.delete=Ao,yr.prototype.get=To,yr.prototype.has=No,yr.prototype.set=$o;function Gr(g){var I=-1,z=g==null?0:g.length;for(this.clear();++I<z;){var Q=g[I];this.set(Q[0],Q[1])}}function Gi(){this.size=0,this.__data__={hash:new We,map:new(tt||yr),string:new We}}function Do(g){var I=fi(this,g).delete(g);return this.size-=I?1:0,I}function Wi(g){return fi(this,g).get(g)}function Fo(g){return fi(this,g).has(g)}function Lo(g,I){var z=fi(this,g),Q=z.size;return z.set(g,I),this.size+=z.size==Q?0:1,this}Gr.prototype.clear=Gi,Gr.prototype.delete=Do,Gr.prototype.get=Wi,Gr.prototype.has=Fo,Gr.prototype.set=Lo;function Ji(g){var I=-1,z=g==null?0:g.length;for(this.__data__=new Gr;++I<z;)this.add(g[I])}function tn(g){return this.__data__.set(g,n),this}function rn(g){return this.__data__.has(g)}Ji.prototype.add=Ji.prototype.push=tn,Ji.prototype.has=rn;function Rr(g){var I=this.__data__=new yr(g);this.size=I.size}function qo(){this.__data__=new yr,this.size=0}function Mo(g){var I=this.__data__,z=I.delete(g);return this.size=I.size,z}function jo(g){return this.__data__.get(g)}function zo(g){return this.__data__.has(g)}function sn(g,I){var z=this.__data__;if(z instanceof yr){var Q=z.__data__;if(!tt||Q.length<i-1)return Q.push([g,I]),this.size=++z.size,this;z=this.__data__=new Gr(Q)}return z.set(g,I),this.size=z.size,this}Rr.prototype.clear=qo,Rr.prototype.delete=Mo,Rr.prototype.get=jo,Rr.prototype.has=zo,Rr.prototype.set=sn;function nn(g,I){var z=Xi(g),Q=!z&&yn(g),Be=!z&&!Q&&Is(g),de=!z&&!Q&&!Be&&_n(g),Xe=z||Q||Be||de,Tt=Xe?xt(g.length,String):[],Ce=Tt.length;for(var Ve in g)(I||qe.call(g,Ve))&&!(Xe&&(Ve=="length"||Be&&(Ve=="offset"||Ve=="parent")||de&&(Ve=="buffer"||Ve=="byteLength"||Ve=="byteOffset")||fn(Ve,Ce)))&&Tt.push(Ve);return Tt}function Ri(g,I){for(var z=g.length;z--;)if(vn(g[z][0],I))return z;return-1}function bs(g,I,z){var Q=I(g);return Xi(g)?Q:$e(Q,z(g))}function Oi(g){return g==null?g===void 0?ve:ce:Qt&&Qt in Object(g)?hn(g):ko(g)}function Es(g){return Ti(g)&&Oi(g)==v}function Ai(g,I,z,Q,Be){return g===I?!0:g==null||I==null||!Ti(g)&&!Ti(I)?g!==g&&I!==I:on(g,I,z,Q,Ai,Be)}function on(g,I,z,Q,Be,de){var Xe=Xi(g),Tt=Xi(I),Ce=Xe?w:jr(g),Ve=Tt?w:jr(I);Ce=Ce==v?ue:Ce,Ve=Ve==v?ue:Ve;var _t=Ce==ue,ir=Ve==ue,Nt=Ce==Ve;if(Nt&&Is(g)){if(!Is(I))return!1;Xe=!0,_t=!1}if(Nt&&!_t)return de||(de=new Rr),Xe||_n(g)?Qi(g,I,z,Q,Be,de):Ho(g,I,Ce,z,Q,Be,de);if(!(z&o)){var Ze=_t&&qe.call(g,"__wrapped__"),Yt=ir&&qe.call(I,"__wrapped__");if(Ze||Yt){var Or=Ze?g.value():g,mr=Yt?I.value():I;return de||(de=new Rr),Be(Or,mr,z,Q,de)}}return Nt?(de||(de=new Rr),un(g,I,z,Q,Be,de)):!1}function Uo(g){if(!wn(g)||dn(g))return!1;var I=Zi(g)?Ut:He;return I.test(Wr(g))}function an(g){return Ti(g)&&mn(g.length)&&!!_e[Oi(g)]}function cn(g){if(!gn(g))return Ci(g);var I=[];for(var z in Object(g))qe.call(g,z)&&z!="constructor"&&I.push(z);return I}function Qi(g,I,z,Q,Be,de){var Xe=z&o,Tt=g.length,Ce=I.length;if(Tt!=Ce&&!(Xe&&Ce>Tt))return!1;var Ve=de.get(g);if(Ve&&de.get(I))return Ve==I;var _t=-1,ir=!0,Nt=z&h?new Ji:void 0;for(de.set(g,I),de.set(I,g);++_t<Tt;){var Ze=g[_t],Yt=I[_t];if(Q)var Or=Xe?Q(Yt,Ze,_t,I,g,de):Q(Ze,Yt,_t,g,I,de);if(Or!==void 0){if(Or)continue;ir=!1;break}if(Nt){if(!xe(I,function(mr,zr){if(!nt(Nt,zr)&&(Ze===mr||Be(Ze,mr,z,Q,de)))return Nt.push(zr)})){ir=!1;break}}else if(!(Ze===Yt||Be(Ze,Yt,z,Q,de))){ir=!1;break}}return de.delete(g),de.delete(I),ir}function Ho(g,I,z,Q,Be,de,Xe){switch(z){case Oe:if(g.byteLength!=I.byteLength||g.byteOffset!=I.byteOffset)return!1;g=g.buffer,I=I.buffer;case Ee:return!(g.byteLength!=I.byteLength||!de(new Jt(g),new Jt(I)));case E:case C:case re:return vn(+g,+I);case O:return g.name==I.name&&g.message==I.message;case pe:case H:return g==I+"";case K:var Tt=Je;case $:var Ce=Q&o;if(Tt||(Tt=ot),g.size!=I.size&&!Ce)return!1;var Ve=Xe.get(g);if(Ve)return Ve==I;Q|=h,Xe.set(g,I);var _t=Qi(Tt(g),Tt(I),Q,Be,de,Xe);return Xe.delete(g),_t;case W:if(vt)return vt.call(g)==vt.call(I)}return!1}function un(g,I,z,Q,Be,de){var Xe=z&o,Tt=Yi(g),Ce=Tt.length,Ve=Yi(I),_t=Ve.length;if(Ce!=_t&&!Xe)return!1;for(var ir=Ce;ir--;){var Nt=Tt[ir];if(!(Xe?Nt in I:qe.call(I,Nt)))return!1}var Ze=de.get(g);if(Ze&&de.get(I))return Ze==I;var Yt=!0;de.set(g,I),de.set(I,g);for(var Or=Xe;++ir<Ce;){Nt=Tt[ir];var mr=g[Nt],zr=I[Nt];if(Q)var xs=Xe?Q(zr,mr,Nt,I,g,de):Q(mr,zr,Nt,g,I,de);if(!(xs===void 0?mr===zr||Be(mr,zr,z,Q,de):xs)){Yt=!1;break}Or||(Or=Nt=="constructor")}if(Yt&&!Or){var Ni=g.constructor,Mt=I.constructor;Ni!=Mt&&"constructor"in g&&"constructor"in I&&!(typeof Ni=="function"&&Ni instanceof Ni&&typeof Mt=="function"&&Mt instanceof Mt)&&(Yt=!1)}return de.delete(g),de.delete(I),Yt}function Yi(g){return bs(g,Vo,ln)}function fi(g,I){var z=g.__data__;return pn(I)?z[typeof I=="string"?"string":"hash"]:z.map}function lr(g,I){var z=Fe(g,I);return Uo(z)?z:void 0}function hn(g){var I=qe.call(g,Qt),z=g[Qt];try{g[Qt]=void 0;var Q=!0}catch{}var Be=Dt.call(g);return Q&&(I?g[Qt]=z:delete g[Qt]),Be}var ln=Vr?function(g){return g==null?[]:(g=Object(g),Te(Vr(g),function(I){return rr.call(g,I)}))}:Ke,jr=Oi;(lt&&jr(new lt(new ArrayBuffer(1)))!=Oe||tt&&jr(new tt)!=K||ft&&jr(ft.resolve())!=he||pt&&jr(new pt)!=$||at&&jr(new at)!=te)&&(jr=function(g){var I=Oi(g),z=I==ue?g.constructor:void 0,Q=z?Wr(z):"";if(Q)switch(Q){case St:return Oe;case Ct:return K;case dt:return he;case Rt:return $;case gt:return te}return I});function fn(g,I){return I=I??d,!!I&&(typeof g=="number"||qr.test(g))&&g>-1&&g%1==0&&g<I}function pn(g){var I=typeof g;return I=="string"||I=="number"||I=="symbol"||I=="boolean"?g!=="__proto__":g===null}function dn(g){return!!Pt&&Pt in g}function gn(g){var I=g&&g.constructor,z=typeof I=="function"&&I.prototype||Ne;return g===z}function ko(g){return Dt.call(g)}function Wr(g){if(g!=null){try{return ht.call(g)}catch{}try{return g+""}catch{}}return""}function vn(g,I){return g===I||g!==g&&I!==I}var yn=Es(function(){return arguments}())?Es:function(g){return Ti(g)&&qe.call(g,"callee")&&!rr.call(g,"callee")},Xi=Array.isArray;function Ko(g){return g!=null&&mn(g.length)&&!Zi(g)}var Is=li||Ue;function Bo(g,I){return Ai(g,I)}function Zi(g){if(!wn(g))return!1;var I=Oi(g);return I==j||I==D||I==y||I==fe}function mn(g){return typeof g=="number"&&g>-1&&g%1==0&&g<=d}function wn(g){var I=typeof g;return g!=null&&(I=="object"||I=="function")}function Ti(g){return g!=null&&typeof g=="object"}var _n=me?mt(me):an;function Vo(g){return Ko(g)?nn(g):cn(g)}function Ke(){return[]}function Ue(){return!1}c.exports=Bo})(mo,mo.exports);var $w=mo.exports;const Dw=Kl($w);function Fw(c,r){return r=r||{},new Promise(function(i,n){var o=new XMLHttpRequest,h=[],d=[],v={},w=function(){return{ok:(o.status/100|0)==2,statusText:o.statusText,status:o.status,url:o.responseURL,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(o.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([o.response]))},clone:w,headers:{keys:function(){return h},entries:function(){return d},get:function(E){return v[E.toLowerCase()]},has:function(E){return E.toLowerCase()in v}}}};for(var y in o.open(r.method||"get",c,!0),o.onload=function(){o.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(E,C,O){h.push(C=C.toLowerCase()),d.push([C,O]),v[C]=v[C]?v[C]+","+O:O}),i(w())},o.onerror=n,o.withCredentials=r.credentials=="include",r.headers)o.setRequestHeader(y,r.headers[y]);o.send(r.body||null)})}const Lw=Object.freeze(Object.defineProperty({__proto__:null,default:Fw},Symbol.toStringTag,{value:"Module"})),al=Ul(Lw);var qw=self.fetch||(self.fetch=al.default||al);const Mw=Kl(qw);function jw(c,r){if(c.length>=255)throw new TypeError("Alphabet too long");for(var i=new Uint8Array(256),n=0;n<i.length;n++)i[n]=255;for(var o=0;o<c.length;o++){var h=c.charAt(o),d=h.charCodeAt(0);if(i[d]!==255)throw new TypeError(h+" is ambiguous");i[d]=o}var v=c.length,w=c.charAt(0),y=Math.log(v)/Math.log(256),E=Math.log(256)/Math.log(v);function C(D){if(D instanceof Uint8Array||(ArrayBuffer.isView(D)?D=new Uint8Array(D.buffer,D.byteOffset,D.byteLength):Array.isArray(D)&&(D=Uint8Array.from(D))),!(D instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(D.length===0)return"";for(var K=0,re=0,ce=0,ue=D.length;ce!==ue&&D[ce]===0;)ce++,K++;for(var he=(ue-ce)*E+1>>>0,fe=new Uint8Array(he);ce!==ue;){for(var pe=D[ce],$=0,H=he-1;(pe!==0||$<re)&&H!==-1;H--,$++)pe+=256*fe[H]>>>0,fe[H]=pe%v>>>0,pe=pe/v>>>0;if(pe!==0)throw new Error("Non-zero carry");re=$,ce++}for(var W=he-re;W!==he&&fe[W]===0;)W++;for(var ve=w.repeat(K);W<he;++W)ve+=c.charAt(fe[W]);return ve}function O(D){if(typeof D!="string")throw new TypeError("Expected String");if(D.length===0)return new Uint8Array;var K=0;if(D[K]!==" "){for(var re=0,ce=0;D[K]===w;)re++,K++;for(var ue=(D.length-K)*y+1>>>0,he=new Uint8Array(ue);D[K];){var fe=i[D.charCodeAt(K)];if(fe===255)return;for(var pe=0,$=ue-1;(fe!==0||pe<ce)&&$!==-1;$--,pe++)fe+=v*he[$]>>>0,he[$]=fe%256>>>0,fe=fe/256>>>0;if(fe!==0)throw new Error("Non-zero carry");ce=pe,K++}if(D[K]!==" "){for(var H=ue-ce;H!==ue&&he[H]===0;)H++;for(var W=new Uint8Array(re+(ue-H)),ve=re;H!==ue;)W[ve++]=he[H++];return W}}}function j(D){var K=O(D);if(K)return K;throw new Error(`Non-${r} character`)}return{encode:C,decodeUnsafe:O,decode:j}}var zw=jw,Uw=zw;const df=c=>{if(c instanceof Uint8Array&&c.constructor.name==="Uint8Array")return c;if(c instanceof ArrayBuffer)return new Uint8Array(c);if(ArrayBuffer.isView(c))return new Uint8Array(c.buffer,c.byteOffset,c.byteLength);throw new Error("Unknown type, must be binary type")},Hw=c=>new TextEncoder().encode(c),kw=c=>new TextDecoder().decode(c);class Kw{constructor(r,i,n){this.name=r,this.prefix=i,this.baseEncode=n}encode(r){if(r instanceof Uint8Array)return`${this.prefix}${this.baseEncode(r)}`;throw Error("Unknown type, must be binary type")}}class Bw{constructor(r,i,n){if(this.name=r,this.prefix=i,i.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i.codePointAt(0),this.baseDecode=n}decode(r){if(typeof r=="string"){if(r.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(r)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(r.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(r){return gf(this,r)}}class Vw{constructor(r){this.decoders=r}or(r){return gf(this,r)}decode(r){const i=r[0],n=this.decoders[i];if(n)return n.decode(r);throw RangeError(`Unable to decode multibase string ${JSON.stringify(r)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const gf=(c,r)=>new Vw({...c.decoders||{[c.prefix]:c},...r.decoders||{[r.prefix]:r}});class Gw{constructor(r,i,n,o){this.name=r,this.prefix=i,this.baseEncode=n,this.baseDecode=o,this.encoder=new Kw(r,i,n),this.decoder=new Bw(r,i,o)}encode(r){return this.encoder.encode(r)}decode(r){return this.decoder.decode(r)}}const xo=({name:c,prefix:r,encode:i,decode:n})=>new Gw(c,r,i,n),en=({prefix:c,name:r,alphabet:i})=>{const{encode:n,decode:o}=Uw(i,r);return xo({prefix:c,name:r,encode:n,decode:h=>df(o(h))})},Ww=(c,r,i,n)=>{const o={};for(let E=0;E<r.length;++E)o[r[E]]=E;let h=c.length;for(;c[h-1]==="=";)--h;const d=new Uint8Array(h*i/8|0);let v=0,w=0,y=0;for(let E=0;E<h;++E){const C=o[c[E]];if(C===void 0)throw new SyntaxError(`Non-${n} character`);w=w<<i|C,v+=i,v>=8&&(v-=8,d[y++]=255&w>>v)}if(v>=i||255&w<<8-v)throw new SyntaxError("Unexpected end of data");return d},Jw=(c,r,i)=>{const n=r[r.length-1]==="=",o=(1<<i)-1;let h="",d=0,v=0;for(let w=0;w<c.length;++w)for(v=v<<8|c[w],d+=8;d>i;)d-=i,h+=r[o&v>>d];if(d&&(h+=r[o&v<<i-d]),n)for(;h.length*i&7;)h+="=";return h},Kt=({name:c,prefix:r,bitsPerChar:i,alphabet:n})=>xo({prefix:r,name:c,encode(o){return Jw(o,n,i)},decode(o){return Ww(o,n,i,c)}}),Qw=xo({prefix:"\0",name:"identity",encode:c=>kw(c),decode:c=>Hw(c)});var Yw=Object.freeze({__proto__:null,identity:Qw});const Xw=Kt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Zw=Object.freeze({__proto__:null,base2:Xw});const e_=Kt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var t_=Object.freeze({__proto__:null,base8:e_});const r_=en({prefix:"9",name:"base10",alphabet:"0123456789"});var i_=Object.freeze({__proto__:null,base10:r_});const s_=Kt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),n_=Kt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var o_=Object.freeze({__proto__:null,base16:s_,base16upper:n_});const a_=Kt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),c_=Kt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),u_=Kt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),h_=Kt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),l_=Kt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),f_=Kt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),p_=Kt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),d_=Kt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),g_=Kt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var v_=Object.freeze({__proto__:null,base32:a_,base32upper:c_,base32pad:u_,base32padupper:h_,base32hex:l_,base32hexupper:f_,base32hexpad:p_,base32hexpadupper:d_,base32z:g_});const y_=en({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),m_=en({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var w_=Object.freeze({__proto__:null,base36:y_,base36upper:m_});const __=en({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),b_=en({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var E_=Object.freeze({__proto__:null,base58btc:__,base58flickr:b_});const I_=Kt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),x_=Kt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),P_=Kt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),S_=Kt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var C_=Object.freeze({__proto__:null,base64:I_,base64pad:x_,base64url:P_,base64urlpad:S_});const vf=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),R_=vf.reduce((c,r,i)=>(c[i]=r,c),[]),O_=vf.reduce((c,r,i)=>(c[r.codePointAt(0)]=i,c),[]);function A_(c){return c.reduce((r,i)=>(r+=R_[i],r),"")}function T_(c){const r=[];for(const i of c){const n=O_[i.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${i}`);r.push(n)}return new Uint8Array(r)}const N_=xo({prefix:"🚀",name:"base256emoji",encode:A_,decode:T_});var $_=Object.freeze({__proto__:null,base256emoji:N_}),D_=yf,cl=128,F_=127,L_=~F_,q_=Math.pow(2,31);function yf(c,r,i){r=r||[],i=i||0;for(var n=i;c>=q_;)r[i++]=c&255|cl,c/=128;for(;c&L_;)r[i++]=c&255|cl,c>>>=7;return r[i]=c|0,yf.bytes=i-n+1,r}var M_=vc,j_=128,ul=127;function vc(c,n){var i=0,n=n||0,o=0,h=n,d,v=c.length;do{if(h>=v)throw vc.bytes=0,new RangeError("Could not decode varint");d=c[h++],i+=o<28?(d&ul)<<o:(d&ul)*Math.pow(2,o),o+=7}while(d>=j_);return vc.bytes=h-n,i}var z_=Math.pow(2,7),U_=Math.pow(2,14),H_=Math.pow(2,21),k_=Math.pow(2,28),K_=Math.pow(2,35),B_=Math.pow(2,42),V_=Math.pow(2,49),G_=Math.pow(2,56),W_=Math.pow(2,63),J_=function(c){return c<z_?1:c<U_?2:c<H_?3:c<k_?4:c<K_?5:c<B_?6:c<V_?7:c<G_?8:c<W_?9:10},Q_={encode:D_,decode:M_,encodingLength:J_},mf=Q_;const hl=(c,r,i=0)=>(mf.encode(c,r,i),r),ll=c=>mf.encodingLength(c),yc=(c,r)=>{const i=r.byteLength,n=ll(c),o=n+ll(i),h=new Uint8Array(o+i);return hl(c,h,0),hl(i,h,n),h.set(r,o),new Y_(c,i,r,h)};class Y_{constructor(r,i,n,o){this.code=r,this.size=i,this.digest=n,this.bytes=o}}const wf=({name:c,code:r,encode:i})=>new X_(c,r,i);class X_{constructor(r,i,n){this.name=r,this.code=i,this.encode=n}digest(r){if(r instanceof Uint8Array){const i=this.encode(r);return i instanceof Uint8Array?yc(this.code,i):i.then(n=>yc(this.code,n))}else throw Error("Unknown type, must be binary type")}}const _f=c=>async r=>new Uint8Array(await crypto.subtle.digest(c,r)),Z_=wf({name:"sha2-256",code:18,encode:_f("SHA-256")}),eb=wf({name:"sha2-512",code:19,encode:_f("SHA-512")});var tb=Object.freeze({__proto__:null,sha256:Z_,sha512:eb});const bf=0,rb="identity",Ef=df,ib=c=>yc(bf,Ef(c)),sb={code:bf,name:rb,encode:Ef,digest:ib};var nb=Object.freeze({__proto__:null,identity:sb});new TextEncoder,new TextDecoder;const fl={...Yw,...Zw,...t_,...i_,...o_,...v_,...w_,...E_,...C_,...$_};({...tb,...nb});function If(c){return globalThis.Buffer!=null?new Uint8Array(c.buffer,c.byteOffset,c.byteLength):c}function ob(c=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?If(globalThis.Buffer.allocUnsafe(c)):new Uint8Array(c)}function xf(c,r,i,n){return{name:c,prefix:r,encoder:{name:c,prefix:r,encode:i},decoder:{decode:n}}}const pl=xf("utf8","u",c=>"u"+new TextDecoder("utf8").decode(c),c=>new TextEncoder().encode(c.substring(1))),sc=xf("ascii","a",c=>{let r="a";for(let i=0;i<c.length;i++)r+=String.fromCharCode(c[i]);return r},c=>{c=c.substring(1);const r=ob(c.length);for(let i=0;i<c.length;i++)r[i]=c.charCodeAt(i);return r}),ab={utf8:pl,"utf-8":pl,hex:fl.base16,latin1:sc,ascii:sc,binary:sc,...fl};function cb(c,r="utf8"){const i=ab[r];if(!i)throw new Error(`Unsupported encoding "${r}"`);return(r==="utf8"||r==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?If(globalThis.Buffer.from(c,"utf-8")):i.decoder.decode(`${i.prefix}${c}`)}const Pf="wc",ub=2,Rc="core",xi=`${Pf}@2:${Rc}:`,hb={name:Rc,logger:"error"},lb={database:":memory:"},fb="crypto",dl="client_ed25519_seed",pb=ie.ONE_DAY,db="keychain",gb="0.3",vb="messages",yb="0.3",mb=ie.SIX_HOURS,wb="publisher",Sf="irn",_b="error",Cf="wss://relay.walletconnect.com",gl="wss://relay.walletconnect.org",bb="relayer",Wt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Eb="_subscription",oi={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Ib=ie.ONE_SECOND,xb="2.11.0",Pb=1e4,Sb="0.3",Cb="WALLETCONNECT_CLIENT_ID",Dr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},Rb="subscription",Ob="0.3",Ab=ie.FIVE_SECONDS*1e3,Tb="pairing",Nb="0.3",Hs={wc_pairingDelete:{req:{ttl:ie.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:ie.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:ie.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:ie.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:ie.ONE_DAY,prompt:!1,tag:0},res:{ttl:ie.ONE_DAY,prompt:!1,tag:0}}},Ws={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Kr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},$b="history",Db="0.3",Fb="expirer",Sr={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Lb="0.3",nc="verify-api",gs="https://verify.walletconnect.com",mc="https://verify.walletconnect.org",qb=[gs,mc],Mb="echo",jb="https://echo.walletconnect.com";class zb{constructor(r,i){this.core=r,this.logger=i,this.keychain=new Map,this.name=db,this.version=gb,this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,o)=>{this.isInitialized(),this.keychain.set(n,o),await this.persist()},this.get=n=>{this.isInitialized();const o=this.keychain.get(n);if(typeof o>"u"){const{message:h}=Y("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(h)}return o},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=r,this.logger=Se.generateChildLogger(i,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(r){await this.core.storage.setItem(this.storageKey,Wl(r))}async getKeyChain(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?Jl(r):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:r}=Y("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Ub{constructor(r,i,n){this.core=r,this.logger=i,this.name=fb,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=o=>(this.isInitialized(),this.keychain.has(o)),this.getClientId=async()=>{this.isInitialized();const o=await this.getClientSeed(),h=Zh(o);return of(h.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const o=vm();return this.setPrivateKey(o.publicKey,o.privateKey)},this.signJWT=async o=>{this.isInitialized();const h=await this.getClientSeed(),d=Zh(h),v=pc();return await lw(v,o,pb,d)},this.generateSharedKey=(o,h,d)=>{this.isInitialized();const v=this.getPrivateKey(o),w=ym(v,h);return this.setSymKey(w,d)},this.setSymKey=async(o,h)=>{this.isInitialized();const d=h||mm(o);return await this.keychain.set(d,o),d},this.deleteKeyPair=async o=>{this.isInitialized(),await this.keychain.del(o)},this.deleteSymKey=async o=>{this.isInitialized(),await this.keychain.del(o)},this.encode=async(o,h,d)=>{this.isInitialized();const v=wm(d),w=ki(h);if(Nh(v)){const O=v.senderPublicKey,j=v.receiverPublicKey;o=await this.generateSharedKey(O,j)}const y=this.getSymKey(o),{type:E,senderPublicKey:C}=v;return _m({type:E,symKey:y,message:w,senderPublicKey:C})},this.decode=async(o,h,d)=>{this.isInitialized();const v=bm(h,d);if(Nh(v)){const w=v.receiverPublicKey,y=v.senderPublicKey;o=await this.generateSharedKey(w,y)}try{const w=this.getSymKey(o),y=Em({symKey:w,encoded:h});return Zs(y)}catch(w){this.logger.error(`Failed to decode message from topic: '${o}', clientId: '${await this.getClientId()}'`),this.logger.error(w)}},this.getPayloadType=o=>{const h=$h(o);return Im(h.type)},this.getPayloadSenderPublicKey=o=>{const h=$h(o);return h.senderPublicKey?_o(h.senderPublicKey,xm):void 0},this.core=r,this.logger=Se.generateChildLogger(i,this.name),this.keychain=n||new zb(this.core,this.logger)}get context(){return Se.getLoggerContext(this.logger)}async setPrivateKey(r,i){return await this.keychain.set(r,i),r}getPrivateKey(r){return this.keychain.get(r)}async getClientSeed(){let r="";try{r=this.keychain.get(dl)}catch{r=pc(),await this.keychain.set(dl,r)}return cb(r,"base16")}getSymKey(r){return this.keychain.get(r)}isInitialized(){if(!this.initialized){const{message:r}=Y("NOT_INITIALIZED",this.name);throw new Error(r)}}}class Hb extends H1{constructor(r,i){super(r,i),this.logger=r,this.core=i,this.messages=new Map,this.name=vb,this.version=yb,this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,o)=>{this.isInitialized();const h=vs(o);let d=this.messages.get(n);return typeof d>"u"&&(d={}),typeof d[h]<"u"||(d[h]=o,this.messages.set(n,d),await this.persist()),h},this.get=n=>{this.isInitialized();let o=this.messages.get(n);return typeof o>"u"&&(o={}),o},this.has=(n,o)=>{this.isInitialized();const h=this.get(n),d=vs(o);return typeof h[d]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=Se.generateChildLogger(r,this.name),this.core=i}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(r){await this.core.storage.setItem(this.storageKey,Wl(r))}async getRelayerMessages(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?Jl(r):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:r}=Y("NOT_INITIALIZED",this.name);throw new Error(r)}}}class kb extends k1{constructor(r,i){super(r,i),this.relayer=r,this.logger=i,this.events=new Cr.EventEmitter,this.name=wb,this.queue=new Map,this.publishTimeout=ie.toMiliseconds(ie.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(n,o,h)=>{var d;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:h}});try{const v=(h==null?void 0:h.ttl)||mb,w=dc(h),y=(h==null?void 0:h.prompt)||!1,E=(h==null?void 0:h.tag)||0,C=(h==null?void 0:h.id)||lf().toString(),O={topic:n,message:o,opts:{ttl:v,relay:w,prompt:y,tag:E,id:C}},j=setTimeout(()=>this.queue.set(C,O),this.publishTimeout);try{await await Ys(this.rpcPublish(n,o,v,w,y,E,C),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(C),this.relayer.events.emit(Wt.publish,O)}catch(D){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(d=h==null?void 0:h.internal)!=null&&d.throwOnFailedPublish)throw this.removeRequestFromQueue(C),D;return}finally{clearTimeout(j)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:o,opts:h}})}catch(v){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(v),v}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.relayer=r,this.logger=Se.generateChildLogger(i,this.name),this.registerEventListeners()}get context(){return Se.getLoggerContext(this.logger)}rpcPublish(r,i,n,o,h,d,v){var w,y,E,C;const O={method:fo(o.protocol).publish,params:{topic:r,message:i,ttl:n,prompt:h,tag:d},id:v};return Ii((w=O.params)==null?void 0:w.prompt)&&((y=O.params)==null||delete y.prompt),Ii((E=O.params)==null?void 0:E.tag)&&((C=O.params)==null||delete C.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:O}),this.relayer.request(O)}removeRequestFromQueue(r){this.queue.delete(r)}checkQueue(){this.queue.forEach(async r=>{const{topic:i,message:n,opts:o}=r;await this.publish(i,n,o)})}registerEventListeners(){this.relayer.core.heartbeat.on(_s.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Wt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Wt.message_ack,r=>{this.removeRequestFromQueue(r.id.toString())})}}class Kb{constructor(){this.map=new Map,this.set=(r,i)=>{const n=this.get(r);this.exists(r,i)||this.map.set(r,[...n,i])},this.get=r=>this.map.get(r)||[],this.exists=(r,i)=>this.get(r).includes(i),this.delete=(r,i)=>{if(typeof i>"u"){this.map.delete(r);return}if(!this.map.has(r))return;const n=this.get(r);if(!this.exists(r,i))return;const o=n.filter(h=>h!==i);if(!o.length){this.map.delete(r);return}this.map.set(r,o)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Bb=Object.defineProperty,Vb=Object.defineProperties,Gb=Object.getOwnPropertyDescriptors,vl=Object.getOwnPropertySymbols,Wb=Object.prototype.hasOwnProperty,Jb=Object.prototype.propertyIsEnumerable,yl=(c,r,i)=>r in c?Bb(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,ks=(c,r)=>{for(var i in r||(r={}))Wb.call(r,i)&&yl(c,i,r[i]);if(vl)for(var i of vl(r))Jb.call(r,i)&&yl(c,i,r[i]);return c},oc=(c,r)=>Vb(c,Gb(r));class Qb extends V1{constructor(r,i){super(r,i),this.relayer=r,this.logger=i,this.subscriptions=new Map,this.topicMap=new Kb,this.events=new Cr.EventEmitter,this.name=Rb,this.version=Ob,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=xi,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}});try{const h=dc(o),d={topic:n,relay:h};this.pending.set(n,d);const v=await this.rpcSubscribe(n,h);return this.onSubscribe(v,d),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:o}}),v}catch(h){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(h),h}},this.unsubscribe=async(n,o)=>{await this.restartToComplete(),this.isInitialized(),typeof(o==null?void 0:o.id)<"u"?await this.unsubscribeById(n,o.id,o):await this.unsubscribeByTopic(n,o)},this.isSubscribed=async n=>this.topics.includes(n)?!0:await new Promise((o,h)=>{const d=new ie.Watch;d.start(this.pendingSubscriptionWatchLabel);const v=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(v),d.stop(this.pendingSubscriptionWatchLabel),o(!0)),d.elapsed(this.pendingSubscriptionWatchLabel)>=Ab&&(clearInterval(v),d.stop(this.pendingSubscriptionWatchLabel),h(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=r,this.logger=Se.generateChildLogger(i,this.name),this.clientId=""}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(r,i){let n=!1;try{n=this.getSubscription(r).topic===i}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(r,i){const n=this.topicMap.get(r);await Promise.all(n.map(async o=>await this.unsubscribeById(r,o,i)))}async unsubscribeById(r,i,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:i,opts:n}});try{const o=dc(n);await this.rpcUnsubscribe(r,i,o);const h=Gt("USER_DISCONNECTED",`${this.name}, ${r}`);await this.onUnsubscribe(r,i,h),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:i,opts:n}})}catch(o){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(o),o}}async rpcSubscribe(r,i){const n={method:fo(i.protocol).subscribe,params:{topic:r}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await Ys(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Wt.connection_stalled)}return vs(r+this.clientId)}async rpcBatchSubscribe(r){if(!r.length)return;const i=r[0].relay,n={method:fo(i.protocol).batchSubscribe,params:{topics:r.map(o=>o.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await Ys(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Wt.connection_stalled)}}rpcUnsubscribe(r,i,n){const o={method:fo(n.protocol).unsubscribe,params:{topic:r,id:i}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o}),this.relayer.request(o)}onSubscribe(r,i){this.setSubscription(r,oc(ks({},i),{id:r})),this.pending.delete(i.topic)}onBatchSubscribe(r){r.length&&r.forEach(i=>{this.setSubscription(i.id,ks({},i)),this.pending.delete(i.topic)})}async onUnsubscribe(r,i,n){this.events.removeAllListeners(i),this.hasSubscription(i,r)&&this.deleteSubscription(i,n),await this.relayer.messages.del(r)}async setRelayerSubscriptions(r){await this.relayer.core.storage.setItem(this.storageKey,r)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(r,i){this.subscriptions.has(r)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:r,subscription:i}),this.addSubscription(r,i))}addSubscription(r,i){this.subscriptions.set(r,ks({},i)),this.topicMap.set(i.topic,r),this.events.emit(Dr.created,i)}getSubscription(r){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:r});const i=this.subscriptions.get(r);if(!i){const{message:n}=Y("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(n)}return i}deleteSubscription(r,i){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:r,reason:i});const n=this.getSubscription(r);this.subscriptions.delete(r),this.topicMap.delete(n.topic,r),this.events.emit(Dr.deleted,oc(ks({},n),{reason:i}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Dr.sync)}async reset(){if(this.cached.length){const r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<r;i++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(Dr.resubscribed)}async restore(){try{const r=await this.getRelayerSubscriptions();if(typeof r>"u"||!r.length)return;if(this.subscriptions.size){const{message:i}=Y("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(r){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(r)}}async batchSubscribe(r){if(!r.length)return;const i=await this.rpcBatchSubscribe(r);ms(i)&&this.onBatchSubscribe(i.map((n,o)=>oc(ks({},r[o]),{id:n})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const r=[];this.pending.forEach(i=>{r.push(i)}),await this.batchSubscribe(r)}registerEventListeners(){this.relayer.core.heartbeat.on(_s.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Wt.connect,async()=>{await this.onConnect()}),this.relayer.on(Wt.disconnect,()=>{this.onDisconnect()}),this.events.on(Dr.created,async r=>{const i=Dr.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()}),this.events.on(Dr.deleted,async r=>{const i=Dr.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=Y("NOT_INITIALIZED",this.name);throw new Error(r)}}async restartToComplete(){this.restartInProgress&&await new Promise(r=>{const i=setInterval(()=>{this.restartInProgress||(clearInterval(i),r())},this.pollingInterval)})}}var Yb=Object.defineProperty,ml=Object.getOwnPropertySymbols,Xb=Object.prototype.hasOwnProperty,Zb=Object.prototype.propertyIsEnumerable,wl=(c,r,i)=>r in c?Yb(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,eE=(c,r)=>{for(var i in r||(r={}))Xb.call(r,i)&&wl(c,i,r[i]);if(ml)for(var i of ml(r))Zb.call(r,i)&&wl(c,i,r[i]);return c};class tE extends K1{constructor(r){super(r),this.protocol="wc",this.version=2,this.events=new Cr.EventEmitter,this.name=bb,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async i=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(i)}catch(n){throw this.logger.debug("Failed to Publish Request"),this.logger.error(n),n}},this.onPayloadHandler=i=>{this.onProviderPayload(i)},this.onConnectHandler=()=>{this.events.emit(Wt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=i=>{this.logger.error(i),this.events.emit(Wt.error,i),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(oi.payload,this.onPayloadHandler),this.provider.on(oi.connect,this.onConnectHandler),this.provider.on(oi.disconnect,this.onDisconnectHandler),this.provider.on(oi.error,this.onProviderErrorHandler)},this.core=r.core,this.logger=typeof r.logger<"u"&&typeof r.logger!="string"?Se.generateChildLogger(r.logger,this.name):Se.pino(Se.getDefaultLoggerOptions({level:r.logger||_b})),this.messages=new Hb(this.logger,r.core),this.subscriber=new Qb(this,this.logger),this.publisher=new kb(this,this.logger),this.relayUrl=(r==null?void 0:r.relayUrl)||Cf,this.projectId=r.projectId,this.bundleId=Pm(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${gl}...`),await this.restartTransport(gl)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},Pb)}get context(){return Se.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(r,i,n){this.isInitialized(),await this.publisher.publish(r,i,n),await this.recordMessageEvent({topic:r,message:i,publishedAt:Date.now()})}async subscribe(r,i){var n;this.isInitialized();let o=((n=this.subscriber.topicMap.get(r))==null?void 0:n[0])||"";if(o)return o;let h;const d=v=>{v.topic===r&&(this.subscriber.off(Dr.created,d),h())};return await Promise.all([new Promise(v=>{h=v,this.subscriber.on(Dr.created,d)}),new Promise(async v=>{o=await this.subscriber.subscribe(r,i),v()})]),o}async unsubscribe(r,i){this.isInitialized(),await this.subscriber.unsubscribe(r,i)}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}off(r,i){this.events.off(r,i)}removeListener(r,i){this.events.removeListener(r,i)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await Ys(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(r){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){r&&r!==this.relayUrl&&(this.relayUrl=r,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(i=>{if(!this.initialized)return i();this.subscriber.once(Dr.resubscribed,()=>{i()})}),new Promise(async(i,n)=>{try{await Ys(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(o){n(o);return}i()})])}catch(i){this.logger.error(i);const n=i;if(!this.isConnectionStalled(n.message))throw i;this.provider.events.emit(oi.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(r){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=r||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Dh())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(r){return this.staleConnectionErrors.some(i=>r.includes(i))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const r=await this.core.crypto.signJWT(this.relayUrl);this.provider=new ui(new Nw(Sm({sdkVersion:xb,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:r,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(r){const{topic:i,message:n}=r;await this.messages.set(i,n)}async shouldIgnoreMessageEvent(r){const{topic:i,message:n}=r;if(!n||n.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isSubscribed(i))return this.logger.debug(`Ignoring message for non-subscribed topic ${i}`),!0;const o=this.messages.has(i,n);return o&&this.logger.debug(`Ignoring duplicate message: ${n}`),o}async onProviderPayload(r){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:r}),Cc(r)){if(!r.method.endsWith(Eb))return;const i=r.params,{topic:n,message:o,publishedAt:h}=i.data,d={topic:n,message:o,publishedAt:h};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(eE({type:"event",event:i.id},d)),this.events.emit(i.id,d),await this.acknowledgePayload(r),await this.onMessageEvent(d)}else Io(r)&&this.events.emit(Wt.message_ack,r)}async onMessageEvent(r){await this.shouldIgnoreMessageEvent(r)||(this.events.emit(Wt.message,r),await this.recordMessageEvent(r))}async acknowledgePayload(r){const i=bo(r.id,!0);await this.provider.connection.send(i)}unregisterProviderListeners(){this.provider.off(oi.payload,this.onPayloadHandler),this.provider.off(oi.connect,this.onConnectHandler),this.provider.off(oi.disconnect,this.onDisconnectHandler),this.provider.off(oi.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Wt.connection_stalled,()=>{this.restartTransport().catch(i=>this.logger.error(i))});let r=await Dh();Cm(async i=>{this.initialized&&r!==i&&(r=i,i?await this.restartTransport().catch(n=>this.logger.error(n)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(n=>this.logger.error(n))))})}onProviderDisconnect(){this.events.emit(Wt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(r=>this.logger.error(r))},ie.toMiliseconds(Ib)))}isInitialized(){if(!this.initialized){const{message:r}=Y("NOT_INITIALIZED",this.name);throw new Error(r)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(r=>{const i=setInterval(()=>{this.connected&&(clearInterval(i),r())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var rE=Object.defineProperty,_l=Object.getOwnPropertySymbols,iE=Object.prototype.hasOwnProperty,sE=Object.prototype.propertyIsEnumerable,bl=(c,r,i)=>r in c?rE(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,El=(c,r)=>{for(var i in r||(r={}))iE.call(r,i)&&bl(c,i,r[i]);if(_l)for(var i of _l(r))sE.call(r,i)&&bl(c,i,r[i]);return c};class Po extends B1{constructor(r,i,n,o=xi,h=void 0){super(r,i,n,o),this.core=r,this.logger=i,this.name=n,this.map=new Map,this.version=Sb,this.cached=[],this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(d=>{this.getKey&&d!==null&&!Ii(d)?this.map.set(this.getKey(d),d):dm(d)?this.map.set(d.id,d):gm(d)&&this.map.set(d.topic,d)}),this.cached=[],this.initialized=!0)},this.set=async(d,v)=>{this.isInitialized(),this.map.has(d)?await this.update(d,v):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:d,value:v}),this.map.set(d,v),await this.persist())},this.get=d=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:d}),this.getData(d)),this.getAll=d=>(this.isInitialized(),d?this.values.filter(v=>Object.keys(d).every(w=>Dw(v[w],d[w]))):this.values),this.update=async(d,v)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:d,update:v});const w=El(El({},this.getData(d)),v);this.map.set(d,w),await this.persist()},this.delete=async(d,v)=>{this.isInitialized(),this.map.has(d)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:d,reason:v}),this.map.delete(d),await this.persist())},this.logger=Se.generateChildLogger(i,this.name),this.storagePrefix=o,this.getKey=h}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(r){await this.core.storage.setItem(this.storageKey,r)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(r){const i=this.map.get(r);if(!i){const{message:n}=Y("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.error(n),new Error(n)}return i}async persist(){await this.setDataStore(this.values)}async restore(){try{const r=await this.getDataStore();if(typeof r>"u"||!r.length)return;if(this.map.size){const{message:i}=Y("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(r){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(r)}}isInitialized(){if(!this.initialized){const{message:r}=Y("NOT_INITIALIZED",this.name);throw new Error(r)}}}class nE{constructor(r,i){this.core=r,this.logger=i,this.name=Tb,this.version=Nb,this.events=new Ic,this.initialized=!1,this.storagePrefix=xi,this.ignoredPayloadTypes=[Bl],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async()=>{this.isInitialized();const n=pc(),o=await this.core.crypto.setSymKey(n),h=Fr(ie.FIVE_MINUTES),d={protocol:Sf},v={topic:o,expiry:h,relay:d,active:!1},w=Rm({protocol:this.core.protocol,version:this.core.version,topic:o,symKey:n,relay:d});return await this.pairings.set(o,v),await this.core.relayer.subscribe(o),this.core.expirer.set(o,h),{topic:o,uri:w}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:o,symKey:h,relay:d}=Fh(n.uri);let v;if(this.pairings.keys.includes(o)&&(v=this.pairings.get(o),v.active))throw new Error(`Pairing already exists: ${o}. Please try again with a new connection URI.`);const w=Fr(ie.FIVE_MINUTES),y={topic:o,relay:d,expiry:w,active:!1};return await this.pairings.set(o,y),this.core.expirer.set(o,w),n.activatePairing&&await this.activate({topic:o}),this.events.emit(Ws.create,y),this.core.crypto.keychain.has(o)||(await this.core.crypto.setSymKey(h,o),await this.core.relayer.subscribe(o,{relay:d})),y},this.activate=async({topic:n})=>{this.isInitialized();const o=Fr(ie.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:o}),this.core.expirer.set(n,o)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:o}=n;if(this.pairings.keys.includes(o)){const h=await this.sendRequest(o,"wc_pairingPing",{}),{done:d,resolve:v,reject:w}=ps();this.events.once($t("pairing_ping",h),({error:y})=>{y?w(y):v()}),await d()}},this.updateExpiry=async({topic:n,expiry:o})=>{this.isInitialized(),await this.pairings.update(n,{expiry:o})},this.updateMetadata=async({topic:n,metadata:o})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:o})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:o}=n;this.pairings.keys.includes(o)&&(await this.sendRequest(o,"wc_pairingDelete",Gt("USER_DISCONNECTED")),await this.deletePairing(o))},this.sendRequest=async(n,o,h)=>{const d=ys(o,h),v=await this.core.crypto.encode(n,d),w=Hs[o].req;return this.core.history.set(n,d),this.core.relayer.publish(n,v,w),d.id},this.sendResult=async(n,o,h)=>{const d=bo(n,h),v=await this.core.crypto.encode(o,d),w=await this.core.history.get(o,n),y=Hs[w.request.method].res;await this.core.relayer.publish(o,v,y),await this.core.history.resolve(d)},this.sendError=async(n,o,h)=>{const d=Eo(n,h),v=await this.core.crypto.encode(o,d),w=await this.core.history.get(o,n),y=Hs[w.request.method]?Hs[w.request.method].res:Hs.unregistered_method.res;await this.core.relayer.publish(o,v,y),await this.core.history.resolve(d)},this.deletePairing=async(n,o)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,Gt("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),o?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(o=>Ei(o.expiry));await Promise.all(n.map(o=>this.deletePairing(o.topic)))},this.onRelayEventRequest=n=>{const{topic:o,payload:h}=n;switch(h.method){case"wc_pairingPing":return this.onPairingPingRequest(o,h);case"wc_pairingDelete":return this.onPairingDeleteRequest(o,h);default:return this.onUnknownRpcMethodRequest(o,h)}},this.onRelayEventResponse=async n=>{const{topic:o,payload:h}=n,d=(await this.core.history.get(o,h.id)).request.method;switch(d){case"wc_pairingPing":return this.onPairingPingResponse(o,h);default:return this.onUnknownRpcMethodResponse(d)}},this.onPairingPingRequest=async(n,o)=>{const{id:h}=o;try{this.isValidPing({topic:n}),await this.sendResult(h,n,!0),this.events.emit(Ws.ping,{id:h,topic:n})}catch(d){await this.sendError(h,n,d),this.logger.error(d)}},this.onPairingPingResponse=(n,o)=>{const{id:h}=o;setTimeout(()=>{ci(o)?this.events.emit($t("pairing_ping",h),{}):Lr(o)&&this.events.emit($t("pairing_ping",h),{error:o.error})},500)},this.onPairingDeleteRequest=async(n,o)=>{const{id:h}=o;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(Ws.delete,{id:h,topic:n})}catch(d){await this.sendError(h,n,d),this.logger.error(d)}},this.onUnknownRpcMethodRequest=async(n,o)=>{const{id:h,method:d}=o;try{if(this.registeredMethods.includes(d))return;const v=Gt("WC_METHOD_UNSUPPORTED",d);await this.sendError(h,n,v),this.logger.error(v)}catch(v){await this.sendError(h,n,v),this.logger.error(v)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error(Gt("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{var o;if(!hr(n)){const{message:d}=Y("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(d)}if(!Om(n.uri)){const{message:d}=Y("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(d)}const h=Fh(n.uri);if(!((o=h==null?void 0:h.relay)!=null&&o.protocol)){const{message:d}=Y("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(d)}if(!(h!=null&&h.symKey)){const{message:d}=Y("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(d)}},this.isValidPing=async n=>{if(!hr(n)){const{message:h}=Y("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(h)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidDisconnect=async n=>{if(!hr(n)){const{message:h}=Y("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(h)}const{topic:o}=n;await this.isValidPairingTopic(o)},this.isValidPairingTopic=async n=>{if(!ds(n,!1)){const{message:o}=Y("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(o)}if(!this.pairings.keys.includes(n)){const{message:o}=Y("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(o)}if(Ei(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:o}=Y("EXPIRED",`pairing topic: ${n}`);throw new Error(o)}},this.core=r,this.logger=Se.generateChildLogger(i,this.name),this.pairings=new Po(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Se.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:r}=Y("NOT_INITIALIZED",this.name);throw new Error(r)}}registerRelayerEvents(){this.core.relayer.on(Wt.message,async r=>{const{topic:i,message:n}=r;if(!this.pairings.keys.includes(i)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const o=await this.core.crypto.decode(i,n);try{Cc(o)?(this.core.history.set(i,o),this.onRelayEventRequest({topic:i,payload:o})):Io(o)&&(await this.core.history.resolve(o),await this.onRelayEventResponse({topic:i,payload:o}),this.core.history.delete(i,o.id))}catch(h){this.logger.error(h)}})}registerExpirerEvents(){this.core.expirer.on(Sr.expired,async r=>{const{topic:i}=Vl(r.target);i&&this.pairings.keys.includes(i)&&(await this.deletePairing(i,!0),this.events.emit(Ws.expire,{topic:i}))})}}class oE extends U1{constructor(r,i){super(r,i),this.core=r,this.logger=i,this.records=new Map,this.events=new Cr.EventEmitter,this.name=$b,this.version=Db,this.cached=[],this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,o,h)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:o,chainId:h}),this.records.has(o.id))return;const d={id:o.id,topic:n,request:{method:o.method,params:o.params||null},chainId:h,expiry:Fr(ie.THIRTY_DAYS)};this.records.set(d.id,d),this.events.emit(Kr.created,d)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const o=await this.getRecord(n.id);typeof o.response>"u"&&(o.response=Lr(n)?{error:n.error}:{result:n.result},this.records.set(o.id,o),this.events.emit(Kr.updated,o))},this.get=async(n,o)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:o}),await this.getRecord(o)),this.delete=(n,o)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:o}),this.values.forEach(h=>{if(h.topic===n){if(typeof o<"u"&&h.id!==o)return;this.records.delete(h.id),this.events.emit(Kr.deleted,h)}})},this.exists=async(n,o)=>(this.isInitialized(),this.records.has(o)?(await this.getRecord(o)).topic===n:!1),this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=Se.generateChildLogger(i,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const r=[];return this.values.forEach(i=>{if(typeof i.response<"u")return;const n={topic:i.topic,request:ys(i.request.method,i.request.params,i.id),chainId:i.chainId};return r.push(n)}),r}async setJsonRpcRecords(r){await this.core.storage.setItem(this.storageKey,r)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(r){this.isInitialized();const i=this.records.get(r);if(!i){const{message:n}=Y("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(n)}return i}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Kr.sync)}async restore(){try{const r=await this.getJsonRpcRecords();if(typeof r>"u"||!r.length)return;if(this.records.size){const{message:i}=Y("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}}registerEventListeners(){this.events.on(Kr.created,r=>{const i=Kr.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:r}),this.persist()}),this.events.on(Kr.updated,r=>{const i=Kr.updated;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:r}),this.persist()}),this.events.on(Kr.deleted,r=>{const i=Kr.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:r}),this.persist()}),this.core.heartbeat.on(_s.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(r=>{ie.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.delete(r.topic,r.id))})}catch(r){this.logger.warn(r)}}isInitialized(){if(!this.initialized){const{message:r}=Y("NOT_INITIALIZED",this.name);throw new Error(r)}}}class aE extends G1{constructor(r,i){super(r,i),this.core=r,this.logger=i,this.expirations=new Map,this.events=new Cr.EventEmitter,this.name=Fb,this.version=Lb,this.cached=[],this.initialized=!1,this.storagePrefix=xi,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const o=this.formatTarget(n);return typeof this.getExpiration(o)<"u"}catch{return!1}},this.set=(n,o)=>{this.isInitialized();const h=this.formatTarget(n),d={target:h,expiry:o};this.expirations.set(h,d),this.checkExpiry(h,d),this.events.emit(Sr.created,{target:h,expiration:d})},this.get=n=>{this.isInitialized();const o=this.formatTarget(n);return this.getExpiration(o)},this.del=n=>{if(this.isInitialized(),this.has(n)){const o=this.formatTarget(n),h=this.getExpiration(o);this.expirations.delete(o),this.events.emit(Sr.deleted,{target:o,expiration:h})}},this.on=(n,o)=>{this.events.on(n,o)},this.once=(n,o)=>{this.events.once(n,o)},this.off=(n,o)=>{this.events.off(n,o)},this.removeListener=(n,o)=>{this.events.removeListener(n,o)},this.logger=Se.generateChildLogger(i,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(r){if(typeof r=="string")return Am(r);if(typeof r=="number")return Tm(r);const{message:i}=Y("UNKNOWN_TYPE",`Target type: ${typeof r}`);throw new Error(i)}async setExpirations(r){await this.core.storage.setItem(this.storageKey,r)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Sr.sync)}async restore(){try{const r=await this.getExpirations();if(typeof r>"u"||!r.length)return;if(this.expirations.size){const{message:i}=Y("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(r){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(r)}}getExpiration(r){const i=this.expirations.get(r);if(!i){const{message:n}=Y("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.error(n),new Error(n)}return i}checkExpiry(r,i){const{expiry:n}=i;ie.toMiliseconds(n)-Date.now()<=0&&this.expire(r,i)}expire(r,i){this.expirations.delete(r),this.events.emit(Sr.expired,{target:r,expiration:i})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((r,i)=>this.checkExpiry(i,r))}registerEventListeners(){this.core.heartbeat.on(_s.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Sr.created,r=>{const i=Sr.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),this.persist()}),this.events.on(Sr.expired,r=>{const i=Sr.expired;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),this.persist()}),this.events.on(Sr.deleted,r=>{const i=Sr.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=Y("NOT_INITIALIZED",this.name);throw new Error(r)}}}class cE extends W1{constructor(r,i){super(r,i),this.projectId=r,this.logger=i,this.name=nc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async n=>{if(this.verifyDisabled||Nm()||!Gl())return;const o=this.getVerifyUrl(n==null?void 0:n.verifyUrl);this.verifyUrl!==o&&this.removeIframe(),this.verifyUrl=o;try{await this.createIframe()}catch(h){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(h)}if(!this.initialized){this.removeIframe(),this.verifyUrl=mc;try{await this.createIframe()}catch(h){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(h),this.verifyDisabled=!0}}},this.register=async n=>{this.initialized?this.sendPost(n.attestationId):(this.addToQueue(n.attestationId),await this.init())},this.resolve=async n=>{if(this.isDevEnv)return"";const o=this.getVerifyUrl(n==null?void 0:n.verifyUrl);let h;try{h=await this.fetchAttestation(n.attestationId,o)}catch(d){this.logger.info(`failed to resolve attestation: ${n.attestationId} from url: ${o}`),this.logger.info(d),h=await this.fetchAttestation(n.attestationId,mc)}return h},this.fetchAttestation=async(n,o)=>{this.logger.info(`resolving attestation: ${n} from url: ${o}`);const h=this.startAbortTimer(ie.ONE_SECOND*2),d=await fetch(`${o}/attestation/${n}`,{signal:this.abortController.signal});return clearTimeout(h),d.status===200?await d.json():void 0},this.addToQueue=n=>{this.queue.push(n)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(n=>this.sendPost(n)),this.queue=[])},this.sendPost=n=>{var o;try{if(!this.iframe)return;(o=this.iframe.contentWindow)==null||o.postMessage(n,"*"),this.logger.info(`postMessage sent: ${n} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let n;const o=h=>{h.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",o),n())};await Promise.race([new Promise(h=>{if(document.getElementById(nc))return h();window.addEventListener("message",o);const d=document.createElement("iframe");d.id=nc,d.src=`${this.verifyUrl}/${this.projectId}`,d.style.display="none",document.body.append(d),this.iframe=d,n=h}),new Promise((h,d)=>setTimeout(()=>{window.removeEventListener("message",o),d("verify iframe load timeout")},ie.toMiliseconds(ie.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=n=>{let o=n||gs;return qb.includes(o)||(this.logger.info(`verify url: ${o}, not included in trusted list, assigning default: ${gs}`),o=gs),o},this.logger=Se.generateChildLogger(i,this.name),this.verifyUrl=gs,this.abortController=new AbortController,this.isDevEnv=$m()&&{}.IS_VITEST}get context(){return Se.getLoggerContext(this.logger)}startAbortTimer(r){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),ie.toMiliseconds(r))}}class uE extends J1{constructor(r,i){super(r,i),this.projectId=r,this.logger=i,this.context=Mb,this.registerDeviceToken=async n=>{const{clientId:o,token:h,notificationType:d,enableEncrypted:v=!1}=n,w=`${jb}/${this.projectId}/clients`;await Mw(w,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:o,type:d,token:h,always_raw:v})})},this.logger=Se.generateChildLogger(i,this.context)}}var hE=Object.defineProperty,Il=Object.getOwnPropertySymbols,lE=Object.prototype.hasOwnProperty,fE=Object.prototype.propertyIsEnumerable,xl=(c,r,i)=>r in c?hE(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,Pl=(c,r)=>{for(var i in r||(r={}))lE.call(r,i)&&xl(c,i,r[i]);if(Il)for(var i of Il(r))fE.call(r,i)&&xl(c,i,r[i]);return c};class Oc extends z1{constructor(r){super(r),this.protocol=Pf,this.version=ub,this.name=Rc,this.events=new Cr.EventEmitter,this.initialized=!1,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.projectId=r==null?void 0:r.projectId,this.relayUrl=(r==null?void 0:r.relayUrl)||Cf,this.customStoragePrefix=r!=null&&r.customStoragePrefix?`:${r.customStoragePrefix}`:"";const i=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:Se.pino(Se.getDefaultLoggerOptions({level:(r==null?void 0:r.logger)||hb.logger}));this.logger=Se.generateChildLogger(i,this.name),this.heartbeat=new _s.HeartBeat,this.crypto=new Ub(this,this.logger,r==null?void 0:r.keychain),this.history=new oE(this,this.logger),this.expirer=new aE(this,this.logger),this.storage=r!=null&&r.storage?r.storage:new T1(Pl(Pl({},lb),r==null?void 0:r.storageOptions)),this.relayer=new tE({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new nE(this,this.logger),this.verify=new cE(this.projectId||"",this.logger),this.echoClient=new uE(this.projectId||"",this.logger)}static async init(r){const i=new Oc(r);await i.initialize();const n=await i.crypto.getClientId();return await i.storage.setItem(Cb,n),i}get context(){return Se.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(r){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,r),this.logger.error(r.message),r}}}const pE=Oc,Rf="wc",Of=2,Af="client",Ac=`${Rf}@${Of}:${Af}:`,ac={name:Af,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Sl="WALLETCONNECT_DEEPLINK_CHOICE",dE="proposal",Tf="Proposal expired",gE="session",uo=ie.SEVEN_DAYS,vE="engine",Ks={wc_sessionPropose:{req:{ttl:ie.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:ie.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:ie.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:ie.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:ie.ONE_DAY,prompt:!1,tag:1104},res:{ttl:ie.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:ie.ONE_DAY,prompt:!1,tag:1106},res:{ttl:ie.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:ie.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:ie.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:ie.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:ie.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:ie.ONE_DAY,prompt:!1,tag:1112},res:{ttl:ie.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:ie.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:ie.THIRTY_SECONDS,prompt:!1,tag:1115}}},cc={min:ie.FIVE_MINUTES,max:ie.SEVEN_DAYS},ai={idle:"IDLE",active:"ACTIVE"},yE="request",mE=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var wE=Object.defineProperty,_E=Object.defineProperties,bE=Object.getOwnPropertyDescriptors,Cl=Object.getOwnPropertySymbols,EE=Object.prototype.hasOwnProperty,IE=Object.prototype.propertyIsEnumerable,Rl=(c,r,i)=>r in c?wE(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,cr=(c,r)=>{for(var i in r||(r={}))EE.call(r,i)&&Rl(c,i,r[i]);if(Cl)for(var i of Cl(r))IE.call(r,i)&&Rl(c,i,r[i]);return c},Bs=(c,r)=>_E(c,bE(r));class xE extends Y1{constructor(r){super(r),this.name=vE,this.events=new Ic,this.initialized=!1,this.ignoredPayloadTypes=[Bl],this.requestQueue={state:ai.idle,queue:[]},this.sessionRequestQueue={state:ai.idle,queue:[]},this.requestQueueDelay=ie.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Ks)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},ie.toMiliseconds(this.requestQueueDelay)))},this.connect=async i=>{await this.isInitialized();const n=Bs(cr({},i),{requiredNamespaces:i.requiredNamespaces||{},optionalNamespaces:i.optionalNamespaces||{}});await this.isValidConnect(n);const{pairingTopic:o,requiredNamespaces:h,optionalNamespaces:d,sessionProperties:v,relays:w}=n;let y=o,E,C=!1;if(y&&(C=this.client.core.pairing.pairings.get(y).active),!y||!C){const{topic:he,uri:fe}=await this.client.core.pairing.create();y=he,E=fe}const O=await this.client.core.crypto.generateKeyPair(),j=cr({requiredNamespaces:h,optionalNamespaces:d,relays:w??[{protocol:Sf}],proposer:{publicKey:O,metadata:this.client.metadata}},v&&{sessionProperties:v}),{reject:D,resolve:K,done:re}=ps(ie.FIVE_MINUTES,Tf);if(this.events.once($t("session_connect"),async({error:he,session:fe})=>{if(he)D(he);else if(fe){fe.self.publicKey=O;const pe=Bs(cr({},fe),{requiredNamespaces:fe.requiredNamespaces,optionalNamespaces:fe.optionalNamespaces});await this.client.session.set(fe.topic,pe),await this.setExpiry(fe.topic,fe.expiry),y&&await this.client.core.pairing.updateMetadata({topic:y,metadata:fe.peer.metadata}),K(pe)}}),!y){const{message:he}=Y("NO_MATCHING_KEY",`connect() pairing topic: ${y}`);throw new Error(he)}const ce=await this.sendRequest({topic:y,method:"wc_sessionPropose",params:j}),ue=Fr(ie.FIVE_MINUTES);return await this.setProposal(ce,cr({id:ce,expiry:ue},j)),{uri:E,approval:re}},this.pair=async i=>(await this.isInitialized(),await this.client.core.pairing.pair(i)),this.approve=async i=>{await this.isInitialized(),await this.isValidApprove(i);const{id:n,relayProtocol:o,namespaces:h,sessionProperties:d}=i,v=this.client.proposal.get(n);let{pairingTopic:w,proposer:y,requiredNamespaces:E,optionalNamespaces:C}=v;w=w||"",po(E)||(E=Fm(h,"approve()"));const O=await this.client.core.crypto.generateKeyPair(),j=y.publicKey,D=await this.client.core.crypto.generateSharedKey(O,j);w&&n&&(await this.client.core.pairing.updateMetadata({topic:w,metadata:y.metadata}),await this.sendResult({id:n,topic:w,result:{relay:{protocol:o??"irn"},responderPublicKey:O}}),await this.client.proposal.delete(n,Gt("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:w}));const K=cr({relay:{protocol:o??"irn"},namespaces:h,requiredNamespaces:E,optionalNamespaces:C,pairingTopic:w,controller:{publicKey:O,metadata:this.client.metadata},expiry:Fr(uo)},d&&{sessionProperties:d});await this.client.core.relayer.subscribe(D),await this.sendRequest({topic:D,method:"wc_sessionSettle",params:K,throwOnFailedPublish:!0});const re=Bs(cr({},K),{topic:D,pairingTopic:w,acknowledged:!1,self:K.controller,peer:{publicKey:y.publicKey,metadata:y.metadata},controller:O});return await this.client.session.set(D,re),await this.setExpiry(D,Fr(uo)),{topic:D,acknowledged:()=>new Promise(ce=>setTimeout(()=>ce(this.client.session.get(D)),500))}},this.reject=async i=>{await this.isInitialized(),await this.isValidReject(i);const{id:n,reason:o}=i,{pairingTopic:h}=this.client.proposal.get(n);h&&(await this.sendError(n,h,o),await this.client.proposal.delete(n,Gt("USER_DISCONNECTED")))},this.update=async i=>{await this.isInitialized(),await this.isValidUpdate(i);const{topic:n,namespaces:o}=i,h=await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:o}}),{done:d,resolve:v,reject:w}=ps();return this.events.once($t("session_update",h),({error:y})=>{y?w(y):v()}),await this.client.session.update(n,{namespaces:o}),{acknowledged:d}},this.extend=async i=>{await this.isInitialized(),await this.isValidExtend(i);const{topic:n}=i,o=await this.sendRequest({topic:n,method:"wc_sessionExtend",params:{}}),{done:h,resolve:d,reject:v}=ps();return this.events.once($t("session_extend",o),({error:w})=>{w?v(w):d()}),await this.setExpiry(n,Fr(uo)),{acknowledged:h}},this.request=async i=>{await this.isInitialized(),await this.isValidRequest(i);const{chainId:n,request:o,topic:h,expiry:d}=i,v=Sc(),{done:w,resolve:y,reject:E}=ps(d,"Request expired. Please try again.");return this.events.once($t("session_request",v),({error:C,result:O})=>{C?E(C):y(O)}),await Promise.all([new Promise(async C=>{await this.sendRequest({clientRpcId:v,topic:h,method:"wc_sessionRequest",params:{request:o,chainId:n},expiry:d,throwOnFailedPublish:!0}).catch(O=>E(O)),this.client.events.emit("session_request_sent",{topic:h,request:o,chainId:n,id:v}),C()}),new Promise(async C=>{const O=await Lm(this.client.core.storage,Sl);qm({id:v,topic:h,wcDeepLink:O}),C()}),w()]).then(C=>C[2])},this.respond=async i=>{await this.isInitialized(),await this.isValidRespond(i);const{topic:n,response:o}=i,{id:h}=o;ci(o)?await this.sendResult({id:h,topic:n,result:o.result,throwOnFailedPublish:!0}):Lr(o)&&await this.sendError(h,n,o.error),this.cleanupAfterResponse(i)},this.ping=async i=>{await this.isInitialized(),await this.isValidPing(i);const{topic:n}=i;if(this.client.session.keys.includes(n)){const o=await this.sendRequest({topic:n,method:"wc_sessionPing",params:{}}),{done:h,resolve:d,reject:v}=ps();this.events.once($t("session_ping",o),({error:w})=>{w?v(w):d()}),await h()}else this.client.core.pairing.pairings.keys.includes(n)&&await this.client.core.pairing.ping({topic:n})},this.emit=async i=>{await this.isInitialized(),await this.isValidEmit(i);const{topic:n,event:o,chainId:h}=i;await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:o,chainId:h}})},this.disconnect=async i=>{await this.isInitialized(),await this.isValidDisconnect(i);const{topic:n}=i;this.client.session.keys.includes(n)?(await this.sendRequest({topic:n,method:"wc_sessionDelete",params:Gt("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(n)):await this.client.core.pairing.disconnect({topic:n})},this.find=i=>(this.isInitialized(),this.client.session.getAll().filter(n=>Mm(n,i))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async i=>{if(i.pairingTopic)try{const n=this.client.core.pairing.pairings.get(i.pairingTopic),o=this.client.core.pairing.pairings.getAll().filter(h=>{var d,v;return((d=h.peerMetadata)==null?void 0:d.url)&&((v=h.peerMetadata)==null?void 0:v.url)===i.peer.metadata.url&&h.topic&&h.topic!==n.topic});if(o.length===0)return;this.client.logger.info(`Cleaning up ${o.length} duplicate pairing(s)`),await Promise.all(o.map(h=>this.client.core.pairing.disconnect({topic:h.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}},this.deleteSession=async(i,n)=>{const{self:o}=this.client.session.get(i);await this.client.core.relayer.unsubscribe(i),this.client.session.delete(i,Gt("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(o.publicKey)&&await this.client.core.crypto.deleteKeyPair(o.publicKey),this.client.core.crypto.keychain.has(i)&&await this.client.core.crypto.deleteSymKey(i),n||this.client.core.expirer.del(i),this.client.core.storage.removeItem(Sl).catch(h=>this.client.logger.warn(h)),this.getPendingSessionRequests().forEach(h=>{h.topic===i&&this.deletePendingSessionRequest(h.id,Gt("USER_DISCONNECTED"))})},this.deleteProposal=async(i,n)=>{await Promise.all([this.client.proposal.delete(i,Gt("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(i)])},this.deletePendingSessionRequest=async(i,n,o=!1)=>{await Promise.all([this.client.pendingRequest.delete(i,n),o?Promise.resolve():this.client.core.expirer.del(i)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(h=>h.id!==i),o&&(this.sessionRequestQueue.state=ai.idle)},this.setExpiry=async(i,n)=>{this.client.session.keys.includes(i)&&await this.client.session.update(i,{expiry:n}),this.client.core.expirer.set(i,n)},this.setProposal=async(i,n)=>{await this.client.proposal.set(i,n),this.client.core.expirer.set(i,n.expiry)},this.setPendingSessionRequest=async i=>{const n=Ks.wc_sessionRequest.req.ttl,{id:o,topic:h,params:d,verifyContext:v}=i;await this.client.pendingRequest.set(o,{id:o,topic:h,params:d,verifyContext:v}),n&&this.client.core.expirer.set(o,Fr(n))},this.sendRequest=async i=>{const{topic:n,method:o,params:h,expiry:d,relayRpcId:v,clientRpcId:w,throwOnFailedPublish:y}=i,E=ys(o,h,w);if(Gl()&&mE.includes(o)){const j=vs(JSON.stringify(E));this.client.core.verify.register({attestationId:j})}const C=await this.client.core.crypto.encode(n,E),O=Ks[o].req;return d&&(O.ttl=d),v&&(O.id=v),this.client.core.history.set(n,E),y?(O.internal=Bs(cr({},O.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,C,O)):this.client.core.relayer.publish(n,C,O).catch(j=>this.client.logger.error(j)),E.id},this.sendResult=async i=>{const{id:n,topic:o,result:h,throwOnFailedPublish:d}=i,v=bo(n,h),w=await this.client.core.crypto.encode(o,v),y=await this.client.core.history.get(o,n),E=Ks[y.request.method].res;d?(E.internal=Bs(cr({},E.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(o,w,E)):this.client.core.relayer.publish(o,w,E).catch(C=>this.client.logger.error(C)),await this.client.core.history.resolve(v)},this.sendError=async(i,n,o)=>{const h=Eo(i,o),d=await this.client.core.crypto.encode(n,h),v=await this.client.core.history.get(n,i),w=Ks[v.request.method].res;this.client.core.relayer.publish(n,d,w),await this.client.core.history.resolve(h)},this.cleanup=async()=>{const i=[],n=[];this.client.session.getAll().forEach(o=>{Ei(o.expiry)&&i.push(o.topic)}),this.client.proposal.getAll().forEach(o=>{Ei(o.expiry)&&n.push(o.id)}),await Promise.all([...i.map(o=>this.deleteSession(o)),...n.map(o=>this.deleteProposal(o))])},this.onRelayEventRequest=async i=>{this.requestQueue.queue.push(i),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===ai.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=ai.active;const i=this.requestQueue.queue.shift();if(i)try{this.processRequest(i),await new Promise(n=>setTimeout(n,300))}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=ai.idle},this.processRequest=i=>{const{topic:n,payload:o}=i,h=o.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeRequest(n,o);case"wc_sessionSettle":return this.onSessionSettleRequest(n,o);case"wc_sessionUpdate":return this.onSessionUpdateRequest(n,o);case"wc_sessionExtend":return this.onSessionExtendRequest(n,o);case"wc_sessionPing":return this.onSessionPingRequest(n,o);case"wc_sessionDelete":return this.onSessionDeleteRequest(n,o);case"wc_sessionRequest":return this.onSessionRequest(n,o);case"wc_sessionEvent":return this.onSessionEventRequest(n,o);default:return this.client.logger.info(`Unsupported request method ${h}`)}},this.onRelayEventResponse=async i=>{const{topic:n,payload:o}=i,h=(await this.client.core.history.get(n,o.id)).request.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeResponse(n,o);case"wc_sessionSettle":return this.onSessionSettleResponse(n,o);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,o);case"wc_sessionExtend":return this.onSessionExtendResponse(n,o);case"wc_sessionPing":return this.onSessionPingResponse(n,o);case"wc_sessionRequest":return this.onSessionRequestResponse(n,o);default:return this.client.logger.info(`Unsupported response method ${h}`)}},this.onRelayEventUnknownPayload=i=>{const{topic:n}=i,{message:o}=Y("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(o)},this.onSessionProposeRequest=async(i,n)=>{const{params:o,id:h}=n;try{this.isValidConnect(cr({},n.params));const d=Fr(ie.FIVE_MINUTES),v=cr({id:h,pairingTopic:i,expiry:d},o);await this.setProposal(h,v);const w=vs(JSON.stringify(n)),y=await this.getVerifyContext(w,v.proposer.metadata);this.client.events.emit("session_proposal",{id:h,params:v,verifyContext:y})}catch(d){await this.sendError(h,i,d),this.client.logger.error(d)}},this.onSessionProposeResponse=async(i,n)=>{const{id:o}=n;if(ci(n)){const{result:h}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:h});const d=this.client.proposal.get(o);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:d});const v=d.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:v});const w=h.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:w});const y=await this.client.core.crypto.generateSharedKey(v,w);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:y});const E=await this.client.core.relayer.subscribe(y);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:E}),await this.client.core.pairing.activate({topic:i})}else Lr(n)&&(await this.client.proposal.delete(o,Gt("USER_DISCONNECTED")),this.events.emit($t("session_connect"),{error:n.error}))},this.onSessionSettleRequest=async(i,n)=>{const{id:o,params:h}=n;try{this.isValidSessionSettleRequest(h);const{relay:d,controller:v,expiry:w,namespaces:y,requiredNamespaces:E,optionalNamespaces:C,sessionProperties:O,pairingTopic:j}=n.params,D=cr({topic:i,relay:d,expiry:w,namespaces:y,acknowledged:!0,pairingTopic:j,requiredNamespaces:E,optionalNamespaces:C,controller:v.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:v.publicKey,metadata:v.metadata}},O&&{sessionProperties:O});await this.sendResult({id:n.id,topic:i,result:!0}),this.events.emit($t("session_connect"),{session:D}),this.cleanupDuplicatePairings(D)}catch(d){await this.sendError(o,i,d),this.client.logger.error(d)}},this.onSessionSettleResponse=async(i,n)=>{const{id:o}=n;ci(n)?(await this.client.session.update(i,{acknowledged:!0}),this.events.emit($t("session_approve",o),{})):Lr(n)&&(await this.client.session.delete(i,Gt("USER_DISCONNECTED")),this.events.emit($t("session_approve",o),{error:n.error}))},this.onSessionUpdateRequest=async(i,n)=>{const{params:o,id:h}=n;try{const d=`${i}_session_update`,v=oo.get(d);if(v&&this.isRequestOutOfSync(v,h)){this.client.logger.info(`Discarding out of sync request - ${h}`);return}this.isValidUpdate(cr({topic:i},o)),await this.client.session.update(i,{namespaces:o.namespaces}),await this.sendResult({id:h,topic:i,result:!0}),this.client.events.emit("session_update",{id:h,topic:i,params:o}),oo.set(d,h)}catch(d){await this.sendError(h,i,d),this.client.logger.error(d)}},this.isRequestOutOfSync=(i,n)=>parseInt(n.toString().slice(0,-3))<=parseInt(i.toString().slice(0,-3)),this.onSessionUpdateResponse=(i,n)=>{const{id:o}=n;ci(n)?this.events.emit($t("session_update",o),{}):Lr(n)&&this.events.emit($t("session_update",o),{error:n.error})},this.onSessionExtendRequest=async(i,n)=>{const{id:o}=n;try{this.isValidExtend({topic:i}),await this.setExpiry(i,Fr(uo)),await this.sendResult({id:o,topic:i,result:!0}),this.client.events.emit("session_extend",{id:o,topic:i})}catch(h){await this.sendError(o,i,h),this.client.logger.error(h)}},this.onSessionExtendResponse=(i,n)=>{const{id:o}=n;ci(n)?this.events.emit($t("session_extend",o),{}):Lr(n)&&this.events.emit($t("session_extend",o),{error:n.error})},this.onSessionPingRequest=async(i,n)=>{const{id:o}=n;try{this.isValidPing({topic:i}),await this.sendResult({id:o,topic:i,result:!0}),this.client.events.emit("session_ping",{id:o,topic:i})}catch(h){await this.sendError(o,i,h),this.client.logger.error(h)}},this.onSessionPingResponse=(i,n)=>{const{id:o}=n;setTimeout(()=>{ci(n)?this.events.emit($t("session_ping",o),{}):Lr(n)&&this.events.emit($t("session_ping",o),{error:n.error})},500)},this.onSessionDeleteRequest=async(i,n)=>{const{id:o}=n;try{this.isValidDisconnect({topic:i,reason:n.params}),await Promise.all([new Promise(h=>{this.client.core.relayer.once(Wt.publish,async()=>{h(await this.deleteSession(i))})}),this.sendResult({id:o,topic:i,result:!0})]),this.client.events.emit("session_delete",{id:o,topic:i})}catch(h){this.client.logger.error(h)}},this.onSessionRequest=async(i,n)=>{const{id:o,params:h}=n;try{this.isValidRequest(cr({topic:i},h));const d=vs(JSON.stringify(ys("wc_sessionRequest",h,o))),v=this.client.session.get(i),w=await this.getVerifyContext(d,v.peer.metadata),y={id:o,topic:i,params:h,verifyContext:w};await this.setPendingSessionRequest(y),this.addSessionRequestToSessionRequestQueue(y),this.processSessionRequestQueue()}catch(d){await this.sendError(o,i,d),this.client.logger.error(d)}},this.onSessionRequestResponse=(i,n)=>{const{id:o}=n;ci(n)?this.events.emit($t("session_request",o),{result:n.result}):Lr(n)&&this.events.emit($t("session_request",o),{error:n.error})},this.onSessionEventRequest=async(i,n)=>{const{id:o,params:h}=n;try{const d=`${i}_session_event_${h.event.name}`,v=oo.get(d);if(v&&this.isRequestOutOfSync(v,o)){this.client.logger.info(`Discarding out of sync request - ${o}`);return}this.isValidEmit(cr({topic:i},h)),this.client.events.emit("session_event",{id:o,topic:i,params:h}),oo.set(d,o)}catch(d){await this.sendError(o,i,d),this.client.logger.error(d)}},this.addSessionRequestToSessionRequestQueue=i=>{this.sessionRequestQueue.queue.push(i)},this.cleanupAfterResponse=i=>{this.deletePendingSessionRequest(i.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=ai.idle,this.processSessionRequestQueue()},ie.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===ai.active){this.client.logger.info("session request queue is already active.");return}const i=this.sessionRequestQueue.queue[0];if(!i){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=ai.active,this.client.events.emit("session_request",i)}catch(n){this.client.logger.error(n)}},this.onPairingCreated=i=>{if(i.active)return;const n=this.client.proposal.getAll().find(o=>o.pairingTopic===i.topic);n&&this.onSessionProposeRequest(i.topic,ys("wc_sessionPropose",{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer,sessionProperties:n.sessionProperties},n.id))},this.isValidConnect=async i=>{if(!hr(i)){const{message:w}=Y("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(i)}`);throw new Error(w)}const{pairingTopic:n,requiredNamespaces:o,optionalNamespaces:h,sessionProperties:d,relays:v}=i;if(Ii(n)||await this.isValidPairingTopic(n),!jm(v,!0)){const{message:w}=Y("MISSING_OR_INVALID",`connect() relays: ${v}`);throw new Error(w)}!Ii(o)&&po(o)!==0&&this.validateNamespaces(o,"requiredNamespaces"),!Ii(h)&&po(h)!==0&&this.validateNamespaces(h,"optionalNamespaces"),Ii(d)||this.validateSessionProps(d,"sessionProperties")},this.validateNamespaces=(i,n)=>{const o=zm(i,"connect()",n);if(o)throw new Error(o.message)},this.isValidApprove=async i=>{if(!hr(i))throw new Error(Y("MISSING_OR_INVALID",`approve() params: ${i}`).message);const{id:n,namespaces:o,relayProtocol:h,sessionProperties:d}=i;await this.isValidProposalId(n);const v=this.client.proposal.get(n),w=Qa(o,"approve()");if(w)throw new Error(w.message);const y=Lh(v.requiredNamespaces,o,"approve()");if(y)throw new Error(y.message);if(!ds(h,!0)){const{message:E}=Y("MISSING_OR_INVALID",`approve() relayProtocol: ${h}`);throw new Error(E)}Ii(d)||this.validateSessionProps(d,"sessionProperties")},this.isValidReject=async i=>{if(!hr(i)){const{message:h}=Y("MISSING_OR_INVALID",`reject() params: ${i}`);throw new Error(h)}const{id:n,reason:o}=i;if(await this.isValidProposalId(n),!Um(o)){const{message:h}=Y("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(o)}`);throw new Error(h)}},this.isValidSessionSettleRequest=i=>{if(!hr(i)){const{message:y}=Y("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${i}`);throw new Error(y)}const{relay:n,controller:o,namespaces:h,expiry:d}=i;if(!Hm(n)){const{message:y}=Y("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(y)}const v=km(o,"onSessionSettleRequest()");if(v)throw new Error(v.message);const w=Qa(h,"onSessionSettleRequest()");if(w)throw new Error(w.message);if(Ei(d)){const{message:y}=Y("EXPIRED","onSessionSettleRequest()");throw new Error(y)}},this.isValidUpdate=async i=>{if(!hr(i)){const{message:w}=Y("MISSING_OR_INVALID",`update() params: ${i}`);throw new Error(w)}const{topic:n,namespaces:o}=i;await this.isValidSessionTopic(n);const h=this.client.session.get(n),d=Qa(o,"update()");if(d)throw new Error(d.message);const v=Lh(h.requiredNamespaces,o,"update()");if(v)throw new Error(v.message)},this.isValidExtend=async i=>{if(!hr(i)){const{message:o}=Y("MISSING_OR_INVALID",`extend() params: ${i}`);throw new Error(o)}const{topic:n}=i;await this.isValidSessionTopic(n)},this.isValidRequest=async i=>{if(!hr(i)){const{message:w}=Y("MISSING_OR_INVALID",`request() params: ${i}`);throw new Error(w)}const{topic:n,request:o,chainId:h,expiry:d}=i;await this.isValidSessionTopic(n);const{namespaces:v}=this.client.session.get(n);if(!qh(v,h)){const{message:w}=Y("MISSING_OR_INVALID",`request() chainId: ${h}`);throw new Error(w)}if(!Km(o)){const{message:w}=Y("MISSING_OR_INVALID",`request() ${JSON.stringify(o)}`);throw new Error(w)}if(!Bm(v,h,o.method)){const{message:w}=Y("MISSING_OR_INVALID",`request() method: ${o.method}`);throw new Error(w)}if(d&&!Vm(d,cc)){const{message:w}=Y("MISSING_OR_INVALID",`request() expiry: ${d}. Expiry must be a number (in seconds) between ${cc.min} and ${cc.max}`);throw new Error(w)}},this.isValidRespond=async i=>{var n;if(!hr(i)){const{message:d}=Y("MISSING_OR_INVALID",`respond() params: ${i}`);throw new Error(d)}const{topic:o,response:h}=i;try{await this.isValidSessionTopic(o)}catch(d){throw(n=i==null?void 0:i.response)!=null&&n.id&&this.cleanupAfterResponse(i),d}if(!Gm(h)){const{message:d}=Y("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(h)}`);throw new Error(d)}},this.isValidPing=async i=>{if(!hr(i)){const{message:o}=Y("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(o)}const{topic:n}=i;await this.isValidSessionOrPairingTopic(n)},this.isValidEmit=async i=>{if(!hr(i)){const{message:v}=Y("MISSING_OR_INVALID",`emit() params: ${i}`);throw new Error(v)}const{topic:n,event:o,chainId:h}=i;await this.isValidSessionTopic(n);const{namespaces:d}=this.client.session.get(n);if(!qh(d,h)){const{message:v}=Y("MISSING_OR_INVALID",`emit() chainId: ${h}`);throw new Error(v)}if(!Wm(o)){const{message:v}=Y("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(v)}if(!Jm(d,h,o.name)){const{message:v}=Y("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(v)}},this.isValidDisconnect=async i=>{if(!hr(i)){const{message:o}=Y("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(o)}const{topic:n}=i;await this.isValidSessionOrPairingTopic(n)},this.getVerifyContext=async(i,n)=>{const o={verified:{verifyUrl:n.verifyUrl||gs,validation:"UNKNOWN",origin:n.url||""}};try{const h=await this.client.core.verify.resolve({attestationId:i,verifyUrl:n.verifyUrl});h&&(o.verified.origin=h.origin,o.verified.isScam=h.isScam,o.verified.validation=h.origin===new URL(n.url).origin?"VALID":"INVALID")}catch(h){this.client.logger.info(h)}return this.client.logger.info(`Verify context: ${JSON.stringify(o)}`),o},this.validateSessionProps=(i,n)=>{Object.values(i).forEach(o=>{if(!ds(o,!1)){const{message:h}=Y("MISSING_OR_INVALID",`${n} must be in Record<string, string> format. Received: ${JSON.stringify(o)}`);throw new Error(h)}})}}async isInitialized(){if(!this.initialized){const{message:r}=Y("NOT_INITIALIZED",this.name);throw new Error(r)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Wt.message,async r=>{const{topic:i,message:n}=r;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(n)))return;const o=await this.client.core.crypto.decode(i,n);try{Cc(o)?(this.client.core.history.set(i,o),this.onRelayEventRequest({topic:i,payload:o})):Io(o)?(await this.client.core.history.resolve(o),await this.onRelayEventResponse({topic:i,payload:o}),this.client.core.history.delete(i,o.id)):this.onRelayEventUnknownPayload({topic:i,payload:o})}catch(h){this.client.logger.error(h)}})}registerExpirerEvents(){this.client.core.expirer.on(Sr.expired,async r=>{const{topic:i,id:n}=Vl(r.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,Y("EXPIRED"),!0);i?this.client.session.keys.includes(i)&&(await this.deleteSession(i,!0),this.client.events.emit("session_expire",{topic:i})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(Ws.create,r=>this.onPairingCreated(r))}isValidPairingTopic(r){if(!ds(r,!1)){const{message:i}=Y("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(i)}if(!this.client.core.pairing.pairings.keys.includes(r)){const{message:i}=Y("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(i)}if(Ei(this.client.core.pairing.pairings.get(r).expiry)){const{message:i}=Y("EXPIRED",`pairing topic: ${r}`);throw new Error(i)}}async isValidSessionTopic(r){if(!ds(r,!1)){const{message:i}=Y("MISSING_OR_INVALID",`session topic should be a string: ${r}`);throw new Error(i)}if(!this.client.session.keys.includes(r)){const{message:i}=Y("NO_MATCHING_KEY",`session topic doesn't exist: ${r}`);throw new Error(i)}if(Ei(this.client.session.get(r).expiry)){await this.deleteSession(r);const{message:i}=Y("EXPIRED",`session topic: ${r}`);throw new Error(i)}}async isValidSessionOrPairingTopic(r){if(this.client.session.keys.includes(r))await this.isValidSessionTopic(r);else if(this.client.core.pairing.pairings.keys.includes(r))this.isValidPairingTopic(r);else if(ds(r,!1)){const{message:i}=Y("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${r}`);throw new Error(i)}else{const{message:i}=Y("MISSING_OR_INVALID",`session or pairing topic should be a string: ${r}`);throw new Error(i)}}async isValidProposalId(r){if(!Qm(r)){const{message:i}=Y("MISSING_OR_INVALID",`proposal id should be a number: ${r}`);throw new Error(i)}if(!this.client.proposal.keys.includes(r)){const{message:i}=Y("NO_MATCHING_KEY",`proposal id doesn't exist: ${r}`);throw new Error(i)}if(Ei(this.client.proposal.get(r).expiry)){await this.deleteProposal(r);const{message:i}=Y("EXPIRED",`proposal id: ${r}`);throw new Error(i)}}}class PE extends Po{constructor(r,i){super(r,i,dE,Ac),this.core=r,this.logger=i}}class SE extends Po{constructor(r,i){super(r,i,gE,Ac),this.core=r,this.logger=i}}class CE extends Po{constructor(r,i){super(r,i,yE,Ac,n=>n.id),this.core=r,this.logger=i}}let RE=class Nf extends Q1{constructor(r){super(r),this.protocol=Rf,this.version=Of,this.name=ac.name,this.events=new Cr.EventEmitter,this.on=(n,o)=>this.events.on(n,o),this.once=(n,o)=>this.events.once(n,o),this.off=(n,o)=>this.events.off(n,o),this.removeListener=(n,o)=>this.events.removeListener(n,o),this.removeAllListeners=n=>this.events.removeAllListeners(n),this.connect=async n=>{try{return await this.engine.connect(n)}catch(o){throw this.logger.error(o.message),o}},this.pair=async n=>{try{return await this.engine.pair(n)}catch(o){throw this.logger.error(o.message),o}},this.approve=async n=>{try{return await this.engine.approve(n)}catch(o){throw this.logger.error(o.message),o}},this.reject=async n=>{try{return await this.engine.reject(n)}catch(o){throw this.logger.error(o.message),o}},this.update=async n=>{try{return await this.engine.update(n)}catch(o){throw this.logger.error(o.message),o}},this.extend=async n=>{try{return await this.engine.extend(n)}catch(o){throw this.logger.error(o.message),o}},this.request=async n=>{try{return await this.engine.request(n)}catch(o){throw this.logger.error(o.message),o}},this.respond=async n=>{try{return await this.engine.respond(n)}catch(o){throw this.logger.error(o.message),o}},this.ping=async n=>{try{return await this.engine.ping(n)}catch(o){throw this.logger.error(o.message),o}},this.emit=async n=>{try{return await this.engine.emit(n)}catch(o){throw this.logger.error(o.message),o}},this.disconnect=async n=>{try{return await this.engine.disconnect(n)}catch(o){throw this.logger.error(o.message),o}},this.find=n=>{try{return this.engine.find(n)}catch(o){throw this.logger.error(o.message),o}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}},this.name=(r==null?void 0:r.name)||ac.name,this.metadata=(r==null?void 0:r.metadata)||Dm();const i=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:Se.pino(Se.getDefaultLoggerOptions({level:(r==null?void 0:r.logger)||ac.logger}));this.core=(r==null?void 0:r.core)||new pE(r),this.logger=Se.generateChildLogger(i,this.name),this.session=new SE(this.core,this.logger),this.proposal=new PE(this.core,this.logger),this.pendingRequest=new CE(this.core,this.logger),this.engine=new xE(this)}static async init(r){const i=new Nf(r);return await i.initialize(),i}get context(){return Se.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(r){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(r.message),r}}};const OE={Accept:"application/json","Content-Type":"application/json"},AE="POST",Ol={headers:OE,method:AE},Al=10;class Si{constructor(r,i=!1){if(this.url=r,this.disableProviderPing=i,this.events=new Cr.EventEmitter,this.isAvailable=!1,this.registering=!1,!il(r))throw new Error(`Provided URL is not compatible with HTTP connection: ${r}`);this.url=r,this.disableProviderPing=i}get connected(){return this.isAvailable}get connecting(){return this.registering}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}off(r,i){this.events.off(r,i)}removeListener(r,i){this.events.removeListener(r,i)}async open(r=this.url){await this.register(r)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(r,i){this.isAvailable||await this.register();try{const n=ki(r),h=await(await Mh(this.url,Object.assign(Object.assign({},Ol),{body:n}))).json();this.onPayload({data:h})}catch(n){this.onError(r.id,n)}}async register(r=this.url){if(!il(r))throw new Error(`Provided URL is not compatible with HTTP connection: ${r}`);if(this.registering){const i=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=i||this.events.listenerCount("open")>=i)&&this.events.setMaxListeners(i+1),new Promise((n,o)=>{this.events.once("register_error",h=>{this.resetMaxListeners(),o(h)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return o(new Error("HTTP connection is missing or invalid"));n()})})}this.url=r,this.registering=!0;try{if(!this.disableProviderPing){const i=ki({id:1,jsonrpc:"2.0",method:"test",params:[]});await Mh(r,Object.assign(Object.assign({},Ol),{body:i}))}this.onOpen()}catch(i){const n=this.parseError(i);throw this.events.emit("register_error",n),this.onClose(),n}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(r){if(typeof r.data>"u")return;const i=typeof r.data=="string"?Zs(r.data):r.data;this.events.emit("payload",i)}onError(r,i){const n=this.parseError(i),o=n.message||n.toString(),h=Eo(r,o);this.events.emit("payload",h)}parseError(r,i=this.url){return uf(r,i,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>Al&&this.events.setMaxListeners(Al)}}const Tl="error",TE="wss://relay.walletconnect.com",NE="wc",$E="universal_provider",Nl=`${NE}@2:${$E}:`,DE="https://rpc.walletconnect.com/v1/",hi={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Vs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},wc={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(c,r){(function(){var i,n="4.17.21",o=200,h="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",d="Expected a function",v="Invalid `variable` option passed into `_.template`",w="__lodash_hash_undefined__",y=500,E="__lodash_placeholder__",C=1,O=2,j=4,D=1,K=2,re=1,ce=2,ue=4,he=8,fe=16,pe=32,$=64,H=128,W=256,ve=512,te=30,Ee="...",Oe=800,et=16,A=1,M=2,je=3,Ae=1/0,J=9007199254740991,B=17976931348623157e292,k=0/0,V=4294967295,ut=V-1,He=V>>>1,qr=[["ary",H],["bind",re],["bindKey",ce],["curry",he],["curryRight",fe],["flip",ve],["partial",pe],["partialRight",$],["rearg",W]],_e="[object Arguments]",It="[object Array]",N="[object AsyncFunction]",T="[object Boolean]",S="[object Date]",u="[object DOMException]",b="[object Error]",Z="[object Function]",ae="[object GeneratorFunction]",me="[object Map]",Te="[object Number]",$e="[object Null]",xe="[object Object]",xt="[object Promise]",mt="[object Proxy]",nt="[object RegExp]",Fe="[object Set]",Je="[object String]",Qe="[object Symbol]",ot="[object Undefined]",ze="[object WeakMap]",Ye="[object WeakSet]",Ne="[object ArrayBuffer]",ke="[object DataView]",ht="[object Float32Array]",qe="[object Float64Array]",Pt="[object Int8Array]",Dt="[object Int16Array]",Ut="[object Int32Array]",Ht="[object Uint8Array]",qt="[object Uint8ClampedArray]",Jt="[object Uint16Array]",rr="[object Uint32Array]",Mr=/\b__p \+= '';/g,Qt=/\b(__p \+=) '' \+/g,Vr=/(__e\(.*?\)|\b__t\)) \+\n'';/g,li=/&(?:amp|lt|gt|quot|#39);/g,Ci=/[&<>"']/g,lt=RegExp(li.source),tt=RegExp(Ci.source),ft=/<%-([\s\S]+?)%>/g,pt=/<%([\s\S]+?)%>/g,at=/<%=([\s\S]+?)%>/g,rt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,St=/^\w*$/,Ct=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,dt=/[\\^$.*+?()[\]{}|]/g,Rt=RegExp(dt.source),gt=/^\s+/,wt=/\s/,vt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,We=/\{\n\/\* \[wrapped with (.+)\] \*/,Ot=/,? & /,At=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,So=/[()=,{}\[\]\/\s]/,Co=/\\(\\)?/g,Ro=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,yr=/\w*$/,Oo=/^[-+]0x[0-9a-f]+$/i,Ao=/^0b[01]+$/i,To=/^\[object .+?Constructor\]$/,No=/^0o[0-7]+$/i,$o=/^(?:0|[1-9]\d*)$/,Gr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Gi=/($^)/,Do=/['\n\r\u2028\u2029\\]/g,Wi="\\ud800-\\udfff",Fo="\\u0300-\\u036f",Lo="\\ufe20-\\ufe2f",Ji="\\u20d0-\\u20ff",tn=Fo+Lo+Ji,rn="\\u2700-\\u27bf",Rr="a-z\\xdf-\\xf6\\xf8-\\xff",qo="\\xac\\xb1\\xd7\\xf7",Mo="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",jo="\\u2000-\\u206f",zo=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",sn="A-Z\\xc0-\\xd6\\xd8-\\xde",nn="\\ufe0e\\ufe0f",Ri=qo+Mo+jo+zo,bs="['’]",Oi="["+Wi+"]",Es="["+Ri+"]",Ai="["+tn+"]",on="\\d+",Uo="["+rn+"]",an="["+Rr+"]",cn="[^"+Wi+Ri+on+rn+Rr+sn+"]",Qi="\\ud83c[\\udffb-\\udfff]",Ho="(?:"+Ai+"|"+Qi+")",un="[^"+Wi+"]",Yi="(?:\\ud83c[\\udde6-\\uddff]){2}",fi="[\\ud800-\\udbff][\\udc00-\\udfff]",lr="["+sn+"]",hn="\\u200d",ln="(?:"+an+"|"+cn+")",jr="(?:"+lr+"|"+cn+")",fn="(?:"+bs+"(?:d|ll|m|re|s|t|ve))?",pn="(?:"+bs+"(?:D|LL|M|RE|S|T|VE))?",dn=Ho+"?",gn="["+nn+"]?",ko="(?:"+hn+"(?:"+[un,Yi,fi].join("|")+")"+gn+dn+")*",Wr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",vn="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",yn=gn+dn+ko,Xi="(?:"+[Uo,Yi,fi].join("|")+")"+yn,Ko="(?:"+[un+Ai+"?",Ai,Yi,fi,Oi].join("|")+")",Is=RegExp(bs,"g"),Bo=RegExp(Ai,"g"),Zi=RegExp(Qi+"(?="+Qi+")|"+Ko+yn,"g"),mn=RegExp([lr+"?"+an+"+"+fn+"(?="+[Es,lr,"$"].join("|")+")",jr+"+"+pn+"(?="+[Es,lr+ln,"$"].join("|")+")",lr+"?"+ln+"+"+fn,lr+"+"+pn,vn,Wr,on,Xi].join("|"),"g"),wn=RegExp("["+hn+Wi+tn+nn+"]"),Ti=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,_n=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Vo=-1,Ke={};Ke[ht]=Ke[qe]=Ke[Pt]=Ke[Dt]=Ke[Ut]=Ke[Ht]=Ke[qt]=Ke[Jt]=Ke[rr]=!0,Ke[_e]=Ke[It]=Ke[Ne]=Ke[T]=Ke[ke]=Ke[S]=Ke[b]=Ke[Z]=Ke[me]=Ke[Te]=Ke[xe]=Ke[nt]=Ke[Fe]=Ke[Je]=Ke[ze]=!1;var Ue={};Ue[_e]=Ue[It]=Ue[Ne]=Ue[ke]=Ue[T]=Ue[S]=Ue[ht]=Ue[qe]=Ue[Pt]=Ue[Dt]=Ue[Ut]=Ue[me]=Ue[Te]=Ue[xe]=Ue[nt]=Ue[Fe]=Ue[Je]=Ue[Qe]=Ue[Ht]=Ue[qt]=Ue[Jt]=Ue[rr]=!0,Ue[b]=Ue[Z]=Ue[ze]=!1;var g={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},I={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},z={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Q={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Be=parseFloat,de=parseInt,Xe=typeof Vs=="object"&&Vs&&Vs.Object===Object&&Vs,Tt=typeof self=="object"&&self&&self.Object===Object&&self,Ce=Xe||Tt||Function("return this")(),Ve=r&&!r.nodeType&&r,_t=Ve&&!0&&c&&!c.nodeType&&c,ir=_t&&_t.exports===Ve,Nt=ir&&Xe.process,Ze=function(){try{var x=_t&&_t.require&&_t.require("util").types;return x||Nt&&Nt.binding&&Nt.binding("util")}catch{}}(),Yt=Ze&&Ze.isArrayBuffer,Or=Ze&&Ze.isDate,mr=Ze&&Ze.isMap,zr=Ze&&Ze.isRegExp,xs=Ze&&Ze.isSet,Ni=Ze&&Ze.isTypedArray;function Mt(x,F,R){switch(R.length){case 0:return x.call(F);case 1:return x.call(F,R[0]);case 2:return x.call(F,R[0],R[1]);case 3:return x.call(F,R[0],R[1],R[2])}return x.apply(F,R)}function Ff(x,F,R,X){for(var le=-1,De=x==null?0:x.length;++le<De;){var Ft=x[le];F(X,Ft,R(Ft),x)}return X}function wr(x,F){for(var R=-1,X=x==null?0:x.length;++R<X&&F(x[R],R,x)!==!1;);return x}function Lf(x,F){for(var R=x==null?0:x.length;R--&&F(x[R],R,x)!==!1;);return x}function $c(x,F){for(var R=-1,X=x==null?0:x.length;++R<X;)if(!F(x[R],R,x))return!1;return!0}function pi(x,F){for(var R=-1,X=x==null?0:x.length,le=0,De=[];++R<X;){var Ft=x[R];F(Ft,R,x)&&(De[le++]=Ft)}return De}function bn(x,F){var R=x==null?0:x.length;return!!R&&es(x,F,0)>-1}function Go(x,F,R){for(var X=-1,le=x==null?0:x.length;++X<le;)if(R(F,x[X]))return!0;return!1}function it(x,F){for(var R=-1,X=x==null?0:x.length,le=Array(X);++R<X;)le[R]=F(x[R],R,x);return le}function di(x,F){for(var R=-1,X=F.length,le=x.length;++R<X;)x[le+R]=F[R];return x}function Wo(x,F,R,X){var le=-1,De=x==null?0:x.length;for(X&&De&&(R=x[++le]);++le<De;)R=F(R,x[le],le,x);return R}function qf(x,F,R,X){var le=x==null?0:x.length;for(X&&le&&(R=x[--le]);le--;)R=F(R,x[le],le,x);return R}function Jo(x,F){for(var R=-1,X=x==null?0:x.length;++R<X;)if(F(x[R],R,x))return!0;return!1}var Mf=Qo("length");function jf(x){return x.split("")}function zf(x){return x.match(At)||[]}function Dc(x,F,R){var X;return R(x,function(le,De,Ft){if(F(le,De,Ft))return X=De,!1}),X}function En(x,F,R,X){for(var le=x.length,De=R+(X?1:-1);X?De--:++De<le;)if(F(x[De],De,x))return De;return-1}function es(x,F,R){return F===F?Xf(x,F,R):En(x,Fc,R)}function Uf(x,F,R,X){for(var le=R-1,De=x.length;++le<De;)if(X(x[le],F))return le;return-1}function Fc(x){return x!==x}function Lc(x,F){var R=x==null?0:x.length;return R?Xo(x,F)/R:k}function Qo(x){return function(F){return F==null?i:F[x]}}function Yo(x){return function(F){return x==null?i:x[F]}}function qc(x,F,R,X,le){return le(x,function(De,Ft,Ge){R=X?(X=!1,De):F(R,De,Ft,Ge)}),R}function Hf(x,F){var R=x.length;for(x.sort(F);R--;)x[R]=x[R].value;return x}function Xo(x,F){for(var R,X=-1,le=x.length;++X<le;){var De=F(x[X]);De!==i&&(R=R===i?De:R+De)}return R}function Zo(x,F){for(var R=-1,X=Array(x);++R<x;)X[R]=F(R);return X}function kf(x,F){return it(F,function(R){return[R,x[R]]})}function Mc(x){return x&&x.slice(0,Hc(x)+1).replace(gt,"")}function fr(x){return function(F){return x(F)}}function ea(x,F){return it(F,function(R){return x[R]})}function Ps(x,F){return x.has(F)}function jc(x,F){for(var R=-1,X=x.length;++R<X&&es(F,x[R],0)>-1;);return R}function zc(x,F){for(var R=x.length;R--&&es(F,x[R],0)>-1;);return R}function Kf(x,F){for(var R=x.length,X=0;R--;)x[R]===F&&++X;return X}var Bf=Yo(g),Vf=Yo(I);function Gf(x){return"\\"+Q[x]}function Wf(x,F){return x==null?i:x[F]}function ts(x){return wn.test(x)}function Jf(x){return Ti.test(x)}function Qf(x){for(var F,R=[];!(F=x.next()).done;)R.push(F.value);return R}function ta(x){var F=-1,R=Array(x.size);return x.forEach(function(X,le){R[++F]=[le,X]}),R}function Uc(x,F){return function(R){return x(F(R))}}function gi(x,F){for(var R=-1,X=x.length,le=0,De=[];++R<X;){var Ft=x[R];(Ft===F||Ft===E)&&(x[R]=E,De[le++]=R)}return De}function In(x){var F=-1,R=Array(x.size);return x.forEach(function(X){R[++F]=X}),R}function Yf(x){var F=-1,R=Array(x.size);return x.forEach(function(X){R[++F]=[X,X]}),R}function Xf(x,F,R){for(var X=R-1,le=x.length;++X<le;)if(x[X]===F)return X;return-1}function Zf(x,F,R){for(var X=R+1;X--;)if(x[X]===F)return X;return X}function rs(x){return ts(x)?tp(x):Mf(x)}function Ar(x){return ts(x)?rp(x):jf(x)}function Hc(x){for(var F=x.length;F--&&wt.test(x.charAt(F)););return F}var ep=Yo(z);function tp(x){for(var F=Zi.lastIndex=0;Zi.test(x);)++F;return F}function rp(x){return x.match(Zi)||[]}function ip(x){return x.match(mn)||[]}var sp=function x(F){F=F==null?Ce:is.defaults(Ce.Object(),F,is.pick(Ce,_n));var R=F.Array,X=F.Date,le=F.Error,De=F.Function,Ft=F.Math,Ge=F.Object,ra=F.RegExp,np=F.String,_r=F.TypeError,xn=R.prototype,op=De.prototype,ss=Ge.prototype,Pn=F["__core-js_shared__"],Sn=op.toString,Me=ss.hasOwnProperty,ap=0,kc=function(){var e=/[^.]+$/.exec(Pn&&Pn.keys&&Pn.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Cn=ss.toString,cp=Sn.call(Ge),up=Ce._,hp=ra("^"+Sn.call(Me).replace(dt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Rn=ir?F.Buffer:i,vi=F.Symbol,On=F.Uint8Array,Kc=Rn?Rn.allocUnsafe:i,An=Uc(Ge.getPrototypeOf,Ge),Bc=Ge.create,Vc=ss.propertyIsEnumerable,Tn=xn.splice,Gc=vi?vi.isConcatSpreadable:i,Ss=vi?vi.iterator:i,$i=vi?vi.toStringTag:i,Nn=function(){try{var e=Mi(Ge,"defineProperty");return e({},"",{}),e}catch{}}(),lp=F.clearTimeout!==Ce.clearTimeout&&F.clearTimeout,fp=X&&X.now!==Ce.Date.now&&X.now,pp=F.setTimeout!==Ce.setTimeout&&F.setTimeout,$n=Ft.ceil,Dn=Ft.floor,ia=Ge.getOwnPropertySymbols,dp=Rn?Rn.isBuffer:i,Wc=F.isFinite,gp=xn.join,vp=Uc(Ge.keys,Ge),Lt=Ft.max,Bt=Ft.min,yp=X.now,mp=F.parseInt,Jc=Ft.random,wp=xn.reverse,sa=Mi(F,"DataView"),Cs=Mi(F,"Map"),na=Mi(F,"Promise"),ns=Mi(F,"Set"),Rs=Mi(F,"WeakMap"),Os=Mi(Ge,"create"),Fn=Rs&&new Rs,os={},_p=ji(sa),bp=ji(Cs),Ep=ji(na),Ip=ji(ns),xp=ji(Rs),Ln=vi?vi.prototype:i,As=Ln?Ln.valueOf:i,Qc=Ln?Ln.toString:i;function f(e){if(yt(e)&&!ge(e)&&!(e instanceof Pe)){if(e instanceof br)return e;if(Me.call(e,"__wrapped__"))return Yu(e)}return new br(e)}var as=function(){function e(){}return function(t){if(!ct(t))return{};if(Bc)return Bc(t);e.prototype=t;var s=new e;return e.prototype=i,s}}();function qn(){}function br(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=i}f.templateSettings={escape:ft,evaluate:pt,interpolate:at,variable:"",imports:{_:f}},f.prototype=qn.prototype,f.prototype.constructor=f,br.prototype=as(qn.prototype),br.prototype.constructor=br;function Pe(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=V,this.__views__=[]}function Pp(){var e=new Pe(this.__wrapped__);return e.__actions__=sr(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=sr(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=sr(this.__views__),e}function Sp(){if(this.__filtered__){var e=new Pe(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Cp(){var e=this.__wrapped__.value(),t=this.__dir__,s=ge(e),a=t<0,l=s?e.length:0,p=jd(0,l,this.__views__),m=p.start,_=p.end,P=_-m,L=a?_:m-1,q=this.__iteratees__,U=q.length,G=0,ee=Bt(P,this.__takeCount__);if(!s||!a&&l==P&&ee==P)return _u(e,this.__actions__);var ne=[];e:for(;P--&&G<ee;){L+=t;for(var we=-1,oe=e[L];++we<U;){var Ie=q[we],Re=Ie.iteratee,gr=Ie.type,er=Re(oe);if(gr==M)oe=er;else if(!er){if(gr==A)continue e;break e}}ne[G++]=oe}return ne}Pe.prototype=as(qn.prototype),Pe.prototype.constructor=Pe;function Di(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var a=e[t];this.set(a[0],a[1])}}function Rp(){this.__data__=Os?Os(null):{},this.size=0}function Op(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function Ap(e){var t=this.__data__;if(Os){var s=t[e];return s===w?i:s}return Me.call(t,e)?t[e]:i}function Tp(e){var t=this.__data__;return Os?t[e]!==i:Me.call(t,e)}function Np(e,t){var s=this.__data__;return this.size+=this.has(e)?0:1,s[e]=Os&&t===i?w:t,this}Di.prototype.clear=Rp,Di.prototype.delete=Op,Di.prototype.get=Ap,Di.prototype.has=Tp,Di.prototype.set=Np;function Jr(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var a=e[t];this.set(a[0],a[1])}}function $p(){this.__data__=[],this.size=0}function Dp(e){var t=this.__data__,s=Mn(t,e);if(s<0)return!1;var a=t.length-1;return s==a?t.pop():Tn.call(t,s,1),--this.size,!0}function Fp(e){var t=this.__data__,s=Mn(t,e);return s<0?i:t[s][1]}function Lp(e){return Mn(this.__data__,e)>-1}function qp(e,t){var s=this.__data__,a=Mn(s,e);return a<0?(++this.size,s.push([e,t])):s[a][1]=t,this}Jr.prototype.clear=$p,Jr.prototype.delete=Dp,Jr.prototype.get=Fp,Jr.prototype.has=Lp,Jr.prototype.set=qp;function Qr(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var a=e[t];this.set(a[0],a[1])}}function Mp(){this.size=0,this.__data__={hash:new Di,map:new(Cs||Jr),string:new Di}}function jp(e){var t=Qn(this,e).delete(e);return this.size-=t?1:0,t}function zp(e){return Qn(this,e).get(e)}function Up(e){return Qn(this,e).has(e)}function Hp(e,t){var s=Qn(this,e),a=s.size;return s.set(e,t),this.size+=s.size==a?0:1,this}Qr.prototype.clear=Mp,Qr.prototype.delete=jp,Qr.prototype.get=zp,Qr.prototype.has=Up,Qr.prototype.set=Hp;function Fi(e){var t=-1,s=e==null?0:e.length;for(this.__data__=new Qr;++t<s;)this.add(e[t])}function kp(e){return this.__data__.set(e,w),this}function Kp(e){return this.__data__.has(e)}Fi.prototype.add=Fi.prototype.push=kp,Fi.prototype.has=Kp;function Tr(e){var t=this.__data__=new Jr(e);this.size=t.size}function Bp(){this.__data__=new Jr,this.size=0}function Vp(e){var t=this.__data__,s=t.delete(e);return this.size=t.size,s}function Gp(e){return this.__data__.get(e)}function Wp(e){return this.__data__.has(e)}function Jp(e,t){var s=this.__data__;if(s instanceof Jr){var a=s.__data__;if(!Cs||a.length<o-1)return a.push([e,t]),this.size=++s.size,this;s=this.__data__=new Qr(a)}return s.set(e,t),this.size=s.size,this}Tr.prototype.clear=Bp,Tr.prototype.delete=Vp,Tr.prototype.get=Gp,Tr.prototype.has=Wp,Tr.prototype.set=Jp;function Yc(e,t){var s=ge(e),a=!s&&zi(e),l=!s&&!a&&bi(e),p=!s&&!a&&!l&&ls(e),m=s||a||l||p,_=m?Zo(e.length,np):[],P=_.length;for(var L in e)(t||Me.call(e,L))&&!(m&&(L=="length"||l&&(L=="offset"||L=="parent")||p&&(L=="buffer"||L=="byteLength"||L=="byteOffset")||ei(L,P)))&&_.push(L);return _}function Xc(e){var t=e.length;return t?e[va(0,t-1)]:i}function Qp(e,t){return Yn(sr(e),Li(t,0,e.length))}function Yp(e){return Yn(sr(e))}function oa(e,t,s){(s!==i&&!Nr(e[t],s)||s===i&&!(t in e))&&Yr(e,t,s)}function Ts(e,t,s){var a=e[t];(!(Me.call(e,t)&&Nr(a,s))||s===i&&!(t in e))&&Yr(e,t,s)}function Mn(e,t){for(var s=e.length;s--;)if(Nr(e[s][0],t))return s;return-1}function Xp(e,t,s,a){return yi(e,function(l,p,m){t(a,l,s(l),m)}),a}function Zc(e,t){return e&&Hr(t,jt(t),e)}function Zp(e,t){return e&&Hr(t,or(t),e)}function Yr(e,t,s){t=="__proto__"&&Nn?Nn(e,t,{configurable:!0,enumerable:!0,value:s,writable:!0}):e[t]=s}function aa(e,t){for(var s=-1,a=t.length,l=R(a),p=e==null;++s<a;)l[s]=p?i:Ua(e,t[s]);return l}function Li(e,t,s){return e===e&&(s!==i&&(e=e<=s?e:s),t!==i&&(e=e>=t?e:t)),e}function Er(e,t,s,a,l,p){var m,_=t&C,P=t&O,L=t&j;if(s&&(m=l?s(e,a,l,p):s(e)),m!==i)return m;if(!ct(e))return e;var q=ge(e);if(q){if(m=Ud(e),!_)return sr(e,m)}else{var U=Vt(e),G=U==Z||U==ae;if(bi(e))return Iu(e,_);if(U==xe||U==_e||G&&!l){if(m=P||G?{}:Hu(e),!_)return P?Ad(e,Zp(m,e)):Od(e,Zc(m,e))}else{if(!Ue[U])return l?e:{};m=Hd(e,U,_)}}p||(p=new Tr);var ee=p.get(e);if(ee)return ee;p.set(e,m),yh(e)?e.forEach(function(oe){m.add(Er(oe,t,s,oe,e,p))}):gh(e)&&e.forEach(function(oe,Ie){m.set(Ie,Er(oe,t,s,Ie,e,p))});var ne=L?P?Ca:Sa:P?or:jt,we=q?i:ne(e);return wr(we||e,function(oe,Ie){we&&(Ie=oe,oe=e[Ie]),Ts(m,Ie,Er(oe,t,s,Ie,e,p))}),m}function ed(e){var t=jt(e);return function(s){return eu(s,e,t)}}function eu(e,t,s){var a=s.length;if(e==null)return!a;for(e=Ge(e);a--;){var l=s[a],p=t[l],m=e[l];if(m===i&&!(l in e)||!p(m))return!1}return!0}function tu(e,t,s){if(typeof e!="function")throw new _r(d);return Ms(function(){e.apply(i,s)},t)}function Ns(e,t,s,a){var l=-1,p=bn,m=!0,_=e.length,P=[],L=t.length;if(!_)return P;s&&(t=it(t,fr(s))),a?(p=Go,m=!1):t.length>=o&&(p=Ps,m=!1,t=new Fi(t));e:for(;++l<_;){var q=e[l],U=s==null?q:s(q);if(q=a||q!==0?q:0,m&&U===U){for(var G=L;G--;)if(t[G]===U)continue e;P.push(q)}else p(t,U,a)||P.push(q)}return P}var yi=Ru(Ur),ru=Ru(ua,!0);function td(e,t){var s=!0;return yi(e,function(a,l,p){return s=!!t(a,l,p),s}),s}function jn(e,t,s){for(var a=-1,l=e.length;++a<l;){var p=e[a],m=t(p);if(m!=null&&(_===i?m===m&&!dr(m):s(m,_)))var _=m,P=p}return P}function rd(e,t,s,a){var l=e.length;for(s=ye(s),s<0&&(s=-s>l?0:l+s),a=a===i||a>l?l:ye(a),a<0&&(a+=l),a=s>a?0:wh(a);s<a;)e[s++]=t;return e}function iu(e,t){var s=[];return yi(e,function(a,l,p){t(a,l,p)&&s.push(a)}),s}function kt(e,t,s,a,l){var p=-1,m=e.length;for(s||(s=Kd),l||(l=[]);++p<m;){var _=e[p];t>0&&s(_)?t>1?kt(_,t-1,s,a,l):di(l,_):a||(l[l.length]=_)}return l}var ca=Ou(),su=Ou(!0);function Ur(e,t){return e&&ca(e,t,jt)}function ua(e,t){return e&&su(e,t,jt)}function zn(e,t){return pi(t,function(s){return ti(e[s])})}function qi(e,t){t=wi(t,e);for(var s=0,a=t.length;e!=null&&s<a;)e=e[kr(t[s++])];return s&&s==a?e:i}function nu(e,t,s){var a=t(e);return ge(e)?a:di(a,s(e))}function Xt(e){return e==null?e===i?ot:$e:$i&&$i in Ge(e)?Md(e):Yd(e)}function ha(e,t){return e>t}function id(e,t){return e!=null&&Me.call(e,t)}function sd(e,t){return e!=null&&t in Ge(e)}function nd(e,t,s){return e>=Bt(t,s)&&e<Lt(t,s)}function la(e,t,s){for(var a=s?Go:bn,l=e[0].length,p=e.length,m=p,_=R(p),P=1/0,L=[];m--;){var q=e[m];m&&t&&(q=it(q,fr(t))),P=Bt(q.length,P),_[m]=!s&&(t||l>=120&&q.length>=120)?new Fi(m&&q):i}q=e[0];var U=-1,G=_[0];e:for(;++U<l&&L.length<P;){var ee=q[U],ne=t?t(ee):ee;if(ee=s||ee!==0?ee:0,!(G?Ps(G,ne):a(L,ne,s))){for(m=p;--m;){var we=_[m];if(!(we?Ps(we,ne):a(e[m],ne,s)))continue e}G&&G.push(ne),L.push(ee)}}return L}function od(e,t,s,a){return Ur(e,function(l,p,m){t(a,s(l),p,m)}),a}function $s(e,t,s){t=wi(t,e),e=Vu(e,t);var a=e==null?e:e[kr(xr(t))];return a==null?i:Mt(a,e,s)}function ou(e){return yt(e)&&Xt(e)==_e}function ad(e){return yt(e)&&Xt(e)==Ne}function cd(e){return yt(e)&&Xt(e)==S}function Ds(e,t,s,a,l){return e===t?!0:e==null||t==null||!yt(e)&&!yt(t)?e!==e&&t!==t:ud(e,t,s,a,Ds,l)}function ud(e,t,s,a,l,p){var m=ge(e),_=ge(t),P=m?It:Vt(e),L=_?It:Vt(t);P=P==_e?xe:P,L=L==_e?xe:L;var q=P==xe,U=L==xe,G=P==L;if(G&&bi(e)){if(!bi(t))return!1;m=!0,q=!1}if(G&&!q)return p||(p=new Tr),m||ls(e)?ju(e,t,s,a,l,p):Ld(e,t,P,s,a,l,p);if(!(s&D)){var ee=q&&Me.call(e,"__wrapped__"),ne=U&&Me.call(t,"__wrapped__");if(ee||ne){var we=ee?e.value():e,oe=ne?t.value():t;return p||(p=new Tr),l(we,oe,s,a,p)}}return G?(p||(p=new Tr),qd(e,t,s,a,l,p)):!1}function hd(e){return yt(e)&&Vt(e)==me}function fa(e,t,s,a){var l=s.length,p=l,m=!a;if(e==null)return!p;for(e=Ge(e);l--;){var _=s[l];if(m&&_[2]?_[1]!==e[_[0]]:!(_[0]in e))return!1}for(;++l<p;){_=s[l];var P=_[0],L=e[P],q=_[1];if(m&&_[2]){if(L===i&&!(P in e))return!1}else{var U=new Tr;if(a)var G=a(L,q,P,e,t,U);if(!(G===i?Ds(q,L,D|K,a,U):G))return!1}}return!0}function au(e){if(!ct(e)||Vd(e))return!1;var t=ti(e)?hp:To;return t.test(ji(e))}function ld(e){return yt(e)&&Xt(e)==nt}function fd(e){return yt(e)&&Vt(e)==Fe}function pd(e){return yt(e)&&io(e.length)&&!!Ke[Xt(e)]}function cu(e){return typeof e=="function"?e:e==null?ar:typeof e=="object"?ge(e)?lu(e[0],e[1]):hu(e):Ah(e)}function pa(e){if(!qs(e))return vp(e);var t=[];for(var s in Ge(e))Me.call(e,s)&&s!="constructor"&&t.push(s);return t}function dd(e){if(!ct(e))return Qd(e);var t=qs(e),s=[];for(var a in e)a=="constructor"&&(t||!Me.call(e,a))||s.push(a);return s}function da(e,t){return e<t}function uu(e,t){var s=-1,a=nr(e)?R(e.length):[];return yi(e,function(l,p,m){a[++s]=t(l,p,m)}),a}function hu(e){var t=Oa(e);return t.length==1&&t[0][2]?Ku(t[0][0],t[0][1]):function(s){return s===e||fa(s,e,t)}}function lu(e,t){return Ta(e)&&ku(t)?Ku(kr(e),t):function(s){var a=Ua(s,e);return a===i&&a===t?Ha(s,e):Ds(t,a,D|K)}}function Un(e,t,s,a,l){e!==t&&ca(t,function(p,m){if(l||(l=new Tr),ct(p))gd(e,t,m,s,Un,a,l);else{var _=a?a($a(e,m),p,m+"",e,t,l):i;_===i&&(_=p),oa(e,m,_)}},or)}function gd(e,t,s,a,l,p,m){var _=$a(e,s),P=$a(t,s),L=m.get(P);if(L){oa(e,s,L);return}var q=p?p(_,P,s+"",e,t,m):i,U=q===i;if(U){var G=ge(P),ee=!G&&bi(P),ne=!G&&!ee&&ls(P);q=P,G||ee||ne?ge(_)?q=_:bt(_)?q=sr(_):ee?(U=!1,q=Iu(P,!0)):ne?(U=!1,q=xu(P,!0)):q=[]:js(P)||zi(P)?(q=_,zi(_)?q=_h(_):(!ct(_)||ti(_))&&(q=Hu(P))):U=!1}U&&(m.set(P,q),l(q,P,a,p,m),m.delete(P)),oa(e,s,q)}function fu(e,t){var s=e.length;if(s)return t+=t<0?s:0,ei(t,s)?e[t]:i}function pu(e,t,s){t.length?t=it(t,function(p){return ge(p)?function(m){return qi(m,p.length===1?p[0]:p)}:p}):t=[ar];var a=-1;t=it(t,fr(se()));var l=uu(e,function(p,m,_){var P=it(t,function(L){return L(p)});return{criteria:P,index:++a,value:p}});return Hf(l,function(p,m){return Rd(p,m,s)})}function vd(e,t){return du(e,t,function(s,a){return Ha(e,a)})}function du(e,t,s){for(var a=-1,l=t.length,p={};++a<l;){var m=t[a],_=qi(e,m);s(_,m)&&Fs(p,wi(m,e),_)}return p}function yd(e){return function(t){return qi(t,e)}}function ga(e,t,s,a){var l=a?Uf:es,p=-1,m=t.length,_=e;for(e===t&&(t=sr(t)),s&&(_=it(e,fr(s)));++p<m;)for(var P=0,L=t[p],q=s?s(L):L;(P=l(_,q,P,a))>-1;)_!==e&&Tn.call(_,P,1),Tn.call(e,P,1);return e}function gu(e,t){for(var s=e?t.length:0,a=s-1;s--;){var l=t[s];if(s==a||l!==p){var p=l;ei(l)?Tn.call(e,l,1):wa(e,l)}}return e}function va(e,t){return e+Dn(Jc()*(t-e+1))}function md(e,t,s,a){for(var l=-1,p=Lt($n((t-e)/(s||1)),0),m=R(p);p--;)m[a?p:++l]=e,e+=s;return m}function ya(e,t){var s="";if(!e||t<1||t>J)return s;do t%2&&(s+=e),t=Dn(t/2),t&&(e+=e);while(t);return s}function be(e,t){return Da(Bu(e,t,ar),e+"")}function wd(e){return Xc(fs(e))}function _d(e,t){var s=fs(e);return Yn(s,Li(t,0,s.length))}function Fs(e,t,s,a){if(!ct(e))return e;t=wi(t,e);for(var l=-1,p=t.length,m=p-1,_=e;_!=null&&++l<p;){var P=kr(t[l]),L=s;if(P==="__proto__"||P==="constructor"||P==="prototype")return e;if(l!=m){var q=_[P];L=a?a(q,P,_):i,L===i&&(L=ct(q)?q:ei(t[l+1])?[]:{})}Ts(_,P,L),_=_[P]}return e}var vu=Fn?function(e,t){return Fn.set(e,t),e}:ar,bd=Nn?function(e,t){return Nn(e,"toString",{configurable:!0,enumerable:!1,value:Ka(t),writable:!0})}:ar;function Ed(e){return Yn(fs(e))}function Ir(e,t,s){var a=-1,l=e.length;t<0&&(t=-t>l?0:l+t),s=s>l?l:s,s<0&&(s+=l),l=t>s?0:s-t>>>0,t>>>=0;for(var p=R(l);++a<l;)p[a]=e[a+t];return p}function Id(e,t){var s;return yi(e,function(a,l,p){return s=t(a,l,p),!s}),!!s}function Hn(e,t,s){var a=0,l=e==null?a:e.length;if(typeof t=="number"&&t===t&&l<=He){for(;a<l;){var p=a+l>>>1,m=e[p];m!==null&&!dr(m)&&(s?m<=t:m<t)?a=p+1:l=p}return l}return ma(e,t,ar,s)}function ma(e,t,s,a){var l=0,p=e==null?0:e.length;if(p===0)return 0;t=s(t);for(var m=t!==t,_=t===null,P=dr(t),L=t===i;l<p;){var q=Dn((l+p)/2),U=s(e[q]),G=U!==i,ee=U===null,ne=U===U,we=dr(U);if(m)var oe=a||ne;else L?oe=ne&&(a||G):_?oe=ne&&G&&(a||!ee):P?oe=ne&&G&&!ee&&(a||!we):ee||we?oe=!1:oe=a?U<=t:U<t;oe?l=q+1:p=q}return Bt(p,ut)}function yu(e,t){for(var s=-1,a=e.length,l=0,p=[];++s<a;){var m=e[s],_=t?t(m):m;if(!s||!Nr(_,P)){var P=_;p[l++]=m===0?0:m}}return p}function mu(e){return typeof e=="number"?e:dr(e)?k:+e}function pr(e){if(typeof e=="string")return e;if(ge(e))return it(e,pr)+"";if(dr(e))return Qc?Qc.call(e):"";var t=e+"";return t=="0"&&1/e==-Ae?"-0":t}function mi(e,t,s){var a=-1,l=bn,p=e.length,m=!0,_=[],P=_;if(s)m=!1,l=Go;else if(p>=o){var L=t?null:Dd(e);if(L)return In(L);m=!1,l=Ps,P=new Fi}else P=t?[]:_;e:for(;++a<p;){var q=e[a],U=t?t(q):q;if(q=s||q!==0?q:0,m&&U===U){for(var G=P.length;G--;)if(P[G]===U)continue e;t&&P.push(U),_.push(q)}else l(P,U,s)||(P!==_&&P.push(U),_.push(q))}return _}function wa(e,t){return t=wi(t,e),e=Vu(e,t),e==null||delete e[kr(xr(t))]}function wu(e,t,s,a){return Fs(e,t,s(qi(e,t)),a)}function kn(e,t,s,a){for(var l=e.length,p=a?l:-1;(a?p--:++p<l)&&t(e[p],p,e););return s?Ir(e,a?0:p,a?p+1:l):Ir(e,a?p+1:0,a?l:p)}function _u(e,t){var s=e;return s instanceof Pe&&(s=s.value()),Wo(t,function(a,l){return l.func.apply(l.thisArg,di([a],l.args))},s)}function _a(e,t,s){var a=e.length;if(a<2)return a?mi(e[0]):[];for(var l=-1,p=R(a);++l<a;)for(var m=e[l],_=-1;++_<a;)_!=l&&(p[l]=Ns(p[l]||m,e[_],t,s));return mi(kt(p,1),t,s)}function bu(e,t,s){for(var a=-1,l=e.length,p=t.length,m={};++a<l;){var _=a<p?t[a]:i;s(m,e[a],_)}return m}function ba(e){return bt(e)?e:[]}function Ea(e){return typeof e=="function"?e:ar}function wi(e,t){return ge(e)?e:Ta(e,t)?[e]:Qu(Le(e))}var xd=be;function _i(e,t,s){var a=e.length;return s=s===i?a:s,!t&&s>=a?e:Ir(e,t,s)}var Eu=lp||function(e){return Ce.clearTimeout(e)};function Iu(e,t){if(t)return e.slice();var s=e.length,a=Kc?Kc(s):new e.constructor(s);return e.copy(a),a}function Ia(e){var t=new e.constructor(e.byteLength);return new On(t).set(new On(e)),t}function Pd(e,t){var s=t?Ia(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.byteLength)}function Sd(e){var t=new e.constructor(e.source,yr.exec(e));return t.lastIndex=e.lastIndex,t}function Cd(e){return As?Ge(As.call(e)):{}}function xu(e,t){var s=t?Ia(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.length)}function Pu(e,t){if(e!==t){var s=e!==i,a=e===null,l=e===e,p=dr(e),m=t!==i,_=t===null,P=t===t,L=dr(t);if(!_&&!L&&!p&&e>t||p&&m&&P&&!_&&!L||a&&m&&P||!s&&P||!l)return 1;if(!a&&!p&&!L&&e<t||L&&s&&l&&!a&&!p||_&&s&&l||!m&&l||!P)return-1}return 0}function Rd(e,t,s){for(var a=-1,l=e.criteria,p=t.criteria,m=l.length,_=s.length;++a<m;){var P=Pu(l[a],p[a]);if(P){if(a>=_)return P;var L=s[a];return P*(L=="desc"?-1:1)}}return e.index-t.index}function Su(e,t,s,a){for(var l=-1,p=e.length,m=s.length,_=-1,P=t.length,L=Lt(p-m,0),q=R(P+L),U=!a;++_<P;)q[_]=t[_];for(;++l<m;)(U||l<p)&&(q[s[l]]=e[l]);for(;L--;)q[_++]=e[l++];return q}function Cu(e,t,s,a){for(var l=-1,p=e.length,m=-1,_=s.length,P=-1,L=t.length,q=Lt(p-_,0),U=R(q+L),G=!a;++l<q;)U[l]=e[l];for(var ee=l;++P<L;)U[ee+P]=t[P];for(;++m<_;)(G||l<p)&&(U[ee+s[m]]=e[l++]);return U}function sr(e,t){var s=-1,a=e.length;for(t||(t=R(a));++s<a;)t[s]=e[s];return t}function Hr(e,t,s,a){var l=!s;s||(s={});for(var p=-1,m=t.length;++p<m;){var _=t[p],P=a?a(s[_],e[_],_,s,e):i;P===i&&(P=e[_]),l?Yr(s,_,P):Ts(s,_,P)}return s}function Od(e,t){return Hr(e,Aa(e),t)}function Ad(e,t){return Hr(e,zu(e),t)}function Kn(e,t){return function(s,a){var l=ge(s)?Ff:Xp,p=t?t():{};return l(s,e,se(a,2),p)}}function cs(e){return be(function(t,s){var a=-1,l=s.length,p=l>1?s[l-1]:i,m=l>2?s[2]:i;for(p=e.length>3&&typeof p=="function"?(l--,p):i,m&&Zt(s[0],s[1],m)&&(p=l<3?i:p,l=1),t=Ge(t);++a<l;){var _=s[a];_&&e(t,_,a,p)}return t})}function Ru(e,t){return function(s,a){if(s==null)return s;if(!nr(s))return e(s,a);for(var l=s.length,p=t?l:-1,m=Ge(s);(t?p--:++p<l)&&a(m[p],p,m)!==!1;);return s}}function Ou(e){return function(t,s,a){for(var l=-1,p=Ge(t),m=a(t),_=m.length;_--;){var P=m[e?_:++l];if(s(p[P],P,p)===!1)break}return t}}function Td(e,t,s){var a=t&re,l=Ls(e);function p(){var m=this&&this!==Ce&&this instanceof p?l:e;return m.apply(a?s:this,arguments)}return p}function Au(e){return function(t){t=Le(t);var s=ts(t)?Ar(t):i,a=s?s[0]:t.charAt(0),l=s?_i(s,1).join(""):t.slice(1);return a[e]()+l}}function us(e){return function(t){return Wo(Rh(Ch(t).replace(Is,"")),e,"")}}function Ls(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var s=as(e.prototype),a=e.apply(s,t);return ct(a)?a:s}}function Nd(e,t,s){var a=Ls(e);function l(){for(var p=arguments.length,m=R(p),_=p,P=hs(l);_--;)m[_]=arguments[_];var L=p<3&&m[0]!==P&&m[p-1]!==P?[]:gi(m,P);if(p-=L.length,p<s)return Fu(e,t,Bn,l.placeholder,i,m,L,i,i,s-p);var q=this&&this!==Ce&&this instanceof l?a:e;return Mt(q,this,m)}return l}function Tu(e){return function(t,s,a){var l=Ge(t);if(!nr(t)){var p=se(s,3);t=jt(t),s=function(_){return p(l[_],_,l)}}var m=e(t,s,a);return m>-1?l[p?t[m]:m]:i}}function Nu(e){return Zr(function(t){var s=t.length,a=s,l=br.prototype.thru;for(e&&t.reverse();a--;){var p=t[a];if(typeof p!="function")throw new _r(d);if(l&&!m&&Jn(p)=="wrapper")var m=new br([],!0)}for(a=m?a:s;++a<s;){p=t[a];var _=Jn(p),P=_=="wrapper"?Ra(p):i;P&&Na(P[0])&&P[1]==(H|he|pe|W)&&!P[4].length&&P[9]==1?m=m[Jn(P[0])].apply(m,P[3]):m=p.length==1&&Na(p)?m[_]():m.thru(p)}return function(){var L=arguments,q=L[0];if(m&&L.length==1&&ge(q))return m.plant(q).value();for(var U=0,G=s?t[U].apply(this,L):q;++U<s;)G=t[U].call(this,G);return G}})}function Bn(e,t,s,a,l,p,m,_,P,L){var q=t&H,U=t&re,G=t&ce,ee=t&(he|fe),ne=t&ve,we=G?i:Ls(e);function oe(){for(var Ie=arguments.length,Re=R(Ie),gr=Ie;gr--;)Re[gr]=arguments[gr];if(ee)var er=hs(oe),vr=Kf(Re,er);if(a&&(Re=Su(Re,a,l,ee)),p&&(Re=Cu(Re,p,m,ee)),Ie-=vr,ee&&Ie<L){var Et=gi(Re,er);return Fu(e,t,Bn,oe.placeholder,s,Re,Et,_,P,L-Ie)}var $r=U?s:this,ii=G?$r[e]:e;return Ie=Re.length,_?Re=Xd(Re,_):ne&&Ie>1&&Re.reverse(),q&&P<Ie&&(Re.length=P),this&&this!==Ce&&this instanceof oe&&(ii=we||Ls(ii)),ii.apply($r,Re)}return oe}function $u(e,t){return function(s,a){return od(s,e,t(a),{})}}function Vn(e,t){return function(s,a){var l;if(s===i&&a===i)return t;if(s!==i&&(l=s),a!==i){if(l===i)return a;typeof s=="string"||typeof a=="string"?(s=pr(s),a=pr(a)):(s=mu(s),a=mu(a)),l=e(s,a)}return l}}function xa(e){return Zr(function(t){return t=it(t,fr(se())),be(function(s){var a=this;return e(t,function(l){return Mt(l,a,s)})})})}function Gn(e,t){t=t===i?" ":pr(t);var s=t.length;if(s<2)return s?ya(t,e):t;var a=ya(t,$n(e/rs(t)));return ts(t)?_i(Ar(a),0,e).join(""):a.slice(0,e)}function $d(e,t,s,a){var l=t&re,p=Ls(e);function m(){for(var _=-1,P=arguments.length,L=-1,q=a.length,U=R(q+P),G=this&&this!==Ce&&this instanceof m?p:e;++L<q;)U[L]=a[L];for(;P--;)U[L++]=arguments[++_];return Mt(G,l?s:this,U)}return m}function Du(e){return function(t,s,a){return a&&typeof a!="number"&&Zt(t,s,a)&&(s=a=i),t=ri(t),s===i?(s=t,t=0):s=ri(s),a=a===i?t<s?1:-1:ri(a),md(t,s,a,e)}}function Wn(e){return function(t,s){return typeof t=="string"&&typeof s=="string"||(t=Pr(t),s=Pr(s)),e(t,s)}}function Fu(e,t,s,a,l,p,m,_,P,L){var q=t&he,U=q?m:i,G=q?i:m,ee=q?p:i,ne=q?i:p;t|=q?pe:$,t&=~(q?$:pe),t&ue||(t&=~(re|ce));var we=[e,t,l,ee,U,ne,G,_,P,L],oe=s.apply(i,we);return Na(e)&&Gu(oe,we),oe.placeholder=a,Wu(oe,e,t)}function Pa(e){var t=Ft[e];return function(s,a){if(s=Pr(s),a=a==null?0:Bt(ye(a),292),a&&Wc(s)){var l=(Le(s)+"e").split("e"),p=t(l[0]+"e"+(+l[1]+a));return l=(Le(p)+"e").split("e"),+(l[0]+"e"+(+l[1]-a))}return t(s)}}var Dd=ns&&1/In(new ns([,-0]))[1]==Ae?function(e){return new ns(e)}:Ga;function Lu(e){return function(t){var s=Vt(t);return s==me?ta(t):s==Fe?Yf(t):kf(t,e(t))}}function Xr(e,t,s,a,l,p,m,_){var P=t&ce;if(!P&&typeof e!="function")throw new _r(d);var L=a?a.length:0;if(L||(t&=~(pe|$),a=l=i),m=m===i?m:Lt(ye(m),0),_=_===i?_:ye(_),L-=l?l.length:0,t&$){var q=a,U=l;a=l=i}var G=P?i:Ra(e),ee=[e,t,s,a,l,q,U,p,m,_];if(G&&Jd(ee,G),e=ee[0],t=ee[1],s=ee[2],a=ee[3],l=ee[4],_=ee[9]=ee[9]===i?P?0:e.length:Lt(ee[9]-L,0),!_&&t&(he|fe)&&(t&=~(he|fe)),!t||t==re)var ne=Td(e,t,s);else t==he||t==fe?ne=Nd(e,t,_):(t==pe||t==(re|pe))&&!l.length?ne=$d(e,t,s,a):ne=Bn.apply(i,ee);var we=G?vu:Gu;return Wu(we(ne,ee),e,t)}function qu(e,t,s,a){return e===i||Nr(e,ss[s])&&!Me.call(a,s)?t:e}function Mu(e,t,s,a,l,p){return ct(e)&&ct(t)&&(p.set(t,e),Un(e,t,i,Mu,p),p.delete(t)),e}function Fd(e){return js(e)?i:e}function ju(e,t,s,a,l,p){var m=s&D,_=e.length,P=t.length;if(_!=P&&!(m&&P>_))return!1;var L=p.get(e),q=p.get(t);if(L&&q)return L==t&&q==e;var U=-1,G=!0,ee=s&K?new Fi:i;for(p.set(e,t),p.set(t,e);++U<_;){var ne=e[U],we=t[U];if(a)var oe=m?a(we,ne,U,t,e,p):a(ne,we,U,e,t,p);if(oe!==i){if(oe)continue;G=!1;break}if(ee){if(!Jo(t,function(Ie,Re){if(!Ps(ee,Re)&&(ne===Ie||l(ne,Ie,s,a,p)))return ee.push(Re)})){G=!1;break}}else if(!(ne===we||l(ne,we,s,a,p))){G=!1;break}}return p.delete(e),p.delete(t),G}function Ld(e,t,s,a,l,p,m){switch(s){case ke:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Ne:return!(e.byteLength!=t.byteLength||!p(new On(e),new On(t)));case T:case S:case Te:return Nr(+e,+t);case b:return e.name==t.name&&e.message==t.message;case nt:case Je:return e==t+"";case me:var _=ta;case Fe:var P=a&D;if(_||(_=In),e.size!=t.size&&!P)return!1;var L=m.get(e);if(L)return L==t;a|=K,m.set(e,t);var q=ju(_(e),_(t),a,l,p,m);return m.delete(e),q;case Qe:if(As)return As.call(e)==As.call(t)}return!1}function qd(e,t,s,a,l,p){var m=s&D,_=Sa(e),P=_.length,L=Sa(t),q=L.length;if(P!=q&&!m)return!1;for(var U=P;U--;){var G=_[U];if(!(m?G in t:Me.call(t,G)))return!1}var ee=p.get(e),ne=p.get(t);if(ee&&ne)return ee==t&&ne==e;var we=!0;p.set(e,t),p.set(t,e);for(var oe=m;++U<P;){G=_[U];var Ie=e[G],Re=t[G];if(a)var gr=m?a(Re,Ie,G,t,e,p):a(Ie,Re,G,e,t,p);if(!(gr===i?Ie===Re||l(Ie,Re,s,a,p):gr)){we=!1;break}oe||(oe=G=="constructor")}if(we&&!oe){var er=e.constructor,vr=t.constructor;er!=vr&&"constructor"in e&&"constructor"in t&&!(typeof er=="function"&&er instanceof er&&typeof vr=="function"&&vr instanceof vr)&&(we=!1)}return p.delete(e),p.delete(t),we}function Zr(e){return Da(Bu(e,i,eh),e+"")}function Sa(e){return nu(e,jt,Aa)}function Ca(e){return nu(e,or,zu)}var Ra=Fn?function(e){return Fn.get(e)}:Ga;function Jn(e){for(var t=e.name+"",s=os[t],a=Me.call(os,t)?s.length:0;a--;){var l=s[a],p=l.func;if(p==null||p==e)return l.name}return t}function hs(e){var t=Me.call(f,"placeholder")?f:e;return t.placeholder}function se(){var e=f.iteratee||Ba;return e=e===Ba?cu:e,arguments.length?e(arguments[0],arguments[1]):e}function Qn(e,t){var s=e.__data__;return Bd(t)?s[typeof t=="string"?"string":"hash"]:s.map}function Oa(e){for(var t=jt(e),s=t.length;s--;){var a=t[s],l=e[a];t[s]=[a,l,ku(l)]}return t}function Mi(e,t){var s=Wf(e,t);return au(s)?s:i}function Md(e){var t=Me.call(e,$i),s=e[$i];try{e[$i]=i;var a=!0}catch{}var l=Cn.call(e);return a&&(t?e[$i]=s:delete e[$i]),l}var Aa=ia?function(e){return e==null?[]:(e=Ge(e),pi(ia(e),function(t){return Vc.call(e,t)}))}:Wa,zu=ia?function(e){for(var t=[];e;)di(t,Aa(e)),e=An(e);return t}:Wa,Vt=Xt;(sa&&Vt(new sa(new ArrayBuffer(1)))!=ke||Cs&&Vt(new Cs)!=me||na&&Vt(na.resolve())!=xt||ns&&Vt(new ns)!=Fe||Rs&&Vt(new Rs)!=ze)&&(Vt=function(e){var t=Xt(e),s=t==xe?e.constructor:i,a=s?ji(s):"";if(a)switch(a){case _p:return ke;case bp:return me;case Ep:return xt;case Ip:return Fe;case xp:return ze}return t});function jd(e,t,s){for(var a=-1,l=s.length;++a<l;){var p=s[a],m=p.size;switch(p.type){case"drop":e+=m;break;case"dropRight":t-=m;break;case"take":t=Bt(t,e+m);break;case"takeRight":e=Lt(e,t-m);break}}return{start:e,end:t}}function zd(e){var t=e.match(We);return t?t[1].split(Ot):[]}function Uu(e,t,s){t=wi(t,e);for(var a=-1,l=t.length,p=!1;++a<l;){var m=kr(t[a]);if(!(p=e!=null&&s(e,m)))break;e=e[m]}return p||++a!=l?p:(l=e==null?0:e.length,!!l&&io(l)&&ei(m,l)&&(ge(e)||zi(e)))}function Ud(e){var t=e.length,s=new e.constructor(t);return t&&typeof e[0]=="string"&&Me.call(e,"index")&&(s.index=e.index,s.input=e.input),s}function Hu(e){return typeof e.constructor=="function"&&!qs(e)?as(An(e)):{}}function Hd(e,t,s){var a=e.constructor;switch(t){case Ne:return Ia(e);case T:case S:return new a(+e);case ke:return Pd(e,s);case ht:case qe:case Pt:case Dt:case Ut:case Ht:case qt:case Jt:case rr:return xu(e,s);case me:return new a;case Te:case Je:return new a(e);case nt:return Sd(e);case Fe:return new a;case Qe:return Cd(e)}}function kd(e,t){var s=t.length;if(!s)return e;var a=s-1;return t[a]=(s>1?"& ":"")+t[a],t=t.join(s>2?", ":" "),e.replace(vt,`{
/* [wrapped with `+t+`] */
`)}function Kd(e){return ge(e)||zi(e)||!!(Gc&&e&&e[Gc])}function ei(e,t){var s=typeof e;return t=t??J,!!t&&(s=="number"||s!="symbol"&&$o.test(e))&&e>-1&&e%1==0&&e<t}function Zt(e,t,s){if(!ct(s))return!1;var a=typeof t;return(a=="number"?nr(s)&&ei(t,s.length):a=="string"&&t in s)?Nr(s[t],e):!1}function Ta(e,t){if(ge(e))return!1;var s=typeof e;return s=="number"||s=="symbol"||s=="boolean"||e==null||dr(e)?!0:St.test(e)||!rt.test(e)||t!=null&&e in Ge(t)}function Bd(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Na(e){var t=Jn(e),s=f[t];if(typeof s!="function"||!(t in Pe.prototype))return!1;if(e===s)return!0;var a=Ra(s);return!!a&&e===a[0]}function Vd(e){return!!kc&&kc in e}var Gd=Pn?ti:Ja;function qs(e){var t=e&&e.constructor,s=typeof t=="function"&&t.prototype||ss;return e===s}function ku(e){return e===e&&!ct(e)}function Ku(e,t){return function(s){return s==null?!1:s[e]===t&&(t!==i||e in Ge(s))}}function Wd(e){var t=to(e,function(a){return s.size===y&&s.clear(),a}),s=t.cache;return t}function Jd(e,t){var s=e[1],a=t[1],l=s|a,p=l<(re|ce|H),m=a==H&&s==he||a==H&&s==W&&e[7].length<=t[8]||a==(H|W)&&t[7].length<=t[8]&&s==he;if(!(p||m))return e;a&re&&(e[2]=t[2],l|=s&re?0:ue);var _=t[3];if(_){var P=e[3];e[3]=P?Su(P,_,t[4]):_,e[4]=P?gi(e[3],E):t[4]}return _=t[5],_&&(P=e[5],e[5]=P?Cu(P,_,t[6]):_,e[6]=P?gi(e[5],E):t[6]),_=t[7],_&&(e[7]=_),a&H&&(e[8]=e[8]==null?t[8]:Bt(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=l,e}function Qd(e){var t=[];if(e!=null)for(var s in Ge(e))t.push(s);return t}function Yd(e){return Cn.call(e)}function Bu(e,t,s){return t=Lt(t===i?e.length-1:t,0),function(){for(var a=arguments,l=-1,p=Lt(a.length-t,0),m=R(p);++l<p;)m[l]=a[t+l];l=-1;for(var _=R(t+1);++l<t;)_[l]=a[l];return _[t]=s(m),Mt(e,this,_)}}function Vu(e,t){return t.length<2?e:qi(e,Ir(t,0,-1))}function Xd(e,t){for(var s=e.length,a=Bt(t.length,s),l=sr(e);a--;){var p=t[a];e[a]=ei(p,s)?l[p]:i}return e}function $a(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var Gu=Ju(vu),Ms=pp||function(e,t){return Ce.setTimeout(e,t)},Da=Ju(bd);function Wu(e,t,s){var a=t+"";return Da(e,kd(a,Zd(zd(a),s)))}function Ju(e){var t=0,s=0;return function(){var a=yp(),l=et-(a-s);if(s=a,l>0){if(++t>=Oe)return arguments[0]}else t=0;return e.apply(i,arguments)}}function Yn(e,t){var s=-1,a=e.length,l=a-1;for(t=t===i?a:t;++s<t;){var p=va(s,l),m=e[p];e[p]=e[s],e[s]=m}return e.length=t,e}var Qu=Wd(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Ct,function(s,a,l,p){t.push(l?p.replace(Co,"$1"):a||s)}),t});function kr(e){if(typeof e=="string"||dr(e))return e;var t=e+"";return t=="0"&&1/e==-Ae?"-0":t}function ji(e){if(e!=null){try{return Sn.call(e)}catch{}try{return e+""}catch{}}return""}function Zd(e,t){return wr(qr,function(s){var a="_."+s[0];t&s[1]&&!bn(e,a)&&e.push(a)}),e.sort()}function Yu(e){if(e instanceof Pe)return e.clone();var t=new br(e.__wrapped__,e.__chain__);return t.__actions__=sr(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function eg(e,t,s){(s?Zt(e,t,s):t===i)?t=1:t=Lt(ye(t),0);var a=e==null?0:e.length;if(!a||t<1)return[];for(var l=0,p=0,m=R($n(a/t));l<a;)m[p++]=Ir(e,l,l+=t);return m}function tg(e){for(var t=-1,s=e==null?0:e.length,a=0,l=[];++t<s;){var p=e[t];p&&(l[a++]=p)}return l}function rg(){var e=arguments.length;if(!e)return[];for(var t=R(e-1),s=arguments[0],a=e;a--;)t[a-1]=arguments[a];return di(ge(s)?sr(s):[s],kt(t,1))}var ig=be(function(e,t){return bt(e)?Ns(e,kt(t,1,bt,!0)):[]}),sg=be(function(e,t){var s=xr(t);return bt(s)&&(s=i),bt(e)?Ns(e,kt(t,1,bt,!0),se(s,2)):[]}),ng=be(function(e,t){var s=xr(t);return bt(s)&&(s=i),bt(e)?Ns(e,kt(t,1,bt,!0),i,s):[]});function og(e,t,s){var a=e==null?0:e.length;return a?(t=s||t===i?1:ye(t),Ir(e,t<0?0:t,a)):[]}function ag(e,t,s){var a=e==null?0:e.length;return a?(t=s||t===i?1:ye(t),t=a-t,Ir(e,0,t<0?0:t)):[]}function cg(e,t){return e&&e.length?kn(e,se(t,3),!0,!0):[]}function ug(e,t){return e&&e.length?kn(e,se(t,3),!0):[]}function hg(e,t,s,a){var l=e==null?0:e.length;return l?(s&&typeof s!="number"&&Zt(e,t,s)&&(s=0,a=l),rd(e,t,s,a)):[]}function Xu(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var l=s==null?0:ye(s);return l<0&&(l=Lt(a+l,0)),En(e,se(t,3),l)}function Zu(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var l=a-1;return s!==i&&(l=ye(s),l=s<0?Lt(a+l,0):Bt(l,a-1)),En(e,se(t,3),l,!0)}function eh(e){var t=e==null?0:e.length;return t?kt(e,1):[]}function lg(e){var t=e==null?0:e.length;return t?kt(e,Ae):[]}function fg(e,t){var s=e==null?0:e.length;return s?(t=t===i?1:ye(t),kt(e,t)):[]}function pg(e){for(var t=-1,s=e==null?0:e.length,a={};++t<s;){var l=e[t];a[l[0]]=l[1]}return a}function th(e){return e&&e.length?e[0]:i}function dg(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var l=s==null?0:ye(s);return l<0&&(l=Lt(a+l,0)),es(e,t,l)}function gg(e){var t=e==null?0:e.length;return t?Ir(e,0,-1):[]}var vg=be(function(e){var t=it(e,ba);return t.length&&t[0]===e[0]?la(t):[]}),yg=be(function(e){var t=xr(e),s=it(e,ba);return t===xr(s)?t=i:s.pop(),s.length&&s[0]===e[0]?la(s,se(t,2)):[]}),mg=be(function(e){var t=xr(e),s=it(e,ba);return t=typeof t=="function"?t:i,t&&s.pop(),s.length&&s[0]===e[0]?la(s,i,t):[]});function wg(e,t){return e==null?"":gp.call(e,t)}function xr(e){var t=e==null?0:e.length;return t?e[t-1]:i}function _g(e,t,s){var a=e==null?0:e.length;if(!a)return-1;var l=a;return s!==i&&(l=ye(s),l=l<0?Lt(a+l,0):Bt(l,a-1)),t===t?Zf(e,t,l):En(e,Fc,l,!0)}function bg(e,t){return e&&e.length?fu(e,ye(t)):i}var Eg=be(rh);function rh(e,t){return e&&e.length&&t&&t.length?ga(e,t):e}function Ig(e,t,s){return e&&e.length&&t&&t.length?ga(e,t,se(s,2)):e}function xg(e,t,s){return e&&e.length&&t&&t.length?ga(e,t,i,s):e}var Pg=Zr(function(e,t){var s=e==null?0:e.length,a=aa(e,t);return gu(e,it(t,function(l){return ei(l,s)?+l:l}).sort(Pu)),a});function Sg(e,t){var s=[];if(!(e&&e.length))return s;var a=-1,l=[],p=e.length;for(t=se(t,3);++a<p;){var m=e[a];t(m,a,e)&&(s.push(m),l.push(a))}return gu(e,l),s}function Fa(e){return e==null?e:wp.call(e)}function Cg(e,t,s){var a=e==null?0:e.length;return a?(s&&typeof s!="number"&&Zt(e,t,s)?(t=0,s=a):(t=t==null?0:ye(t),s=s===i?a:ye(s)),Ir(e,t,s)):[]}function Rg(e,t){return Hn(e,t)}function Og(e,t,s){return ma(e,t,se(s,2))}function Ag(e,t){var s=e==null?0:e.length;if(s){var a=Hn(e,t);if(a<s&&Nr(e[a],t))return a}return-1}function Tg(e,t){return Hn(e,t,!0)}function Ng(e,t,s){return ma(e,t,se(s,2),!0)}function $g(e,t){var s=e==null?0:e.length;if(s){var a=Hn(e,t,!0)-1;if(Nr(e[a],t))return a}return-1}function Dg(e){return e&&e.length?yu(e):[]}function Fg(e,t){return e&&e.length?yu(e,se(t,2)):[]}function Lg(e){var t=e==null?0:e.length;return t?Ir(e,1,t):[]}function qg(e,t,s){return e&&e.length?(t=s||t===i?1:ye(t),Ir(e,0,t<0?0:t)):[]}function Mg(e,t,s){var a=e==null?0:e.length;return a?(t=s||t===i?1:ye(t),t=a-t,Ir(e,t<0?0:t,a)):[]}function jg(e,t){return e&&e.length?kn(e,se(t,3),!1,!0):[]}function zg(e,t){return e&&e.length?kn(e,se(t,3)):[]}var Ug=be(function(e){return mi(kt(e,1,bt,!0))}),Hg=be(function(e){var t=xr(e);return bt(t)&&(t=i),mi(kt(e,1,bt,!0),se(t,2))}),kg=be(function(e){var t=xr(e);return t=typeof t=="function"?t:i,mi(kt(e,1,bt,!0),i,t)});function Kg(e){return e&&e.length?mi(e):[]}function Bg(e,t){return e&&e.length?mi(e,se(t,2)):[]}function Vg(e,t){return t=typeof t=="function"?t:i,e&&e.length?mi(e,i,t):[]}function La(e){if(!(e&&e.length))return[];var t=0;return e=pi(e,function(s){if(bt(s))return t=Lt(s.length,t),!0}),Zo(t,function(s){return it(e,Qo(s))})}function ih(e,t){if(!(e&&e.length))return[];var s=La(e);return t==null?s:it(s,function(a){return Mt(t,i,a)})}var Gg=be(function(e,t){return bt(e)?Ns(e,t):[]}),Wg=be(function(e){return _a(pi(e,bt))}),Jg=be(function(e){var t=xr(e);return bt(t)&&(t=i),_a(pi(e,bt),se(t,2))}),Qg=be(function(e){var t=xr(e);return t=typeof t=="function"?t:i,_a(pi(e,bt),i,t)}),Yg=be(La);function Xg(e,t){return bu(e||[],t||[],Ts)}function Zg(e,t){return bu(e||[],t||[],Fs)}var ev=be(function(e){var t=e.length,s=t>1?e[t-1]:i;return s=typeof s=="function"?(e.pop(),s):i,ih(e,s)});function sh(e){var t=f(e);return t.__chain__=!0,t}function tv(e,t){return t(e),e}function Xn(e,t){return t(e)}var rv=Zr(function(e){var t=e.length,s=t?e[0]:0,a=this.__wrapped__,l=function(p){return aa(p,e)};return t>1||this.__actions__.length||!(a instanceof Pe)||!ei(s)?this.thru(l):(a=a.slice(s,+s+(t?1:0)),a.__actions__.push({func:Xn,args:[l],thisArg:i}),new br(a,this.__chain__).thru(function(p){return t&&!p.length&&p.push(i),p}))});function iv(){return sh(this)}function sv(){return new br(this.value(),this.__chain__)}function nv(){this.__values__===i&&(this.__values__=mh(this.value()));var e=this.__index__>=this.__values__.length,t=e?i:this.__values__[this.__index__++];return{done:e,value:t}}function ov(){return this}function av(e){for(var t,s=this;s instanceof qn;){var a=Yu(s);a.__index__=0,a.__values__=i,t?l.__wrapped__=a:t=a;var l=a;s=s.__wrapped__}return l.__wrapped__=e,t}function cv(){var e=this.__wrapped__;if(e instanceof Pe){var t=e;return this.__actions__.length&&(t=new Pe(this)),t=t.reverse(),t.__actions__.push({func:Xn,args:[Fa],thisArg:i}),new br(t,this.__chain__)}return this.thru(Fa)}function uv(){return _u(this.__wrapped__,this.__actions__)}var hv=Kn(function(e,t,s){Me.call(e,s)?++e[s]:Yr(e,s,1)});function lv(e,t,s){var a=ge(e)?$c:td;return s&&Zt(e,t,s)&&(t=i),a(e,se(t,3))}function fv(e,t){var s=ge(e)?pi:iu;return s(e,se(t,3))}var pv=Tu(Xu),dv=Tu(Zu);function gv(e,t){return kt(Zn(e,t),1)}function vv(e,t){return kt(Zn(e,t),Ae)}function yv(e,t,s){return s=s===i?1:ye(s),kt(Zn(e,t),s)}function nh(e,t){var s=ge(e)?wr:yi;return s(e,se(t,3))}function oh(e,t){var s=ge(e)?Lf:ru;return s(e,se(t,3))}var mv=Kn(function(e,t,s){Me.call(e,s)?e[s].push(t):Yr(e,s,[t])});function wv(e,t,s,a){e=nr(e)?e:fs(e),s=s&&!a?ye(s):0;var l=e.length;return s<0&&(s=Lt(l+s,0)),so(e)?s<=l&&e.indexOf(t,s)>-1:!!l&&es(e,t,s)>-1}var _v=be(function(e,t,s){var a=-1,l=typeof t=="function",p=nr(e)?R(e.length):[];return yi(e,function(m){p[++a]=l?Mt(t,m,s):$s(m,t,s)}),p}),bv=Kn(function(e,t,s){Yr(e,s,t)});function Zn(e,t){var s=ge(e)?it:uu;return s(e,se(t,3))}function Ev(e,t,s,a){return e==null?[]:(ge(t)||(t=t==null?[]:[t]),s=a?i:s,ge(s)||(s=s==null?[]:[s]),pu(e,t,s))}var Iv=Kn(function(e,t,s){e[s?0:1].push(t)},function(){return[[],[]]});function xv(e,t,s){var a=ge(e)?Wo:qc,l=arguments.length<3;return a(e,se(t,4),s,l,yi)}function Pv(e,t,s){var a=ge(e)?qf:qc,l=arguments.length<3;return a(e,se(t,4),s,l,ru)}function Sv(e,t){var s=ge(e)?pi:iu;return s(e,ro(se(t,3)))}function Cv(e){var t=ge(e)?Xc:wd;return t(e)}function Rv(e,t,s){(s?Zt(e,t,s):t===i)?t=1:t=ye(t);var a=ge(e)?Qp:_d;return a(e,t)}function Ov(e){var t=ge(e)?Yp:Ed;return t(e)}function Av(e){if(e==null)return 0;if(nr(e))return so(e)?rs(e):e.length;var t=Vt(e);return t==me||t==Fe?e.size:pa(e).length}function Tv(e,t,s){var a=ge(e)?Jo:Id;return s&&Zt(e,t,s)&&(t=i),a(e,se(t,3))}var Nv=be(function(e,t){if(e==null)return[];var s=t.length;return s>1&&Zt(e,t[0],t[1])?t=[]:s>2&&Zt(t[0],t[1],t[2])&&(t=[t[0]]),pu(e,kt(t,1),[])}),eo=fp||function(){return Ce.Date.now()};function $v(e,t){if(typeof t!="function")throw new _r(d);return e=ye(e),function(){if(--e<1)return t.apply(this,arguments)}}function ah(e,t,s){return t=s?i:t,t=e&&t==null?e.length:t,Xr(e,H,i,i,i,i,t)}function ch(e,t){var s;if(typeof t!="function")throw new _r(d);return e=ye(e),function(){return--e>0&&(s=t.apply(this,arguments)),e<=1&&(t=i),s}}var qa=be(function(e,t,s){var a=re;if(s.length){var l=gi(s,hs(qa));a|=pe}return Xr(e,a,t,s,l)}),uh=be(function(e,t,s){var a=re|ce;if(s.length){var l=gi(s,hs(uh));a|=pe}return Xr(t,a,e,s,l)});function hh(e,t,s){t=s?i:t;var a=Xr(e,he,i,i,i,i,i,t);return a.placeholder=hh.placeholder,a}function lh(e,t,s){t=s?i:t;var a=Xr(e,fe,i,i,i,i,i,t);return a.placeholder=lh.placeholder,a}function fh(e,t,s){var a,l,p,m,_,P,L=0,q=!1,U=!1,G=!0;if(typeof e!="function")throw new _r(d);t=Pr(t)||0,ct(s)&&(q=!!s.leading,U="maxWait"in s,p=U?Lt(Pr(s.maxWait)||0,t):p,G="trailing"in s?!!s.trailing:G);function ee(Et){var $r=a,ii=l;return a=l=i,L=Et,m=e.apply(ii,$r),m}function ne(Et){return L=Et,_=Ms(Ie,t),q?ee(Et):m}function we(Et){var $r=Et-P,ii=Et-L,Th=t-$r;return U?Bt(Th,p-ii):Th}function oe(Et){var $r=Et-P,ii=Et-L;return P===i||$r>=t||$r<0||U&&ii>=p}function Ie(){var Et=eo();if(oe(Et))return Re(Et);_=Ms(Ie,we(Et))}function Re(Et){return _=i,G&&a?ee(Et):(a=l=i,m)}function gr(){_!==i&&Eu(_),L=0,a=P=l=_=i}function er(){return _===i?m:Re(eo())}function vr(){var Et=eo(),$r=oe(Et);if(a=arguments,l=this,P=Et,$r){if(_===i)return ne(P);if(U)return Eu(_),_=Ms(Ie,t),ee(P)}return _===i&&(_=Ms(Ie,t)),m}return vr.cancel=gr,vr.flush=er,vr}var Dv=be(function(e,t){return tu(e,1,t)}),Fv=be(function(e,t,s){return tu(e,Pr(t)||0,s)});function Lv(e){return Xr(e,ve)}function to(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new _r(d);var s=function(){var a=arguments,l=t?t.apply(this,a):a[0],p=s.cache;if(p.has(l))return p.get(l);var m=e.apply(this,a);return s.cache=p.set(l,m)||p,m};return s.cache=new(to.Cache||Qr),s}to.Cache=Qr;function ro(e){if(typeof e!="function")throw new _r(d);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function qv(e){return ch(2,e)}var Mv=xd(function(e,t){t=t.length==1&&ge(t[0])?it(t[0],fr(se())):it(kt(t,1),fr(se()));var s=t.length;return be(function(a){for(var l=-1,p=Bt(a.length,s);++l<p;)a[l]=t[l].call(this,a[l]);return Mt(e,this,a)})}),Ma=be(function(e,t){var s=gi(t,hs(Ma));return Xr(e,pe,i,t,s)}),ph=be(function(e,t){var s=gi(t,hs(ph));return Xr(e,$,i,t,s)}),jv=Zr(function(e,t){return Xr(e,W,i,i,i,t)});function zv(e,t){if(typeof e!="function")throw new _r(d);return t=t===i?t:ye(t),be(e,t)}function Uv(e,t){if(typeof e!="function")throw new _r(d);return t=t==null?0:Lt(ye(t),0),be(function(s){var a=s[t],l=_i(s,0,t);return a&&di(l,a),Mt(e,this,l)})}function Hv(e,t,s){var a=!0,l=!0;if(typeof e!="function")throw new _r(d);return ct(s)&&(a="leading"in s?!!s.leading:a,l="trailing"in s?!!s.trailing:l),fh(e,t,{leading:a,maxWait:t,trailing:l})}function kv(e){return ah(e,1)}function Kv(e,t){return Ma(Ea(t),e)}function Bv(){if(!arguments.length)return[];var e=arguments[0];return ge(e)?e:[e]}function Vv(e){return Er(e,j)}function Gv(e,t){return t=typeof t=="function"?t:i,Er(e,j,t)}function Wv(e){return Er(e,C|j)}function Jv(e,t){return t=typeof t=="function"?t:i,Er(e,C|j,t)}function Qv(e,t){return t==null||eu(e,t,jt(t))}function Nr(e,t){return e===t||e!==e&&t!==t}var Yv=Wn(ha),Xv=Wn(function(e,t){return e>=t}),zi=ou(function(){return arguments}())?ou:function(e){return yt(e)&&Me.call(e,"callee")&&!Vc.call(e,"callee")},ge=R.isArray,Zv=Yt?fr(Yt):ad;function nr(e){return e!=null&&io(e.length)&&!ti(e)}function bt(e){return yt(e)&&nr(e)}function e0(e){return e===!0||e===!1||yt(e)&&Xt(e)==T}var bi=dp||Ja,t0=Or?fr(Or):cd;function r0(e){return yt(e)&&e.nodeType===1&&!js(e)}function i0(e){if(e==null)return!0;if(nr(e)&&(ge(e)||typeof e=="string"||typeof e.splice=="function"||bi(e)||ls(e)||zi(e)))return!e.length;var t=Vt(e);if(t==me||t==Fe)return!e.size;if(qs(e))return!pa(e).length;for(var s in e)if(Me.call(e,s))return!1;return!0}function s0(e,t){return Ds(e,t)}function n0(e,t,s){s=typeof s=="function"?s:i;var a=s?s(e,t):i;return a===i?Ds(e,t,i,s):!!a}function ja(e){if(!yt(e))return!1;var t=Xt(e);return t==b||t==u||typeof e.message=="string"&&typeof e.name=="string"&&!js(e)}function o0(e){return typeof e=="number"&&Wc(e)}function ti(e){if(!ct(e))return!1;var t=Xt(e);return t==Z||t==ae||t==N||t==mt}function dh(e){return typeof e=="number"&&e==ye(e)}function io(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=J}function ct(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function yt(e){return e!=null&&typeof e=="object"}var gh=mr?fr(mr):hd;function a0(e,t){return e===t||fa(e,t,Oa(t))}function c0(e,t,s){return s=typeof s=="function"?s:i,fa(e,t,Oa(t),s)}function u0(e){return vh(e)&&e!=+e}function h0(e){if(Gd(e))throw new le(h);return au(e)}function l0(e){return e===null}function f0(e){return e==null}function vh(e){return typeof e=="number"||yt(e)&&Xt(e)==Te}function js(e){if(!yt(e)||Xt(e)!=xe)return!1;var t=An(e);if(t===null)return!0;var s=Me.call(t,"constructor")&&t.constructor;return typeof s=="function"&&s instanceof s&&Sn.call(s)==cp}var za=zr?fr(zr):ld;function p0(e){return dh(e)&&e>=-J&&e<=J}var yh=xs?fr(xs):fd;function so(e){return typeof e=="string"||!ge(e)&&yt(e)&&Xt(e)==Je}function dr(e){return typeof e=="symbol"||yt(e)&&Xt(e)==Qe}var ls=Ni?fr(Ni):pd;function d0(e){return e===i}function g0(e){return yt(e)&&Vt(e)==ze}function v0(e){return yt(e)&&Xt(e)==Ye}var y0=Wn(da),m0=Wn(function(e,t){return e<=t});function mh(e){if(!e)return[];if(nr(e))return so(e)?Ar(e):sr(e);if(Ss&&e[Ss])return Qf(e[Ss]());var t=Vt(e),s=t==me?ta:t==Fe?In:fs;return s(e)}function ri(e){if(!e)return e===0?e:0;if(e=Pr(e),e===Ae||e===-Ae){var t=e<0?-1:1;return t*B}return e===e?e:0}function ye(e){var t=ri(e),s=t%1;return t===t?s?t-s:t:0}function wh(e){return e?Li(ye(e),0,V):0}function Pr(e){if(typeof e=="number")return e;if(dr(e))return k;if(ct(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=ct(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Mc(e);var s=Ao.test(e);return s||No.test(e)?de(e.slice(2),s?2:8):Oo.test(e)?k:+e}function _h(e){return Hr(e,or(e))}function w0(e){return e?Li(ye(e),-J,J):e===0?e:0}function Le(e){return e==null?"":pr(e)}var _0=cs(function(e,t){if(qs(t)||nr(t)){Hr(t,jt(t),e);return}for(var s in t)Me.call(t,s)&&Ts(e,s,t[s])}),bh=cs(function(e,t){Hr(t,or(t),e)}),no=cs(function(e,t,s,a){Hr(t,or(t),e,a)}),b0=cs(function(e,t,s,a){Hr(t,jt(t),e,a)}),E0=Zr(aa);function I0(e,t){var s=as(e);return t==null?s:Zc(s,t)}var x0=be(function(e,t){e=Ge(e);var s=-1,a=t.length,l=a>2?t[2]:i;for(l&&Zt(t[0],t[1],l)&&(a=1);++s<a;)for(var p=t[s],m=or(p),_=-1,P=m.length;++_<P;){var L=m[_],q=e[L];(q===i||Nr(q,ss[L])&&!Me.call(e,L))&&(e[L]=p[L])}return e}),P0=be(function(e){return e.push(i,Mu),Mt(Eh,i,e)});function S0(e,t){return Dc(e,se(t,3),Ur)}function C0(e,t){return Dc(e,se(t,3),ua)}function R0(e,t){return e==null?e:ca(e,se(t,3),or)}function O0(e,t){return e==null?e:su(e,se(t,3),or)}function A0(e,t){return e&&Ur(e,se(t,3))}function T0(e,t){return e&&ua(e,se(t,3))}function N0(e){return e==null?[]:zn(e,jt(e))}function $0(e){return e==null?[]:zn(e,or(e))}function Ua(e,t,s){var a=e==null?i:qi(e,t);return a===i?s:a}function D0(e,t){return e!=null&&Uu(e,t,id)}function Ha(e,t){return e!=null&&Uu(e,t,sd)}var F0=$u(function(e,t,s){t!=null&&typeof t.toString!="function"&&(t=Cn.call(t)),e[t]=s},Ka(ar)),L0=$u(function(e,t,s){t!=null&&typeof t.toString!="function"&&(t=Cn.call(t)),Me.call(e,t)?e[t].push(s):e[t]=[s]},se),q0=be($s);function jt(e){return nr(e)?Yc(e):pa(e)}function or(e){return nr(e)?Yc(e,!0):dd(e)}function M0(e,t){var s={};return t=se(t,3),Ur(e,function(a,l,p){Yr(s,t(a,l,p),a)}),s}function j0(e,t){var s={};return t=se(t,3),Ur(e,function(a,l,p){Yr(s,l,t(a,l,p))}),s}var z0=cs(function(e,t,s){Un(e,t,s)}),Eh=cs(function(e,t,s,a){Un(e,t,s,a)}),U0=Zr(function(e,t){var s={};if(e==null)return s;var a=!1;t=it(t,function(p){return p=wi(p,e),a||(a=p.length>1),p}),Hr(e,Ca(e),s),a&&(s=Er(s,C|O|j,Fd));for(var l=t.length;l--;)wa(s,t[l]);return s});function H0(e,t){return Ih(e,ro(se(t)))}var k0=Zr(function(e,t){return e==null?{}:vd(e,t)});function Ih(e,t){if(e==null)return{};var s=it(Ca(e),function(a){return[a]});return t=se(t),du(e,s,function(a,l){return t(a,l[0])})}function K0(e,t,s){t=wi(t,e);var a=-1,l=t.length;for(l||(l=1,e=i);++a<l;){var p=e==null?i:e[kr(t[a])];p===i&&(a=l,p=s),e=ti(p)?p.call(e):p}return e}function B0(e,t,s){return e==null?e:Fs(e,t,s)}function V0(e,t,s,a){return a=typeof a=="function"?a:i,e==null?e:Fs(e,t,s,a)}var xh=Lu(jt),Ph=Lu(or);function G0(e,t,s){var a=ge(e),l=a||bi(e)||ls(e);if(t=se(t,4),s==null){var p=e&&e.constructor;l?s=a?new p:[]:ct(e)?s=ti(p)?as(An(e)):{}:s={}}return(l?wr:Ur)(e,function(m,_,P){return t(s,m,_,P)}),s}function W0(e,t){return e==null?!0:wa(e,t)}function J0(e,t,s){return e==null?e:wu(e,t,Ea(s))}function Q0(e,t,s,a){return a=typeof a=="function"?a:i,e==null?e:wu(e,t,Ea(s),a)}function fs(e){return e==null?[]:ea(e,jt(e))}function Y0(e){return e==null?[]:ea(e,or(e))}function X0(e,t,s){return s===i&&(s=t,t=i),s!==i&&(s=Pr(s),s=s===s?s:0),t!==i&&(t=Pr(t),t=t===t?t:0),Li(Pr(e),t,s)}function Z0(e,t,s){return t=ri(t),s===i?(s=t,t=0):s=ri(s),e=Pr(e),nd(e,t,s)}function ey(e,t,s){if(s&&typeof s!="boolean"&&Zt(e,t,s)&&(t=s=i),s===i&&(typeof t=="boolean"?(s=t,t=i):typeof e=="boolean"&&(s=e,e=i)),e===i&&t===i?(e=0,t=1):(e=ri(e),t===i?(t=e,e=0):t=ri(t)),e>t){var a=e;e=t,t=a}if(s||e%1||t%1){var l=Jc();return Bt(e+l*(t-e+Be("1e-"+((l+"").length-1))),t)}return va(e,t)}var ty=us(function(e,t,s){return t=t.toLowerCase(),e+(s?Sh(t):t)});function Sh(e){return ka(Le(e).toLowerCase())}function Ch(e){return e=Le(e),e&&e.replace(Gr,Bf).replace(Bo,"")}function ry(e,t,s){e=Le(e),t=pr(t);var a=e.length;s=s===i?a:Li(ye(s),0,a);var l=s;return s-=t.length,s>=0&&e.slice(s,l)==t}function iy(e){return e=Le(e),e&&tt.test(e)?e.replace(Ci,Vf):e}function sy(e){return e=Le(e),e&&Rt.test(e)?e.replace(dt,"\\$&"):e}var ny=us(function(e,t,s){return e+(s?"-":"")+t.toLowerCase()}),oy=us(function(e,t,s){return e+(s?" ":"")+t.toLowerCase()}),ay=Au("toLowerCase");function cy(e,t,s){e=Le(e),t=ye(t);var a=t?rs(e):0;if(!t||a>=t)return e;var l=(t-a)/2;return Gn(Dn(l),s)+e+Gn($n(l),s)}function uy(e,t,s){e=Le(e),t=ye(t);var a=t?rs(e):0;return t&&a<t?e+Gn(t-a,s):e}function hy(e,t,s){e=Le(e),t=ye(t);var a=t?rs(e):0;return t&&a<t?Gn(t-a,s)+e:e}function ly(e,t,s){return s||t==null?t=0:t&&(t=+t),mp(Le(e).replace(gt,""),t||0)}function fy(e,t,s){return(s?Zt(e,t,s):t===i)?t=1:t=ye(t),ya(Le(e),t)}function py(){var e=arguments,t=Le(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var dy=us(function(e,t,s){return e+(s?"_":"")+t.toLowerCase()});function gy(e,t,s){return s&&typeof s!="number"&&Zt(e,t,s)&&(t=s=i),s=s===i?V:s>>>0,s?(e=Le(e),e&&(typeof t=="string"||t!=null&&!za(t))&&(t=pr(t),!t&&ts(e))?_i(Ar(e),0,s):e.split(t,s)):[]}var vy=us(function(e,t,s){return e+(s?" ":"")+ka(t)});function yy(e,t,s){return e=Le(e),s=s==null?0:Li(ye(s),0,e.length),t=pr(t),e.slice(s,s+t.length)==t}function my(e,t,s){var a=f.templateSettings;s&&Zt(e,t,s)&&(t=i),e=Le(e),t=no({},t,a,qu);var l=no({},t.imports,a.imports,qu),p=jt(l),m=ea(l,p),_,P,L=0,q=t.interpolate||Gi,U="__p += '",G=ra((t.escape||Gi).source+"|"+q.source+"|"+(q===at?Ro:Gi).source+"|"+(t.evaluate||Gi).source+"|$","g"),ee="//# sourceURL="+(Me.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Vo+"]")+`
`;e.replace(G,function(oe,Ie,Re,gr,er,vr){return Re||(Re=gr),U+=e.slice(L,vr).replace(Do,Gf),Ie&&(_=!0,U+=`' +
__e(`+Ie+`) +
'`),er&&(P=!0,U+=`';
`+er+`;
__p += '`),Re&&(U+=`' +
((__t = (`+Re+`)) == null ? '' : __t) +
'`),L=vr+oe.length,oe}),U+=`';
`;var ne=Me.call(t,"variable")&&t.variable;if(!ne)U=`with (obj) {
`+U+`
}
`;else if(So.test(ne))throw new le(v);U=(P?U.replace(Mr,""):U).replace(Qt,"$1").replace(Vr,"$1;"),U="function("+(ne||"obj")+`) {
`+(ne?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(_?", __e = _.escape":"")+(P?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+U+`return __p
}`;var we=Oh(function(){return De(p,ee+"return "+U).apply(i,m)});if(we.source=U,ja(we))throw we;return we}function wy(e){return Le(e).toLowerCase()}function _y(e){return Le(e).toUpperCase()}function by(e,t,s){if(e=Le(e),e&&(s||t===i))return Mc(e);if(!e||!(t=pr(t)))return e;var a=Ar(e),l=Ar(t),p=jc(a,l),m=zc(a,l)+1;return _i(a,p,m).join("")}function Ey(e,t,s){if(e=Le(e),e&&(s||t===i))return e.slice(0,Hc(e)+1);if(!e||!(t=pr(t)))return e;var a=Ar(e),l=zc(a,Ar(t))+1;return _i(a,0,l).join("")}function Iy(e,t,s){if(e=Le(e),e&&(s||t===i))return e.replace(gt,"");if(!e||!(t=pr(t)))return e;var a=Ar(e),l=jc(a,Ar(t));return _i(a,l).join("")}function xy(e,t){var s=te,a=Ee;if(ct(t)){var l="separator"in t?t.separator:l;s="length"in t?ye(t.length):s,a="omission"in t?pr(t.omission):a}e=Le(e);var p=e.length;if(ts(e)){var m=Ar(e);p=m.length}if(s>=p)return e;var _=s-rs(a);if(_<1)return a;var P=m?_i(m,0,_).join(""):e.slice(0,_);if(l===i)return P+a;if(m&&(_+=P.length-_),za(l)){if(e.slice(_).search(l)){var L,q=P;for(l.global||(l=ra(l.source,Le(yr.exec(l))+"g")),l.lastIndex=0;L=l.exec(q);)var U=L.index;P=P.slice(0,U===i?_:U)}}else if(e.indexOf(pr(l),_)!=_){var G=P.lastIndexOf(l);G>-1&&(P=P.slice(0,G))}return P+a}function Py(e){return e=Le(e),e&&lt.test(e)?e.replace(li,ep):e}var Sy=us(function(e,t,s){return e+(s?" ":"")+t.toUpperCase()}),ka=Au("toUpperCase");function Rh(e,t,s){return e=Le(e),t=s?i:t,t===i?Jf(e)?ip(e):zf(e):e.match(t)||[]}var Oh=be(function(e,t){try{return Mt(e,i,t)}catch(s){return ja(s)?s:new le(s)}}),Cy=Zr(function(e,t){return wr(t,function(s){s=kr(s),Yr(e,s,qa(e[s],e))}),e});function Ry(e){var t=e==null?0:e.length,s=se();return e=t?it(e,function(a){if(typeof a[1]!="function")throw new _r(d);return[s(a[0]),a[1]]}):[],be(function(a){for(var l=-1;++l<t;){var p=e[l];if(Mt(p[0],this,a))return Mt(p[1],this,a)}})}function Oy(e){return ed(Er(e,C))}function Ka(e){return function(){return e}}function Ay(e,t){return e==null||e!==e?t:e}var Ty=Nu(),Ny=Nu(!0);function ar(e){return e}function Ba(e){return cu(typeof e=="function"?e:Er(e,C))}function $y(e){return hu(Er(e,C))}function Dy(e,t){return lu(e,Er(t,C))}var Fy=be(function(e,t){return function(s){return $s(s,e,t)}}),Ly=be(function(e,t){return function(s){return $s(e,s,t)}});function Va(e,t,s){var a=jt(t),l=zn(t,a);s==null&&!(ct(t)&&(l.length||!a.length))&&(s=t,t=e,e=this,l=zn(t,jt(t)));var p=!(ct(s)&&"chain"in s)||!!s.chain,m=ti(e);return wr(l,function(_){var P=t[_];e[_]=P,m&&(e.prototype[_]=function(){var L=this.__chain__;if(p||L){var q=e(this.__wrapped__),U=q.__actions__=sr(this.__actions__);return U.push({func:P,args:arguments,thisArg:e}),q.__chain__=L,q}return P.apply(e,di([this.value()],arguments))})}),e}function qy(){return Ce._===this&&(Ce._=up),this}function Ga(){}function My(e){return e=ye(e),be(function(t){return fu(t,e)})}var jy=xa(it),zy=xa($c),Uy=xa(Jo);function Ah(e){return Ta(e)?Qo(kr(e)):yd(e)}function Hy(e){return function(t){return e==null?i:qi(e,t)}}var ky=Du(),Ky=Du(!0);function Wa(){return[]}function Ja(){return!1}function By(){return{}}function Vy(){return""}function Gy(){return!0}function Wy(e,t){if(e=ye(e),e<1||e>J)return[];var s=V,a=Bt(e,V);t=se(t),e-=V;for(var l=Zo(a,t);++s<e;)t(s);return l}function Jy(e){return ge(e)?it(e,kr):dr(e)?[e]:sr(Qu(Le(e)))}function Qy(e){var t=++ap;return Le(e)+t}var Yy=Vn(function(e,t){return e+t},0),Xy=Pa("ceil"),Zy=Vn(function(e,t){return e/t},1),em=Pa("floor");function tm(e){return e&&e.length?jn(e,ar,ha):i}function rm(e,t){return e&&e.length?jn(e,se(t,2),ha):i}function im(e){return Lc(e,ar)}function sm(e,t){return Lc(e,se(t,2))}function nm(e){return e&&e.length?jn(e,ar,da):i}function om(e,t){return e&&e.length?jn(e,se(t,2),da):i}var am=Vn(function(e,t){return e*t},1),cm=Pa("round"),um=Vn(function(e,t){return e-t},0);function hm(e){return e&&e.length?Xo(e,ar):0}function lm(e,t){return e&&e.length?Xo(e,se(t,2)):0}return f.after=$v,f.ary=ah,f.assign=_0,f.assignIn=bh,f.assignInWith=no,f.assignWith=b0,f.at=E0,f.before=ch,f.bind=qa,f.bindAll=Cy,f.bindKey=uh,f.castArray=Bv,f.chain=sh,f.chunk=eg,f.compact=tg,f.concat=rg,f.cond=Ry,f.conforms=Oy,f.constant=Ka,f.countBy=hv,f.create=I0,f.curry=hh,f.curryRight=lh,f.debounce=fh,f.defaults=x0,f.defaultsDeep=P0,f.defer=Dv,f.delay=Fv,f.difference=ig,f.differenceBy=sg,f.differenceWith=ng,f.drop=og,f.dropRight=ag,f.dropRightWhile=cg,f.dropWhile=ug,f.fill=hg,f.filter=fv,f.flatMap=gv,f.flatMapDeep=vv,f.flatMapDepth=yv,f.flatten=eh,f.flattenDeep=lg,f.flattenDepth=fg,f.flip=Lv,f.flow=Ty,f.flowRight=Ny,f.fromPairs=pg,f.functions=N0,f.functionsIn=$0,f.groupBy=mv,f.initial=gg,f.intersection=vg,f.intersectionBy=yg,f.intersectionWith=mg,f.invert=F0,f.invertBy=L0,f.invokeMap=_v,f.iteratee=Ba,f.keyBy=bv,f.keys=jt,f.keysIn=or,f.map=Zn,f.mapKeys=M0,f.mapValues=j0,f.matches=$y,f.matchesProperty=Dy,f.memoize=to,f.merge=z0,f.mergeWith=Eh,f.method=Fy,f.methodOf=Ly,f.mixin=Va,f.negate=ro,f.nthArg=My,f.omit=U0,f.omitBy=H0,f.once=qv,f.orderBy=Ev,f.over=jy,f.overArgs=Mv,f.overEvery=zy,f.overSome=Uy,f.partial=Ma,f.partialRight=ph,f.partition=Iv,f.pick=k0,f.pickBy=Ih,f.property=Ah,f.propertyOf=Hy,f.pull=Eg,f.pullAll=rh,f.pullAllBy=Ig,f.pullAllWith=xg,f.pullAt=Pg,f.range=ky,f.rangeRight=Ky,f.rearg=jv,f.reject=Sv,f.remove=Sg,f.rest=zv,f.reverse=Fa,f.sampleSize=Rv,f.set=B0,f.setWith=V0,f.shuffle=Ov,f.slice=Cg,f.sortBy=Nv,f.sortedUniq=Dg,f.sortedUniqBy=Fg,f.split=gy,f.spread=Uv,f.tail=Lg,f.take=qg,f.takeRight=Mg,f.takeRightWhile=jg,f.takeWhile=zg,f.tap=tv,f.throttle=Hv,f.thru=Xn,f.toArray=mh,f.toPairs=xh,f.toPairsIn=Ph,f.toPath=Jy,f.toPlainObject=_h,f.transform=G0,f.unary=kv,f.union=Ug,f.unionBy=Hg,f.unionWith=kg,f.uniq=Kg,f.uniqBy=Bg,f.uniqWith=Vg,f.unset=W0,f.unzip=La,f.unzipWith=ih,f.update=J0,f.updateWith=Q0,f.values=fs,f.valuesIn=Y0,f.without=Gg,f.words=Rh,f.wrap=Kv,f.xor=Wg,f.xorBy=Jg,f.xorWith=Qg,f.zip=Yg,f.zipObject=Xg,f.zipObjectDeep=Zg,f.zipWith=ev,f.entries=xh,f.entriesIn=Ph,f.extend=bh,f.extendWith=no,Va(f,f),f.add=Yy,f.attempt=Oh,f.camelCase=ty,f.capitalize=Sh,f.ceil=Xy,f.clamp=X0,f.clone=Vv,f.cloneDeep=Wv,f.cloneDeepWith=Jv,f.cloneWith=Gv,f.conformsTo=Qv,f.deburr=Ch,f.defaultTo=Ay,f.divide=Zy,f.endsWith=ry,f.eq=Nr,f.escape=iy,f.escapeRegExp=sy,f.every=lv,f.find=pv,f.findIndex=Xu,f.findKey=S0,f.findLast=dv,f.findLastIndex=Zu,f.findLastKey=C0,f.floor=em,f.forEach=nh,f.forEachRight=oh,f.forIn=R0,f.forInRight=O0,f.forOwn=A0,f.forOwnRight=T0,f.get=Ua,f.gt=Yv,f.gte=Xv,f.has=D0,f.hasIn=Ha,f.head=th,f.identity=ar,f.includes=wv,f.indexOf=dg,f.inRange=Z0,f.invoke=q0,f.isArguments=zi,f.isArray=ge,f.isArrayBuffer=Zv,f.isArrayLike=nr,f.isArrayLikeObject=bt,f.isBoolean=e0,f.isBuffer=bi,f.isDate=t0,f.isElement=r0,f.isEmpty=i0,f.isEqual=s0,f.isEqualWith=n0,f.isError=ja,f.isFinite=o0,f.isFunction=ti,f.isInteger=dh,f.isLength=io,f.isMap=gh,f.isMatch=a0,f.isMatchWith=c0,f.isNaN=u0,f.isNative=h0,f.isNil=f0,f.isNull=l0,f.isNumber=vh,f.isObject=ct,f.isObjectLike=yt,f.isPlainObject=js,f.isRegExp=za,f.isSafeInteger=p0,f.isSet=yh,f.isString=so,f.isSymbol=dr,f.isTypedArray=ls,f.isUndefined=d0,f.isWeakMap=g0,f.isWeakSet=v0,f.join=wg,f.kebabCase=ny,f.last=xr,f.lastIndexOf=_g,f.lowerCase=oy,f.lowerFirst=ay,f.lt=y0,f.lte=m0,f.max=tm,f.maxBy=rm,f.mean=im,f.meanBy=sm,f.min=nm,f.minBy=om,f.stubArray=Wa,f.stubFalse=Ja,f.stubObject=By,f.stubString=Vy,f.stubTrue=Gy,f.multiply=am,f.nth=bg,f.noConflict=qy,f.noop=Ga,f.now=eo,f.pad=cy,f.padEnd=uy,f.padStart=hy,f.parseInt=ly,f.random=ey,f.reduce=xv,f.reduceRight=Pv,f.repeat=fy,f.replace=py,f.result=K0,f.round=cm,f.runInContext=x,f.sample=Cv,f.size=Av,f.snakeCase=dy,f.some=Tv,f.sortedIndex=Rg,f.sortedIndexBy=Og,f.sortedIndexOf=Ag,f.sortedLastIndex=Tg,f.sortedLastIndexBy=Ng,f.sortedLastIndexOf=$g,f.startCase=vy,f.startsWith=yy,f.subtract=um,f.sum=hm,f.sumBy=lm,f.template=my,f.times=Wy,f.toFinite=ri,f.toInteger=ye,f.toLength=wh,f.toLower=wy,f.toNumber=Pr,f.toSafeInteger=w0,f.toString=Le,f.toUpper=_y,f.trim=by,f.trimEnd=Ey,f.trimStart=Iy,f.truncate=xy,f.unescape=Py,f.uniqueId=Qy,f.upperCase=Sy,f.upperFirst=ka,f.each=nh,f.eachRight=oh,f.first=th,Va(f,function(){var e={};return Ur(f,function(t,s){Me.call(f.prototype,s)||(e[s]=t)}),e}(),{chain:!1}),f.VERSION=n,wr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){f[e].placeholder=f}),wr(["drop","take"],function(e,t){Pe.prototype[e]=function(s){s=s===i?1:Lt(ye(s),0);var a=this.__filtered__&&!t?new Pe(this):this.clone();return a.__filtered__?a.__takeCount__=Bt(s,a.__takeCount__):a.__views__.push({size:Bt(s,V),type:e+(a.__dir__<0?"Right":"")}),a},Pe.prototype[e+"Right"]=function(s){return this.reverse()[e](s).reverse()}}),wr(["filter","map","takeWhile"],function(e,t){var s=t+1,a=s==A||s==je;Pe.prototype[e]=function(l){var p=this.clone();return p.__iteratees__.push({iteratee:se(l,3),type:s}),p.__filtered__=p.__filtered__||a,p}}),wr(["head","last"],function(e,t){var s="take"+(t?"Right":"");Pe.prototype[e]=function(){return this[s](1).value()[0]}}),wr(["initial","tail"],function(e,t){var s="drop"+(t?"":"Right");Pe.prototype[e]=function(){return this.__filtered__?new Pe(this):this[s](1)}}),Pe.prototype.compact=function(){return this.filter(ar)},Pe.prototype.find=function(e){return this.filter(e).head()},Pe.prototype.findLast=function(e){return this.reverse().find(e)},Pe.prototype.invokeMap=be(function(e,t){return typeof e=="function"?new Pe(this):this.map(function(s){return $s(s,e,t)})}),Pe.prototype.reject=function(e){return this.filter(ro(se(e)))},Pe.prototype.slice=function(e,t){e=ye(e);var s=this;return s.__filtered__&&(e>0||t<0)?new Pe(s):(e<0?s=s.takeRight(-e):e&&(s=s.drop(e)),t!==i&&(t=ye(t),s=t<0?s.dropRight(-t):s.take(t-e)),s)},Pe.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Pe.prototype.toArray=function(){return this.take(V)},Ur(Pe.prototype,function(e,t){var s=/^(?:filter|find|map|reject)|While$/.test(t),a=/^(?:head|last)$/.test(t),l=f[a?"take"+(t=="last"?"Right":""):t],p=a||/^find/.test(t);l&&(f.prototype[t]=function(){var m=this.__wrapped__,_=a?[1]:arguments,P=m instanceof Pe,L=_[0],q=P||ge(m),U=function(Ie){var Re=l.apply(f,di([Ie],_));return a&&G?Re[0]:Re};q&&s&&typeof L=="function"&&L.length!=1&&(P=q=!1);var G=this.__chain__,ee=!!this.__actions__.length,ne=p&&!G,we=P&&!ee;if(!p&&q){m=we?m:new Pe(this);var oe=e.apply(m,_);return oe.__actions__.push({func:Xn,args:[U],thisArg:i}),new br(oe,G)}return ne&&we?e.apply(this,_):(oe=this.thru(U),ne?a?oe.value()[0]:oe.value():oe)})}),wr(["pop","push","shift","sort","splice","unshift"],function(e){var t=xn[e],s=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",a=/^(?:pop|shift)$/.test(e);f.prototype[e]=function(){var l=arguments;if(a&&!this.__chain__){var p=this.value();return t.apply(ge(p)?p:[],l)}return this[s](function(m){return t.apply(ge(m)?m:[],l)})}}),Ur(Pe.prototype,function(e,t){var s=f[t];if(s){var a=s.name+"";Me.call(os,a)||(os[a]=[]),os[a].push({name:t,func:s})}}),os[Bn(i,ce).name]=[{name:"wrapper",func:i}],Pe.prototype.clone=Pp,Pe.prototype.reverse=Sp,Pe.prototype.value=Cp,f.prototype.at=rv,f.prototype.chain=iv,f.prototype.commit=sv,f.prototype.next=nv,f.prototype.plant=av,f.prototype.reverse=cv,f.prototype.toJSON=f.prototype.valueOf=f.prototype.value=uv,f.prototype.first=f.prototype.head,Ss&&(f.prototype[Ss]=ov),f},is=sp();_t?((_t.exports=is)._=is,Ve._=is):Ce._=is}).call(Vs)})(wc,wc.exports);var FE=Object.defineProperty,LE=Object.defineProperties,qE=Object.getOwnPropertyDescriptors,$l=Object.getOwnPropertySymbols,ME=Object.prototype.hasOwnProperty,jE=Object.prototype.propertyIsEnumerable,Dl=(c,r,i)=>r in c?FE(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,ho=(c,r)=>{for(var i in r||(r={}))ME.call(r,i)&&Dl(c,i,r[i]);if($l)for(var i of $l(r))jE.call(r,i)&&Dl(c,i,r[i]);return c},zE=(c,r)=>LE(c,qE(r));function Pi(c,r,i){var n;const o=Ym(c);return((n=r.rpcMap)==null?void 0:n[o.reference])||`${DE}?chainId=${o.namespace}:${o.reference}&projectId=${i}`}function Vi(c){return c.includes(":")?c.split(":")[1]:c}function $f(c){return c.map(r=>`${r.split(":")[0]}:${r.split(":")[1]}`)}function UE(c,r){const i=Object.keys(r.namespaces).filter(o=>o.includes(c));if(!i.length)return[];const n=[];return i.forEach(o=>{const h=r.namespaces[o].accounts;n.push(...h)}),n}function HE(c={},r={}){const i=Fl(c),n=Fl(r);return wc.exports.merge(i,n)}function Fl(c){var r,i,n,o;const h={};if(!po(c))return h;for(const[d,v]of Object.entries(c)){const w=Ql(d)?[d]:v.chains,y=v.methods||[],E=v.events||[],C=v.rpcMap||{},O=Gs(d);h[O]=zE(ho(ho({},h[O]),v),{chains:Ya(w,(r=h[O])==null?void 0:r.chains),methods:Ya(y,(i=h[O])==null?void 0:i.methods),events:Ya(E,(n=h[O])==null?void 0:n.events),rpcMap:ho(ho({},C),(o=h[O])==null?void 0:o.rpcMap)})}return h}function kE(c){return c.includes(":")?c.split(":")[2]:c}function KE(c){const r={};for(const[i,n]of Object.entries(c)){const o=n.methods||[],h=n.events||[],d=n.accounts||[],v=Ql(i)?[i]:n.chains?n.chains:$f(n.accounts);r[i]={chains:v,methods:o,events:h,accounts:d}}return r}function uc(c){return typeof c=="number"?c:c.includes("0x")?parseInt(c,16):c.includes(":")?Number(c.split(":")[1]):Number(c)}const Df={},st=c=>Df[c],hc=(c,r)=>{Df[c]=r};class BE{constructor(r){this.name="polkadot",this.namespace=r.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getAccounts(){const r=this.namespace.accounts;return r?r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2])||[]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=Vi(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Pi(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new ui(new Si(n,st("disableProviderPing")))}}class VE{constructor(r){this.name="eip155",this.namespace=r.namespace,this.events=st("events"),this.client=st("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(r){switch(r.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(r);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(r.request.method)?await this.client.request(r):this.getHttpProvider().request(r.request)}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(parseInt(r),i),this.chainId=parseInt(r),this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}createHttpProvider(r,i){const n=i||Pi(`${this.name}:${r}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new ui(new Si(n,st("disableProviderPing")))}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=parseInt(Vi(i));r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}getHttpProvider(){const r=this.chainId,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}async handleSwitchChain(r){var i,n;let o=r.request.params?(i=r.request.params[0])==null?void 0:i.chainId:"0x0";o=o.startsWith("0x")?o:`0x${o}`;const h=parseInt(o,16);if(this.isChainApproved(h))this.setDefaultChain(`${h}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:r.topic,request:{method:r.request.method,params:[{chainId:o}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${h}`);else throw new Error(`Failed to switch to chain 'eip155:${h}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(r){return this.namespace.chains.includes(`${this.name}:${r}`)}}class GE{constructor(r){this.name="solana",this.namespace=r.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=Vi(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Pi(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new ui(new Si(n,st("disableProviderPing")))}}class WE{constructor(r){this.name="cosmos",this.namespace=r.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=Vi(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Pi(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new ui(new Si(n,st("disableProviderPing")))}}class JE{constructor(r){this.name="cip34",this.namespace=r.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{const n=this.getCardanoRPCUrl(i),o=Vi(i);r[o]=this.createHttpProvider(o,n)}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}getCardanoRPCUrl(r){const i=this.namespace.rpcMap;if(i)return i[r]}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||this.getCardanoRPCUrl(r);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new ui(new Si(n,st("disableProviderPing")))}}class QE{constructor(r){this.name="elrond",this.namespace=r.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=Vi(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Pi(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new ui(new Si(n,st("disableProviderPing")))}}class YE{constructor(r){this.name="multiversx",this.namespace=r.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){this.httpProviders[r]||this.setHttpProvider(r,i),this.chainId=r,this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${r}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const o=Vi(i);r[o]=this.createHttpProvider(o,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Pi(r,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);return new ui(new Si(n,st("disableProviderPing")))}}class XE{constructor(r){this.name="near",this.namespace=r.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){if(this.chainId=r,!this.httpProviders[r]){const n=i||Pi(`${this.name}:${r}`,this.namespace);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);this.setHttpProvider(r,n)}this.events.emit(hi.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2])||[]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;r[i]=this.createHttpProvider(i,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Pi(r,this.namespace);return typeof n>"u"?void 0:new ui(new Si(n,st("disableProviderPing")))}}var ZE=Object.defineProperty,eI=Object.defineProperties,tI=Object.getOwnPropertyDescriptors,Ll=Object.getOwnPropertySymbols,rI=Object.prototype.hasOwnProperty,iI=Object.prototype.propertyIsEnumerable,ql=(c,r,i)=>r in c?ZE(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,lo=(c,r)=>{for(var i in r||(r={}))rI.call(r,i)&&ql(c,i,r[i]);if(Ll)for(var i of Ll(r))iI.call(r,i)&&ql(c,i,r[i]);return c},lc=(c,r)=>eI(c,tI(r));class Tc{constructor(r){this.events=new Ic,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=r,this.logger=typeof(r==null?void 0:r.logger)<"u"&&typeof(r==null?void 0:r.logger)!="string"?r.logger:Se.pino(Se.getDefaultLoggerOptions({level:(r==null?void 0:r.logger)||Tl})),this.disableProviderPing=(r==null?void 0:r.disableProviderPing)||!1}static async init(r){const i=new Tc(r);return await i.initialize(),i}async request(r,i){const[n,o]=this.validateChain(i);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:lo({},r),chainId:`${n}:${o}`,topic:this.session.topic})}sendAsync(r,i,n){const o=new Date().getTime();this.request(r,n).then(h=>i(null,bo(o,h))).catch(h=>i(h,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var r;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(r=this.session)==null?void 0:r.topic,reason:Gt("USER_DISCONNECTED")}),await this.cleanup()}async connect(r){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(r),await this.cleanupPendingPairings(),!r.skipPairing)return await this.pair(r.pairingTopic)}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}removeListener(r,i){this.events.removeListener(r,i)}off(r,i){this.events.off(r,i)}get isWalletConnect(){return!0}async pair(r){this.shouldAbortPairingAttempt=!1;let i=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(i>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:n,approval:o}=await this.client.connect({pairingTopic:r,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});n&&(this.uri=n,this.events.emit("display_uri",n)),await o().then(h=>{this.session=h,this.namespaces||(this.namespaces=KE(h.namespaces),this.persist("namespaces",this.namespaces))}).catch(h=>{if(h.message!==Tf)throw h;i++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(r,i){try{if(!this.session)return;const[n,o]=this.validateChain(r);this.getProvider(n).setDefaultChain(o,i)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(r={}){this.logger.info("Cleaning up inactive pairings...");const i=this.client.pairing.getAll();if(ms(i)){for(const n of i)r.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${i.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const r=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[r]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await RE.init({logger:this.providerOpts.logger||Tl,relayUrl:this.providerOpts.relayUrl||TE,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const r=[...new Set(Object.keys(this.session.namespaces).map(i=>Gs(i)))];hc("client",this.client),hc("events",this.events),hc("disableProviderPing",this.disableProviderPing),r.forEach(i=>{if(!this.session)return;const n=UE(i,this.session),o=$f(n),h=HE(this.namespaces,this.optionalNamespaces),d=lc(lo({},h[i]),{accounts:n,chains:o});switch(i){case"eip155":this.rpcProviders[i]=new VE({namespace:d});break;case"solana":this.rpcProviders[i]=new GE({namespace:d});break;case"cosmos":this.rpcProviders[i]=new WE({namespace:d});break;case"polkadot":this.rpcProviders[i]=new BE({namespace:d});break;case"cip34":this.rpcProviders[i]=new JE({namespace:d});break;case"elrond":this.rpcProviders[i]=new QE({namespace:d});break;case"multiversx":this.rpcProviders[i]=new YE({namespace:d});break;case"near":this.rpcProviders[i]=new XE({namespace:d});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",r=>{this.events.emit("session_ping",r)}),this.client.on("session_event",r=>{const{params:i}=r,{event:n}=i;if(n.name==="accountsChanged"){const o=n.data;o&&ms(o)&&this.events.emit("accountsChanged",o.map(kE))}else if(n.name==="chainChanged"){const o=i.chainId,h=i.event.data,d=Gs(o),v=uc(o)!==uc(h)?`${d}:${uc(h)}`:o;this.onChainChanged(v)}else this.events.emit(n.name,n.data);this.events.emit("session_event",r)}),this.client.on("session_update",({topic:r,params:i})=>{var n;const{namespaces:o}=i,h=(n=this.client)==null?void 0:n.session.get(r);this.session=lc(lo({},h),{namespaces:o}),this.onSessionUpdate(),this.events.emit("session_update",{topic:r,params:i})}),this.client.on("session_delete",async r=>{await this.cleanup(),this.events.emit("session_delete",r),this.events.emit("disconnect",lc(lo({},Gt("USER_DISCONNECTED")),{data:r.topic}))}),this.on(hi.DEFAULT_CHAIN_CHANGED,r=>{this.onChainChanged(r,!0)})}getProvider(r){if(!this.rpcProviders[r])throw new Error(`Provider not found: ${r}`);return this.rpcProviders[r]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(r=>{var i;this.getProvider(r).updateNamespace((i=this.session)==null?void 0:i.namespaces[r])})}setNamespaces(r){const{namespaces:i,optionalNamespaces:n,sessionProperties:o}=r;i&&Object.keys(i).length&&(this.namespaces=i),n&&Object.keys(n).length&&(this.optionalNamespaces=n),this.sessionProperties=o,this.persist("namespaces",i),this.persist("optionalNamespaces",n)}validateChain(r){const[i,n]=(r==null?void 0:r.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[i,n];if(i&&!Object.keys(this.namespaces||{}).map(d=>Gs(d)).includes(i))throw new Error(`Namespace '${i}' is not configured. Please call connect() first with namespace config.`);if(i&&n)return[i,n];const o=Gs(Object.keys(this.namespaces)[0]),h=this.rpcProviders[o].getDefaultChain();return[o,h]}async requestAccounts(){const[r]=this.validateChain();return await this.getProvider(r).requestAccounts()}onChainChanged(r,i=!1){var n;if(!this.namespaces)return;const[o,h]=this.validateChain(r);i||this.getProvider(o).setDefaultChain(h),((n=this.namespaces[o])!=null?n:this.namespaces[`${o}:${h}`]).defaultChain=h,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",h)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(r,i){this.client.core.storage.setItem(`${Nl}/${r}`,i)}async getFromStore(r){return await this.client.core.storage.getItem(`${Nl}/${r}`)}}const sI=Tc,nI="wc",oI="ethereum_provider",aI=`${nI}@2:${oI}:`,cI="https://rpc.walletconnect.com/v1/",_c=["eth_sendTransaction","personal_sign"],uI=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],bc=["chainChanged","accountsChanged"],hI=["chainChanged","accountsChanged","message","disconnect","connect"];var lI=Object.defineProperty,fI=Object.defineProperties,pI=Object.getOwnPropertyDescriptors,Ml=Object.getOwnPropertySymbols,dI=Object.prototype.hasOwnProperty,gI=Object.prototype.propertyIsEnumerable,jl=(c,r,i)=>r in c?lI(c,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[r]=i,Js=(c,r)=>{for(var i in r||(r={}))dI.call(r,i)&&jl(c,i,r[i]);if(Ml)for(var i of Ml(r))gI.call(r,i)&&jl(c,i,r[i]);return c},zl=(c,r)=>fI(c,pI(r));function wo(c){return Number(c[0].split(":")[1])}function fc(c){return`0x${c.toString(16)}`}function vI(c){const{chains:r,optionalChains:i,methods:n,optionalMethods:o,events:h,optionalEvents:d,rpcMap:v}=c;if(!ms(r))throw new Error("Invalid chains");const w={chains:r,methods:n||_c,events:h||bc,rpcMap:Js({},r.length?{[wo(r)]:v[wo(r)]}:{})},y=h==null?void 0:h.filter(j=>!bc.includes(j)),E=n==null?void 0:n.filter(j=>!_c.includes(j));if(!i&&!d&&!o&&!(y!=null&&y.length)&&!(E!=null&&E.length))return{required:r.length?w:void 0};const C=(y==null?void 0:y.length)&&(E==null?void 0:E.length)||!i,O={chains:[...new Set(C?w.chains.concat(i||[]):i)],methods:[...new Set(w.methods.concat(o!=null&&o.length?o:uI))],events:[...new Set(w.events.concat(d!=null&&d.length?d:hI))],rpcMap:v};return{required:r.length?w:void 0,optional:i.length?O:void 0}}class Nc{constructor(){this.events=new Cr.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=aI,this.on=(r,i)=>(this.events.on(r,i),this),this.once=(r,i)=>(this.events.once(r,i),this),this.removeListener=(r,i)=>(this.events.removeListener(r,i),this),this.off=(r,i)=>(this.events.off(r,i),this),this.parseAccount=r=>this.isCompatibleChainId(r)?this.parseAccountId(r).address:r,this.signer={},this.rpc={}}static async init(r){const i=new Nc;return await i.initialize(r),i}async request(r){return await this.signer.request(r,this.formatChainId(this.chainId))}sendAsync(r,i){this.signer.sendAsync(r,i,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(r){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(r);const{required:i,optional:n}=vI(this.rpc);try{const o=await new Promise(async(d,v)=>{var w;this.rpc.showQrModal&&((w=this.modal)==null||w.subscribeModal(y=>{!y.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),v(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(zl(Js({namespaces:Js({},i&&{[this.namespace]:i})},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:r==null?void 0:r.pairingTopic})).then(y=>{d(y)}).catch(y=>{v(new Error(y.message))})});if(!o)return;const h=Xm(o.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:h),this.setAccounts(h),this.events.emit("connect",{chainId:fc(this.chainId)})}catch(o){throw this.signer.logger.error(o),o}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",r=>{const{params:i}=r,{event:n}=i;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",r)}),this.signer.on("chainChanged",r=>{const i=parseInt(r);this.chainId=i,this.events.emit("chainChanged",fc(this.chainId)),this.persist()}),this.signer.on("session_update",r=>{this.events.emit("session_update",r)}),this.signer.on("session_delete",r=>{this.reset(),this.events.emit("session_delete",r),this.events.emit("disconnect",zl(Js({},Gt("USER_DISCONNECTED")),{data:r.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",r=>{var i,n;this.rpc.showQrModal&&((i=this.modal)==null||i.closeModal(),(n=this.modal)==null||n.openModal({uri:r})),this.events.emit("display_uri",r)})}switchEthereumChain(r){this.request({method:"wallet_switchEthereumChain",params:[{chainId:r.toString(16)}]})}isCompatibleChainId(r){return typeof r=="string"?r.startsWith(`${this.namespace}:`):!1}formatChainId(r){return`${this.namespace}:${r}`}parseChainId(r){return Number(r.split(":")[1])}setChainIds(r){const i=r.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));i.length&&(this.chainId=i[0],this.events.emit("chainChanged",fc(this.chainId)),this.persist())}setChainId(r){if(this.isCompatibleChainId(r)){const i=this.parseChainId(r);this.chainId=i,this.switchEthereumChain(i)}}parseAccountId(r){const[i,n,o]=r.split(":");return{chainId:`${i}:${n}`,address:o}}setAccounts(r){this.accounts=r.filter(i=>this.parseChainId(this.parseAccountId(i).chainId)===this.chainId).map(i=>this.parseAccountId(i).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(r){var i,n;const o=(i=r==null?void 0:r.chains)!=null?i:[],h=(n=r==null?void 0:r.optionalChains)!=null?n:[],d=o.concat(h);if(!d.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const v=o.length?(r==null?void 0:r.methods)||_c:[],w=o.length?(r==null?void 0:r.events)||bc:[],y=(r==null?void 0:r.optionalMethods)||[],E=(r==null?void 0:r.optionalEvents)||[],C=(r==null?void 0:r.rpcMap)||this.buildRpcMap(d,r.projectId),O=(r==null?void 0:r.qrModalOptions)||void 0;return{chains:o==null?void 0:o.map(j=>this.formatChainId(j)),optionalChains:h.map(j=>this.formatChainId(j)),methods:v,events:w,optionalMethods:y,optionalEvents:E,rpcMap:C,showQrModal:!!(r!=null&&r.showQrModal),qrModalOptions:O,projectId:r.projectId,metadata:r.metadata}}buildRpcMap(r,i){const n={};return r.forEach(o=>{n[o]=this.getRpcUrl(o,i)}),n}async initialize(r){if(this.rpc=this.getRpcConfig(r),this.chainId=this.rpc.chains.length?wo(this.rpc.chains):wo(this.rpc.optionalChains),this.signer=await sI.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:r.disableProviderPing,relayUrl:r.relayUrl,storageOptions:r.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let i;try{const{WalletConnectModal:n}=await Zm(()=>import("./index-580cf522.js").then(o=>o.i),["./index-580cf522.js","./index-69ed1660.js","./index-f215153a.css"],import.meta.url);i=n}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(i)try{this.modal=new i(Js({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(r){if(!r)return;const{chains:i,optionalChains:n,rpcMap:o}=r;i&&ms(i)&&(this.rpc.chains=i.map(h=>this.formatChainId(h)),i.forEach(h=>{this.rpc.rpcMap[h]=(o==null?void 0:o[h])||this.getRpcUrl(h)})),n&&ms(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n==null?void 0:n.map(h=>this.formatChainId(h)),n.forEach(h=>{this.rpc.rpcMap[h]=(o==null?void 0:o[h])||this.getRpcUrl(h)}))}getRpcUrl(r,i){var n;return((n=this.rpc.rpcMap)==null?void 0:n[r])||`${cI}?chainId=eip155:${r}&projectId=${i||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const r=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),i=this.session.namespaces[`${this.namespace}:${r}`]?this.session.namespaces[`${this.namespace}:${r}`]:this.session.namespaces[this.namespace];this.setChainIds(r?[this.formatChainId(r)]:i==null?void 0:i.accounts),this.setAccounts(i==null?void 0:i.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(r){return typeof r=="string"||r instanceof String?[this.parseAccount(r)]:r.map(i=>this.parseAccount(i))}}const NI=Nc;export{NI as EthereumProvider,hI as OPTIONAL_EVENTS,uI as OPTIONAL_METHODS,bc as REQUIRED_EVENTS,_c as REQUIRED_METHODS,Nc as default};
